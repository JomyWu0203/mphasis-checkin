<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ğŸ“± iOS åŸç”Ÿæ‰“å¡åŠ©æ‰‹</title>
    
    <!-- iOS PWA å„ªåŒ– -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="iOSæ‰“å¡åŠ©æ‰‹">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#007AFF">
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23007AFF'/><text x='50' y='65' font-size='50' text-anchor='middle' fill='white'>ğŸ“±</text></svg>">
    
    <style>
        /* iOS åŸç”Ÿé¢¨æ ¼è¨­è¨ˆ */
        :root {
            --ios-blue: #007AFF;
            --ios-gray: #8E8E93;
            --ios-background: #F2F2F7;
            --ios-card: #FFFFFF;
            --ios-green: #34C759;
            --ios-red: #FF3B30;
            --ios-orange: #FF9500;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, SF Pro Text, SF Pro Icons, Helvetica Neue, Helvetica, Arial, sans-serif;
            background: var(--ios-background);
            color: #000;
            line-height: 1.4;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        .container {
            max-width: 390px;
            margin: 0 auto;
            padding: 0 16px;
        }

        /* iOS ç‹€æ…‹åˆ— */
        .status-bar {
            height: 44px;
            background: var(--ios-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 17px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        /* iOS å¡ç‰‡æ¨£å¼ */
        .card {
            background: var(--ios-card);
            border-radius: 12px;
            margin: 16px 0;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            padding: 16px 20px;
            border-bottom: 0.5px solid #E5E5EA;
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: #000;
            margin-bottom: 4px;
        }

        .card-subtitle {
            font-size: 15px;
            color: var(--ios-gray);
        }

        .card-content {
            padding: 20px;
        }

        /* iOS æŒ‰éˆ• */
        .button {
            display: block;
            width: 100%;
            padding: 12px 20px;
            font-size: 17px;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 8px 0;
            text-decoration: none;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .button-primary {
            background: var(--ios-blue);
            color: white;
        }

        .button-success {
            background: var(--ios-green);
            color: white;
        }

        .button-danger {
            background: var(--ios-red);
            color: white;
        }

        .button-warning {
            background: var(--ios-orange);
            color: white;
        }

        .button:active {
            transform: scale(0.95);
            opacity: 0.8;
        }

        /* æ™‚é–“é¡¯ç¤º */
        .time-display {
            text-align: center;
            padding: 32px 20px;
        }

        .current-time {
            font-size: 48px;
            font-weight: 200;
            color: #000;
            margin-bottom: 8px;
            font-feature-settings: "tnum";
        }

        .current-date {
            font-size: 17px;
            color: var(--ios-gray);
            margin-bottom: 16px;
        }

        .time-status {
            display: inline-block;
            padding: 6px 12px;
            background: var(--ios-green);
            color: white;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 600;
        }

        /* iOS åˆ—è¡¨ */
        .list-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            border-bottom: 0.5px solid #E5E5EA;
            cursor: pointer;
            transition: background 0.15s ease;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-item:active {
            background: #F2F2F7;
        }

        .list-icon {
            width: 24px;
            height: 24px;
            margin-right: 16px;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .list-content {
            flex: 1;
        }

        .list-title {
            font-size: 17px;
            font-weight: 400;
            color: #000;
            margin-bottom: 2px;
        }

        .list-subtitle {
            font-size: 15px;
            color: var(--ios-gray);
        }

        .list-arrow {
            color: #C7C7CC;
            font-size: 14px;
        }

        /* ç‹€æ…‹è¨Šæ¯ */
        .status-message {
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
            font-size: 15px;
            line-height: 1.4;
        }

        .status-success {
            background: #E8F5E8;
            color: #1B5E20;
            border: 1px solid var(--ios-green);
        }

        .status-error {
            background: #FFEBEE;
            color: #C62828;
            border: 1px solid var(--ios-red);
        }

        .status-info {
            background: #E3F2FD;
            color: #0D47A1;
            border: 1px solid var(--ios-blue);
        }

        .status-warning {
            background: #FFF3E0;
            color: #E65100;
            border: 1px solid var(--ios-orange);
        }

        /* iOS è¼¸å…¥æ¡† */
        .input-group {
            margin: 16px 0;
        }

        .input-label {
            font-size: 15px;
            color: var(--ios-gray);
            margin-bottom: 8px;
            display: block;
        }

        .input-field {
            width: 100%;
            padding: 12px 16px;
            font-size: 17px;
            border: 1px solid #E5E5EA;
            border-radius: 8px;
            background: #FAFAFA;
            transition: border-color 0.2s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--ios-blue);
            background: white;
        }

        /* å‹•ç•«æ•ˆæœ */
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* éš±è—é¡ */
        .hidden {
            display: none !important;
        }

        /* iOS å°ˆç”¨å„ªåŒ– */
        @supports (-webkit-backdrop-filter: blur(20px)) {
            .status-bar {
                backdrop-filter: blur(20px);
                background: rgba(0, 122, 255, 0.9);
            }
        }
    </style>
</head>
<body>
    <!-- iOS ç‹€æ…‹åˆ— -->
    <div class="status-bar">
        ğŸ“± iOS åŸç”Ÿæ‰“å¡åŠ©æ‰‹
    </div>

    <div class="container">
        <!-- æ™‚é–“é¡¯ç¤ºå¡ç‰‡ -->
        <div class="card">
            <div class="time-display">
                <div class="current-time" id="currentTime">--:--</div>
                <div class="current-date" id="currentDate">è¼‰å…¥ä¸­...</div>
                <div class="time-status">iOS å°ˆç”¨ç‰ˆ</div>
            </div>
        </div>

        <!-- å¿«é€Ÿæ‰“å¡ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">âš¡ å¿«é€Ÿæ‰“å¡</div>
                <div class="card-subtitle">å°ˆç‚º iOS Safari å„ªåŒ–</div>
            </div>
            <div class="card-content">
                <button class="button button-primary pulse" onclick="quickCheckin()">
                    ğŸ¯ ç«‹å³æ‰“å¡ (æ™ºæ…§å¼•å°)
                </button>
                <button class="button button-success" onclick="openCheckinSite()">
                    ğŸŒ é–‹å•Ÿæ‰“å¡ç¶²ç«™
                </button>
            </div>
        </div>

        <!-- iOS å°ˆç”¨åŠŸèƒ½ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">ğŸ iOS å°ˆç”¨åŠŸèƒ½</div>
                <div class="card-subtitle">é‡å° Safari å®‰å…¨é™åˆ¶å„ªåŒ–</div>
            </div>
            
            <!-- åŠŸèƒ½åˆ—è¡¨ -->
            <div class="list-item" onclick="createShortcut()">
                <div class="list-icon">ğŸ”—</div>
                <div class="list-content">
                    <div class="list-title">å‰µå»ºå¿«æ·æ–¹å¼</div>
                    <div class="list-subtitle">ä¸€éµè·³è½‰åˆ°æ‰“å¡é é¢</div>
                </div>
                <div class="list-arrow">â€º</div>
            </div>
            
            <div class="list-item" onclick="showInstructions()">
                <div class="list-icon">ğŸ“–</div>
                <div class="list-content">
                    <div class="list-title">æ™ºæ…§å¼•å°æ•™å­¸</div>
                    <div class="list-subtitle">é€æ­¥æŒ‡å°å®Œæˆæ‰“å¡</div>
                </div>
                <div class="list-arrow">â€º</div>
            </div>
            
            <div class="list-item" onclick="setupReminder()">
                <div class="list-icon">â°</div>
                <div class="list-content">
                    <div class="list-title">è¨­å®šæé†’</div>
                    <div class="list-subtitle">å»ºç«‹æ—¥æ›†äº‹ä»¶æˆ–é¬§é˜</div>
                </div>
                <div class="list-arrow">â€º</div>
            </div>
            
            <div class="list-item" onclick="copyQuickText()">
                <div class="list-icon">ğŸ“‹</div>
                <div class="list-content">
                    <div class="list-title">è¤‡è£½ç™»å…¥è³‡è¨Š</div>
                    <div class="list-subtitle">å¿«é€Ÿå¡«å…¥å¸³è™Ÿå¯†ç¢¼</div>
                </div>
                <div class="list-arrow">â€º</div>
            </div>
        </div>

        <!-- è¨­å®šå¡ç‰‡ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">âš™ï¸ æ‰“å¡è¨­å®š</div>
                <div class="card-subtitle">å€‹äººåŒ–æ‚¨çš„æ‰“å¡é«”é©—</div>
            </div>
            <div class="card-content">
                <div class="input-group">
                    <label class="input-label">æ‰“å¡ç¶²å€</label>
                    <input type="url" class="input-field" id="checkinUrl" 
                           value="https://enterprise-apps.mphasis.com/ess/v1/#/home"
                           placeholder="è¼¸å…¥æ‚¨çš„æ‰“å¡ç¶²å€">
                </div>
                
                <div class="input-group">
                    <label class="input-label">å…¬å¸åç¨±</label>
                    <input type="text" class="input-field" id="companyName" 
                           value="Mphasis"
                           placeholder="è¼¸å…¥å…¬å¸åç¨±">
                </div>
                
                <div class="input-group">
                    <label class="input-label">æ‰“å¡æ™‚é–“ (24å°æ™‚åˆ¶)</label>
                    <input type="time" class="input-field" id="checkinTime" 
                           value="09:00">
                </div>
                
                <button class="button button-primary" onclick="saveSettings()">
                    ğŸ’¾ å„²å­˜è¨­å®š
                </button>
            </div>
        </div>

        <!-- ç‹€æ…‹è¨Šæ¯å€åŸŸ -->
        <div id="statusArea"></div>

        <!-- iOS å°ˆç”¨èªªæ˜ -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">ğŸ’¡ iOS ä½¿ç”¨èªªæ˜</div>
                <div class="card-subtitle">ç‚ºä»€éº¼ä¸èƒ½è‡ªå‹•é»é¸ï¼Ÿ</div>
            </div>
            <div class="card-content">
                <div class="status-info">
                    <strong>ğŸ”’ iOS Safari å®‰å…¨é™åˆ¶ï¼š</strong><br><br>
                    â€¢ ç¦æ­¢è·¨åŸŸè‡ªå‹•é»é¸æŒ‰éˆ•<br>
                    â€¢ ç¦æ­¢è‡ªå‹•å¡«å…¥è¡¨å–®<br>
                    â€¢ ç¦æ­¢å¾Œå°è‡ªå‹•åŸ·è¡Œ<br><br>
                    
                    <strong>âœ… æœ¬æ‡‰ç”¨æä¾›çš„è§£æ±ºæ–¹æ¡ˆï¼š</strong><br><br>
                    â€¢ æ™ºæ…§å¼•å°ï¼šé€æ­¥æ•™æ‚¨å¦‚ä½•æ“ä½œ<br>
                    â€¢ å¿«æ·æ–¹å¼ï¼šä¸€éµé–‹å•Ÿæ­£ç¢ºé é¢<br>
                    â€¢ æé†’åŠŸèƒ½ï¼šä¸æœƒå¿˜è¨˜æ‰“å¡æ™‚é–“<br>
                    â€¢ è³‡è¨Šè¤‡è£½ï¼šå¿«é€Ÿå¡«å…¥ç™»å…¥è³‡æ–™
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let checkinWindow = null;
        let settings = {
            checkinUrl: 'https://enterprise-apps.mphasis.com/ess/v1/#/home',
            companyName: 'Mphasis',
            checkinTime: '09:00'
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ iOS æ‰“å¡åŠ©æ‰‹å•Ÿå‹•');
            loadSettings();
            updateTime();
            setInterval(updateTime, 1000);
            
            // æª¢æ¸¬æ˜¯å¦åœ¨ iOS ä¸Š
            if (!isiOS()) {
                showMessage('âš ï¸ æ­¤æ‡‰ç”¨å°ˆç‚º iOS Safari è¨­è¨ˆï¼Œåœ¨å…¶ä»–å¹³å°å¯èƒ½åŠŸèƒ½å—é™ã€‚', 'warning');
            }
        });

        // æª¢æ¸¬æ˜¯å¦ç‚º iOS
        function isiOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent);
        }

        // æ›´æ–°æ™‚é–“é¡¯ç¤º
        function updateTime() {
            try {
                const now = new Date();
                const timeOptions = { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: false
                };
                const dateOptions = { 
                    year: 'numeric',
                    month: 'long', 
                    day: 'numeric',
                    weekday: 'long'
                };
                
                document.getElementById('currentTime').textContent = 
                    now.toLocaleTimeString('zh-TW', timeOptions);
                document.getElementById('currentDate').textContent = 
                    now.toLocaleDateString('zh-TW', dateOptions);
            } catch (error) {
                console.error('æ™‚é–“æ›´æ–°å¤±æ•—:', error);
            }
        }

        // å¿«é€Ÿæ‰“å¡ - iOS æ™ºæ…§å¼•å°
        function quickCheckin() {
            showMessage('ğŸ¯ æ­£åœ¨å•Ÿå‹•æ™ºæ…§å¼•å°æ‰“å¡...', 'info');
            
            setTimeout(() => {
                // é–‹å•Ÿæ‰“å¡ç¶²ç«™
                checkinWindow = window.open(settings.checkinUrl, '_blank', 'width=390,height=844');
                
                if (checkinWindow) {
                    // é¡¯ç¤ºå¼•å°æ­¥é©Ÿ
                    showGuidedInstructions();
                } else {
                    showMessage('âŒ ç„¡æ³•é–‹å•Ÿæ‰“å¡ç¶²ç«™ï¼Œè«‹æª¢æŸ¥å½ˆçª—è¨­å®š', 'error');
                }
            }, 500);
        }

        // é¡¯ç¤ºå¼•å°æ­¥é©Ÿ
        function showGuidedInstructions() {
            const instructions = `
                <div class="status-success">
                    <strong>ğŸ¯ æ™ºæ…§å¼•å°å·²å•Ÿå‹•ï¼</strong><br><br>
                    
                    <strong>ç¬¬ 1 æ­¥ï¼š</strong> ç­‰å¾…é é¢è¼‰å…¥å®Œæˆ<br>
                    <strong>ç¬¬ 2 æ­¥ï¼š</strong> å°‹æ‰¾ç™»å…¥æˆ– CHECK-IN æŒ‰éˆ•<br>
                    <strong>ç¬¬ 3 æ­¥ï¼š</strong> é»æ“ŠæŒ‰éˆ•å®Œæˆæ‰“å¡<br><br>
                    
                    <button class="button button-primary" onclick="copyLoginInfo()" style="margin-top: 8px;">
                        ğŸ“‹ è¤‡è£½ç™»å…¥è³‡è¨Š
                    </button>
                    
                    <button class="button button-success" onclick="watchCheckinWindow()" style="margin-top: 8px;">
                        ğŸ‘ï¸ ç›£æ§æ‰“å¡ç‹€æ…‹
                    </button>
                </div>
            `;
            
            document.getElementById('statusArea').innerHTML = instructions;
        }

        // ç›£æ§æ‰“å¡è¦–çª—
        function watchCheckinWindow() {
            if (!checkinWindow || checkinWindow.closed) {
                showMessage('æ‰“å¡è¦–çª—å·²é—œé–‰', 'info');
                return;
            }
            
            showMessage('ğŸ” æ­£åœ¨ç›£æ§æ‰“å¡ç‹€æ…‹...', 'info');
            
            const checkInterval = setInterval(() => {
                if (checkinWindow.closed) {
                    clearInterval(checkInterval);
                    showMessage('âœ… æ‰“å¡è¦–çª—å·²é—œé–‰ï¼Œå¸Œæœ›æ‚¨å·²å®Œæˆæ‰“å¡ï¼', 'success');
                    return;
                }
                
                try {
                    // å˜—è©¦æª¢æŸ¥é é¢æ¨™é¡Œè®ŠåŒ–ï¼ˆæœ‰é™çš„è·¨åŸŸè¨ªå•ï¼‰
                    if (checkinWindow.document && checkinWindow.document.title) {
                        console.log('é é¢æ¨™é¡Œ:', checkinWindow.document.title);
                    }
                } catch (e) {
                    // è·¨åŸŸé™åˆ¶ï¼Œæ­£å¸¸ç¾è±¡
                }
            }, 2000);
            
            // 30ç§’å¾Œåœæ­¢ç›£æ§
            setTimeout(() => {
                clearInterval(checkInterval);
                if (!checkinWindow.closed) {
                    showMessage('ç›£æ§æ™‚é–“åˆ°ï¼Œè«‹æ‰‹å‹•ç¢ºèªæ‰“å¡ç‹€æ…‹', 'info');
                }
            }, 30000);
        }

        // é–‹å•Ÿæ‰“å¡ç¶²ç«™
        function openCheckinSite() {
            checkinWindow = window.open(settings.checkinUrl, '_blank');
            
            if (checkinWindow) {
                showMessage('âœ… æ‰“å¡ç¶²ç«™å·²é–‹å•Ÿï¼', 'success');
            } else {
                showMessage('âŒ ç„¡æ³•é–‹å•Ÿç¶²ç«™ï¼Œè«‹æª¢æŸ¥å½ˆçª—è¨­å®š', 'error');
            }
        }

        // å‰µå»ºå¿«æ·æ–¹å¼
        function createShortcut() {
            const shortcutUrl = `data:text/html,<script>window.location.href='${settings.checkinUrl}';</script>`;
            
            if (navigator.share) {
                navigator.share({
                    title: `${settings.companyName} æ‰“å¡å¿«æ·`,
                    url: settings.checkinUrl
                }).then(() => {
                    showMessage('âœ… å¿«æ·æ–¹å¼å·²åˆ†äº«ï¼', 'success');
                }).catch(err => {
                    console.log('åˆ†äº«å¤±æ•—:', err);
                    fallbackCreateShortcut();
                });
            } else {
                fallbackCreateShortcut();
            }
        }

        // å‚™ç”¨å¿«æ·æ–¹å¼å‰µå»º
        function fallbackCreateShortcut() {
            const instructions = `
                <div class="status-info">
                    <strong>ğŸ“± å‰µå»ºä¸»ç•«é¢å¿«æ·æ–¹å¼ï¼š</strong><br><br>
                    1. åœ¨ Safari ä¸­é–‹å•Ÿï¼š<br>
                    <code style="background: #f0f0f0; padding: 2px 4px; border-radius: 4px;">${settings.checkinUrl}</code><br><br>
                    2. é»æ“Šåˆ†äº«æŒ‰éˆ• ğŸ“¤<br>
                    3. é¸æ“‡ã€ŒåŠ å…¥ä¸»ç•«é¢ã€<br>
                    4. è¼¸å…¥åç¨±ï¼š${settings.companyName}æ‰“å¡<br>
                    5. é»æ“Šã€Œæ–°å¢ã€<br><br>
                    
                    <button class="button button-primary" onclick="copyUrl()" style="margin-top: 8px;">
                        ğŸ“‹ è¤‡è£½ç¶²å€
                    </button>
                </div>
            `;
            
            document.getElementById('statusArea').innerHTML = instructions;
        }

        // è¤‡è£½ç¶²å€
        function copyUrl() {
            copyToClipboard(settings.checkinUrl);
            showMessage('âœ… ç¶²å€å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼', 'success');
        }

        // é¡¯ç¤ºæ“ä½œèªªæ˜
        function showInstructions() {
            const instructions = `
                <div class="status-info">
                    <strong>ğŸ“– iOS Safari æ‰“å¡å®Œæ•´æŒ‡å—ï¼š</strong><br><br>
                    
                    <strong>æ–¹æ³•ä¸€ï¼šç›´æ¥æ‰“å¡</strong><br>
                    1. é»æ“Šã€Œç«‹å³æ‰“å¡ã€<br>
                    2. åœ¨é–‹å•Ÿçš„é é¢ä¸­æ‰¾åˆ° CHECK-IN æŒ‰éˆ•<br>
                    3. é»æ“Šå®Œæˆæ‰“å¡<br><br>
                    
                    <strong>æ–¹æ³•äºŒï¼šå»ºç«‹å¿«æ·æ–¹å¼</strong><br>
                    1. é»æ“Šã€Œå‰µå»ºå¿«æ·æ–¹å¼ã€<br>
                    2. æŒ‰ç…§æç¤ºåŠ å…¥ä¸»ç•«é¢<br>
                    3. æ—¥å¾Œç›´æ¥é»æ“Šåœ–ç¤ºæ‰“å¡<br><br>
                    
                    <strong>æ–¹æ³•ä¸‰ï¼šè¨­å®šæé†’</strong><br>
                    1. é»æ“Šã€Œè¨­å®šæé†’ã€<br>
                    2. å»ºç«‹æ—¥æ›†äº‹ä»¶<br>
                    3. åˆ°æ™‚é–“æœƒè‡ªå‹•æé†’<br><br>
                    
                    <button class="button button-success" onclick="clearStatus()" style="margin-top: 8px;">
                        âœ… æˆ‘çŸ¥é“äº†
                    </button>
                </div>
            `;
            
            document.getElementById('statusArea').innerHTML = instructions;
        }

        // è¨­å®šæé†’
        function setupReminder() {
            const [hours, minutes] = settings.checkinTime.split(':');
            const reminderText = `${settings.companyName} æ‰“å¡æé†’ - æ¯å¤© ${settings.checkinTime}`;
            
            if (navigator.share) {
                // å‰µå»ºæ—¥æ›†äº‹ä»¶æ–‡å­—
                const calendarText = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//iOSæ‰“å¡åŠ©æ‰‹//NONSGML//EN
BEGIN:VEVENT
SUMMARY:${reminderText}
DESCRIPTION:é»æ“Šé–‹å•Ÿæ‰“å¡ç¶²ç«™ï¼š${settings.checkinUrl}
RRULE:FREQ=DAILY;BYHOUR=${hours};BYMINUTE=${minutes}
END:VEVENT
END:VCALENDAR`;
                
                navigator.share({
                    title: reminderText,
                    text: `æé†’è¨­å®šï¼š${reminderText}\næ‰“å¡ç¶²å€ï¼š${settings.checkinUrl}`
                });
            } else {
                showReminderInstructions();
            }
        }

        // é¡¯ç¤ºæé†’è¨­å®šèªªæ˜
        function showReminderInstructions() {
            const instructions = `
                <div class="status-warning">
                    <strong>â° æ‰‹å‹•è¨­å®šæ‰“å¡æé†’ï¼š</strong><br><br>
                    
                    <strong>æ–¹æ³•ä¸€ï¼šæ—¥æ›†æé†’</strong><br>
                    1. é–‹å•Ÿã€Œæ—¥æ›†ã€æ‡‰ç”¨<br>
                    2. æ–°å¢äº‹ä»¶ï¼š${settings.companyName}æ‰“å¡<br>
                    3. è¨­å®šæ™‚é–“ï¼šæ¯å¤© ${settings.checkinTime}<br>
                    4. è¨­å®šæé†’ï¼šæå‰ 5 åˆ†é˜<br><br>
                    
                    <strong>æ–¹æ³•äºŒï¼šé¬§é˜æé†’</strong><br>
                    1. é–‹å•Ÿã€Œæ™‚é˜ã€æ‡‰ç”¨<br>
                    2. æ–°å¢é¬§é˜ï¼š${settings.checkinTime}<br>
                    3. æ¨™ç±¤ï¼š${settings.companyName}æ‰“å¡<br>
                    4. é‡è¤‡ï¼šæ¯å¤©<br><br>
                    
                    <button class="button button-primary" onclick="openCalendar()" style="margin-top: 8px;">
                        ğŸ“… é–‹å•Ÿæ—¥æ›†æ‡‰ç”¨
                    </button>
                </div>
            `;
            
            document.getElementById('statusArea').innerHTML = instructions;
        }

        // é–‹å•Ÿæ—¥æ›†æ‡‰ç”¨
        function openCalendar() {
            window.location.href = 'calshow://';
        }

        // è¤‡è£½å¿«é€Ÿæ–‡å­—
        function copyQuickText() {
            const quickText = `${settings.companyName} æ‰“å¡ç¶²å€ï¼š${settings.checkinUrl}`;
            copyToClipboard(quickText);
            showMessage('âœ… æ‰“å¡è³‡è¨Šå·²è¤‡è£½ï¼', 'success');
        }

        // è¤‡è£½ç™»å…¥è³‡è¨Š
        function copyLoginInfo() {
            copyToClipboard(settings.checkinUrl);
            showMessage('âœ… æ‰“å¡ç¶²å€å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼Œå¯ä»¥åœ¨ç€è¦½å™¨ä¸­è²¼ä¸Šï¼', 'success');
        }

        // å„²å­˜è¨­å®š
        function saveSettings() {
            const newSettings = {
                checkinUrl: document.getElementById('checkinUrl').value.trim(),
                companyName: document.getElementById('companyName').value.trim(),
                checkinTime: document.getElementById('checkinTime').value
            };
            
            // é©—è­‰è¨­å®š
            if (!newSettings.checkinUrl || !newSettings.companyName || !newSettings.checkinTime) {
                showMessage('âŒ è«‹å¡«å¯«å®Œæ•´çš„è¨­å®šè³‡è¨Š', 'error');
                return;
            }
            
            // é©—è­‰ç¶²å€æ ¼å¼
            try {
                new URL(newSettings.checkinUrl);
            } catch (e) {
                showMessage('âŒ è«‹è¼¸å…¥æœ‰æ•ˆçš„ç¶²å€æ ¼å¼', 'error');
                return;
            }
            
            // å„²å­˜è¨­å®š
            settings = newSettings;
            localStorage.setItem('ios_checkin_settings', JSON.stringify(settings));
            
            showMessage('âœ… è¨­å®šå·²å„²å­˜ï¼', 'success');
        }

        // è¼‰å…¥è¨­å®š
        function loadSettings() {
            try {
                const saved = localStorage.getItem('ios_checkin_settings');
                if (saved) {
                    settings = JSON.parse(saved);
                    
                    // æ›´æ–° UI
                    document.getElementById('checkinUrl').value = settings.checkinUrl;
                    document.getElementById('companyName').value = settings.companyName;
                    document.getElementById('checkinTime').value = settings.checkinTime;
                }
            } catch (error) {
                console.error('è¼‰å…¥è¨­å®šå¤±æ•—:', error);
            }
        }

        // è¤‡è£½åˆ°å‰ªè²¼ç°¿
        async function copyToClipboard(text) {
            try {
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(text);
                } else {
                    // å‚™ç”¨æ–¹æ³•
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    textArea.remove();
                }
            } catch (error) {
                console.error('è¤‡è£½å¤±æ•—:', error);
            }
        }

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(message, type = 'info') {
            const messageHtml = `
                <div class="status-message status-${type} fade-in">
                    ${message}
                </div>
            `;
            
            document.getElementById('statusArea').innerHTML = messageHtml;
            
            // 8ç§’å¾Œè‡ªå‹•æ¸…é™¤
            setTimeout(() => {
                clearStatus();
            }, 8000);
        }

        // æ¸…é™¤ç‹€æ…‹
        function clearStatus() {
            document.getElementById('statusArea').innerHTML = '';
        }

        // Service Worker è¨»å†Š (ç‚ºäº† PWA æ”¯æ´)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript,console.log("iOS PWA Service Worker")');
        }

        console.log('ğŸ iOS åŸç”Ÿæ‰“å¡åŠ©æ‰‹å·²å®Œå…¨è¼‰å…¥');
    </script>
</body>
</html>
