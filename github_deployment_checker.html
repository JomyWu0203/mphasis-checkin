<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub 部署檢查器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 10px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 1.6rem;
            margin-bottom: 10px;
        }

        .status-box {
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            font-weight: 500;
        }

        .status-success {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid #4CAF50;
            color: #2e7d32;
        }

        .status-error {
            background: rgba(244, 67, 54, 0.1);
            border: 2px solid #f44336;
            color: #c62828;
        }

        .status-warning {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid #ffc107;
            color: #f57f17;
        }

        .status-checking {
            background: rgba(33, 150, 243, 0.1);
            border: 2px solid #2196F3;
            color: #1976D2;
        }

        .button {
            width: 100%;
            padding: 14px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 12px;
        }

        .button-primary {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .button-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .button-warning {
            background: linear-gradient(45deg, #ff9800, #f57c00);
            color: white;
        }

        .button:active {
            transform: scale(0.98);
        }

        .url-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 0.9rem;
        }

        .url-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .file-check {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .file-name {
            font-family: monospace;
            font-size: 0.9rem;
        }

        .file-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .file-exists {
            background: #d4edda;
            color: #155724;
        }

        .file-missing {
            background: #f8d7da;
            color: #721c24;
        }

        .file-checking {
            background: #d1ecf1;
            color: #0c5460;
        }

        .step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 16px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .step-number {
            background: #4CAF50;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
            font-size: 0.9rem;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 4px;
        }

        .step-description {
            color: #555;
            font-size: 0.9rem;
            line-height: 1.3;
        }

        .code-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            font-family: monospace;
            font-size: 0.85rem;
            margin: 10px 0;
            word-break: break-all;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 12px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s ease;
        }

        .quick-fix {
            background: rgba(33, 150, 243, 0.1);
            border: 2px solid #2196F3;
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
        }

        .quick-fix h3 {
            color: #1976D2;
            margin-bottom: 8px;
        }

        .quick-fix p {
            color: #1565c0;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card header">
            <h1>🔍 GitHub 部署檢查器</h1>
            <p>檢測並修復 404 錯誤</p>
        </div>

        <!-- 檢查輸入 -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: #2c3e50;">📝 輸入您的 GitHub 資訊</h3>
            
            <label style="display: block; margin-bottom: 8px; font-weight: bold;">GitHub 用戶名：</label>
            <input type="text" id="githubUsername" class="url-input" placeholder="例如：jomywu0203" value="jomywu0203">
            
            <label style="display: block; margin-bottom: 8px; font-weight: bold;">Repository 名稱：</label>
            <input type="text" id="repoName" class="url-input" placeholder="例如：mphasis-checkin" value="mphasis-checkin">
            
            <button class="button button-primary" onclick="checkDeployment()">
                🔍 檢查部署狀態
            </button>
        </div>

        <!-- 檢查進度 -->
        <div class="card hidden" id="progressCard">
            <h3 style="margin-bottom: 16px; color: #2c3e50;">⏳ 檢查進度</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="progressText">正在檢查...</div>
        </div>

        <!-- 檢查結果 -->
        <div class="card hidden" id="resultCard">
            <h3 style="margin-bottom: 16px; color: #2c3e50;">📋 檢查結果</h3>
            <div id="checkResults"></div>
        </div>

        <!-- 修復建議 -->
        <div class="card hidden" id="fixCard">
            <h3 style="margin-bottom: 16px; color: #2c3e50;">🛠️ 修復建議</h3>
            <div id="fixSuggestions"></div>
        </div>

        <!-- 快速修復 -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: #2c3e50;">⚡ 常見 404 問題快速修復</h3>
            
            <div class="quick-fix">
                <h3>🔧 問題一：檔案未上傳</h3>
                <p>確認您已將以下檔案上傳到 GitHub repository：</p>
                <div class="code-box">
                    mobile_checkin_simplified.html<br>
                    simplified_configuration_profile.mobileconfig<br>
                    alternative_installer.html
                </div>
            </div>

            <div class="quick-fix">
                <h3>🔧 問題二：GitHub Pages 未啟用</h3>
                <p>前往 Repository → Settings → Pages → Source → Deploy from a branch</p>
            </div>

            <div class="quick-fix">
                <h3>🔧 問題三：檔案名稱不匹配</h3>
                <p>確認配置文件中的 URL 與實際檔案名稱完全一致</p>
            </div>

            <button class="button button-secondary" onclick="generateCorrectConfig()">
                📄 生成正確的配置文件
            </button>
            
            <button class="button button-warning" onclick="showManualFix()">
                🔧 手動修復步驟
            </button>
        </div>

        <!-- 手動修復步驟 -->
        <div class="card hidden" id="manualFixCard">
            <h3 style="margin-bottom: 16px; color: #2c3e50;">📋 手動修復步驟</h3>
            
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-title">檢查檔案是否存在</div>
                    <div class="step-description">確認 mobile_checkin_simplified.html 已上傳到您的 GitHub repository</div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-title">啟用 GitHub Pages</div>
                    <div class="step-description">Repository → Settings → Pages → Source: Deploy from a branch → Branch: main</div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-title">修正配置文件中的 URL</div>
                    <div class="step-description">確認 .mobileconfig 檔案中的 URL 指向正確的 GitHub Pages 地址</div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <div class="step-title">等待部署完成</div>
                    <div class="step-description">GitHub Pages 部署可能需要 5-10 分鐘，請耐心等待</div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">5</div>
                <div class="step-content">
                    <div class="step-title">重新安裝配置文件</div>
                    <div class="step-description">刪除舊的配置文件，重新下載並安裝修正後的版本</div>
                </div>
            </div>
        </div>

        <!-- 生成的配置文件 -->
        <div class="card hidden" id="generatedConfigCard">
            <h3 style="margin-bottom: 16px; color: #2c3e50;">📄 修正後的配置文件</h3>
            <div id="generatedConfigContent"></div>
            <button class="button button-primary" onclick="downloadCorrectConfig()">
                📥 下載修正後的配置文件
            </button>
        </div>
    </div>

    <script>
        let generatedConfig = '';
        
        // 檢查部署狀態
        async function checkDeployment() {
            const username = document.getElementById('githubUsername').value.trim();
            const repo = document.getElementById('repoName').value.trim();
            
            if (!username || !repo) {
                alert('請輸入 GitHub 用戶名和 Repository 名稱');
                return;
            }
            
            // 顯示進度卡片
            document.getElementById('progressCard').classList.remove('hidden');
            document.getElementById('resultCard').classList.add('hidden');
            document.getElementById('fixCard').classList.add('hidden');
            
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            const filesToCheck = [
                'mobile_checkin_simplified.html',
                'simplified_configuration_profile.mobileconfig',
                'alternative_installer.html'
            ];
            
            const results = [];
            let progress = 0;
            
            for (let i = 0; i < filesToCheck.length; i++) {
                const file = filesToCheck[i];
                progress = ((i + 1) / filesToCheck.length) * 100;
                progressFill.style.width = progress + '%';
                progressText.textContent = `檢查檔案：${file}`;
                
                const exists = await checkFileExists(username, repo, file);
                results.push({ file, exists });
                
                await new Promise(resolve => setTimeout(resolve, 500)); // 延遲以顯示進度
            }
            
            // 檢查 GitHub Pages 狀態
            progressText.textContent = '檢查 GitHub Pages 狀態...';
            const pagesEnabled = await checkGitHubPages(username, repo);
            
            // 顯示結果
            displayResults(results, pagesEnabled, username, repo);
        }
        
        // 檢查檔案是否存在
        async function checkFileExists(username, repo, filename) {
            try {
                const url = `https://api.github.com/repos/${username}/${repo}/contents/${filename}`;
                const response = await fetch(url);
                return response.status === 200;
            } catch (error) {
                console.error('檢查檔案失敗:', error);
                return false;
            }
        }
        
        // 檢查 GitHub Pages 狀態
        async function checkGitHubPages(username, repo) {
            try {
                const url = `https://${username}.github.io/${repo}/mobile_checkin_simplified.html`;
                const response = await fetch(url, { mode: 'no-cors' });
                return true; // 如果沒有錯誤，假設頁面存在
            } catch (error) {
                return false;
            }
        }
        
        // 顯示檢查結果
        function displayResults(results, pagesEnabled, username, repo) {
            document.getElementById('progressCard').classList.add('hidden');
            document.getElementById('resultCard').classList.remove('hidden');
            
            const resultsContainer = document.getElementById('checkResults');
            let html = '';
            
            // 檢查檔案結果
            results.forEach(result => {
                const statusClass = result.exists ? 'file-exists' : 'file-missing';
                const statusText = result.exists ? '✅ 存在' : '❌ 缺失';
                
                html += `
                    <div class="file-check">
                        <span class="file-name">${result.file}</span>
                        <span class="file-status ${statusClass}">${statusText}</span>
                    </div>
                `;
            });
            
            // GitHub Pages 狀態
            const pagesStatusClass = pagesEnabled ? 'status-success' : 'status-error';
            const pagesStatusText = pagesEnabled ? '✅ GitHub Pages 正常' : '❌ GitHub Pages 可能未啟用或部署中';
            
            html += `
                <div class="status-box ${pagesStatusClass}">
                    <strong>${pagesStatusText}</strong>
                </div>
            `;
            
            resultsContainer.innerHTML = html;
            
            // 生成修復建議
            generateFixSuggestions(results, pagesEnabled, username, repo);
        }
        
        // 生成修復建議
        function generateFixSuggestions(results, pagesEnabled, username, repo) {
            document.getElementById('fixCard').classList.remove('hidden');
            
            const fixContainer = document.getElementById('fixSuggestions');
            let suggestions = '';
            
            const missingFiles = results.filter(r => !r.exists);
            
            if (missingFiles.length > 0) {
                suggestions += `
                    <div class="status-box status-error">
                        <strong>❌ 缺失檔案：</strong><br>
                        ${missingFiles.map(f => f.file).join('<br>')}
                        <br><br>
                        請上傳這些檔案到您的 GitHub repository。
                    </div>
                `;
            }
            
            if (!pagesEnabled) {
                suggestions += `
                    <div class="status-box status-warning">
                        <strong>⚠️ GitHub Pages 問題：</strong><br>
                        請前往 Repository → Settings → Pages → 啟用 GitHub Pages
                    </div>
                `;
            }
            
            // 提供正確的 URL
            suggestions += `
                <div class="status-box status-success">
                    <strong>✅ 正確的檔案 URL：</strong><br>
                    <div class="code-box">
                        https://${username}.github.io/${repo}/mobile_checkin_simplified.html
                    </div>
                    請確認配置文件中的 URL 與此一致。
                </div>
            `;
            
            fixContainer.innerHTML = suggestions;
        }
        
        // 生成正確的配置文件
        function generateCorrectConfig() {
            const username = document.getElementById('githubUsername').value.trim();
            const repo = document.getElementById('repoName').value.trim();
            
            if (!username || !repo) {
                alert('請先輸入 GitHub 用戶名和 Repository 名稱');
                return;
            }
            
            const correctUrl = `https://${username}.github.io/${repo}/mobile_checkin_simplified.html`;
            
            generatedConfig = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <!-- 配置文件主要資訊 -->
    <key>PayloadDisplayName</key>
    <string>Mphasis 簡化打卡系統</string>
    <key>PayloadDescription</key>
    <string>Mphasis CheckIN 簡化版打卡系統 - 無需帳號密碼，可自訂設定</string>
    <key>PayloadIdentifier</key>
    <string>com.mphasis.checkin.simplified</string>
    <key>PayloadOrganization</key>
    <string>Mphasis Limited</string>
    <key>PayloadRemovalDisallowed</key>
    <false/>
    <key>PayloadType</key>
    <string>Configuration</string>
    <key>PayloadUUID</key>
    <string>${generateUUID()}</string>
    <key>PayloadVersion</key>
    <integer>1</integer>
    <key>PayloadScope</key>
    <string>User</string>
    
    <!-- 配置內容 -->
    <key>PayloadContent</key>
    <array>
        <!-- Web Clip 配置 -->
        <dict>
            <key>PayloadType</key>
            <string>com.apple.webClip.managed</string>
            <key>PayloadVersion</key>
            <integer>1</integer>
            <key>PayloadIdentifier</key>
            <string>com.mphasis.checkin.webclip.simplified</string>
            <key>PayloadUUID</key>
            <string>${generateUUID()}</string>
            <key>PayloadDisplayName</key>
            <string>Mphasis 簡化打卡</string>
            <key>PayloadDescription</key>
            <string>Mphasis CheckIN 簡化版打卡系統 Web Clip</string>
            
            <!-- Web Clip 設定 -->
            <key>Label</key>
            <string>Mphasis簡化打卡</string>
            <key>URL</key>
            <string>${correctUrl}</string>
            <key>IsRemovable</key>
            <true/>
            <key>FullScreen</key>
            <true/>
            <key>Precomposed</key>
            <false/>
        </dict>
    </array>
</dict>
</plist>`;
            
            document.getElementById('generatedConfigContent').innerHTML = `
                <div class="status-box status-success">
                    ✅ 配置文件已生成，使用正確的 GitHub Pages URL
                </div>
                <div class="code-box" style="max-height: 200px; overflow-y: auto;">
                    ${generatedConfig.substring(0, 500)}...
                </div>
                <p><strong>正確的應用 URL：</strong></p>
                <div class="code-box">${correctUrl}</div>
            `;
            
            document.getElementById('generatedConfigCard').classList.remove('hidden');
        }
        
        // 下載正確的配置文件
        function downloadCorrectConfig() {
            if (!generatedConfig) {
                alert('請先生成配置文件');
                return;
            }
            
            const blob = new Blob([generatedConfig], { type: 'application/x-apple-aspen-config' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'corrected_configuration_profile.mobileconfig';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('✅ 修正後的配置文件已下載！\\n\\n請：\\n1. 刪除舊的配置文件\\n2. 安裝新的配置文件\\n3. 確認 HTML 檔案已上傳到 GitHub');
        }
        
        // 顯示手動修復步驟
        function showManualFix() {
            document.getElementById('manualFixCard').classList.toggle('hidden');
        }
        
        // 生成 UUID
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }
        
        // 頁面載入時自動設定用戶資訊（如果有的話）
        document.addEventListener('DOMContentLoaded', function() {
            // 可以從 URL 參數或其他方式獲取用戶資訊
            const urlParams = new URLSearchParams(window.location.search);
            const username = urlParams.get('username');
            const repo = urlParams.get('repo');
            
            if (username) document.getElementById('githubUsername').value = username;
            if (repo) document.getElementById('repoName').value = repo;
        });
    </script>
</body>
</html>

