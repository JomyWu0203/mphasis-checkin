<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ğŸ† iOS çµ‚æ¥µæ‰“å¡è§£æ±ºæ–¹æ¡ˆ</title>
    
    <!-- iOS PWA å„ªåŒ– -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="çµ‚æ¥µæ‰“å¡">
    <meta name="theme-color" content="#FF6B35">
    
    <style>
        :root {
            --primary-color: #FF6B35;
            --secondary-color: #F7931E;
            --success-color: #34C759;
            --danger-color: #FF3B30;
            --info-color: #007AFF;
            --warning-color: #FF9500;
            --gray-color: #8E8E93;
            --light-gray: #F2F2F7;
            --gold-color: #FFD700;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            background: var(--light-gray);
            color: #000;
            min-height: 100vh;
            padding: env(safe-area-inset-top) 16px env(safe-area-inset-bottom) 16px;
        }

        .container {
            max-width: 390px;
            margin: 0 auto;
        }

        /* æ¨™é¡Œå€åŸŸ */
        .header {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-align: center;
            padding: 24px 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(255, 107, 53, 0.3);
            position: relative;
        }

        .header::before {
            content: 'ğŸ†';
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 30px;
            background: var(--gold-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: spin 3s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        /* å¡ç‰‡æ¨£å¼ */
        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #000;
            display: flex;
            align-items: center;
        }

        .card-title .icon {
            margin-right: 8px;
            font-size: 22px;
        }

        /* æ™‚é–“é¡¯ç¤º */
        .time-display {
            text-align: center;
            padding: 20px;
        }

        .current-time {
            font-size: 36px;
            font-weight: 200;
            color: #000;
            margin-bottom: 6px;
            font-feature-settings: "tnum";
        }

        .current-date {
            font-size: 15px;
            color: var(--gray-color);
            margin-bottom: 12px;
        }

        .next-checkin {
            background: var(--info-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
        }

        /* å‰æ™¯ä¿æŒç‹€æ…‹ */
        .foreground-status {
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            text-align: center;
            border: 2px solid;
            position: relative;
        }

        .foreground-active {
            background: #E8F5E8;
            color: #1B5E20;
            border-color: var(--success-color);
            animation: pulse-green 2s infinite;
        }

        .foreground-inactive {
            background: #FFEBEE;
            color: #C62828;
            border-color: var(--danger-color);
            animation: pulse-red 2s infinite;
        }

        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(52, 199, 89, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(52, 199, 89, 0); }
            100% { box-shadow: 0 0 0 0 rgba(52, 199, 89, 0); }
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 59, 48, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0); }
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn {
            display: block;
            width: 100%;
            padding: 16px 20px;
            font-size: 17px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            margin: 12px 0;
            text-decoration: none;
            text-align: center;
            cursor: pointer;
            touch-action: manipulation;
            -webkit-appearance: none;
            transition: all 0.2s ease;
            position: relative;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 199, 89, 0.3);
        }

        .btn-info {
            background: var(--info-color);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 149, 0, 0.3);
        }

        .btn-gold {
            background: linear-gradient(45deg, var(--gold-color), #FFA500);
            color: #000;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .btn:active {
            transform: scale(0.98);
            opacity: 0.8;
        }

        /* ç³»çµ±è§£æ±ºæ–¹æ¡ˆç¶²æ ¼ */
        .solution-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 20px 0;
        }

        .solution-card {
            background: #F8F9FA;
            border: 2px solid #E5E5EA;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .solution-card:hover {
            border-color: var(--primary-color);
            background: rgba(255, 107, 53, 0.05);
        }

        .solution-card .icon {
            font-size: 32px;
            margin-bottom: 8px;
            display: block;
        }

        .solution-card .title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .solution-card .desc {
            font-size: 11px;
            color: var(--gray-color);
            line-height: 1.2;
        }

        /* èƒŒæ™¯é™åˆ¶èªªæ˜ */
        .limitation-warning {
            background: linear-gradient(45deg, #FFF3E0, #FFE0B2);
            border: 2px solid var(--warning-color);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .limitation-warning h3 {
            color: #E65100;
            margin-bottom: 12px;
        }

        .limitation-warning p {
            color: #BF360C;
            line-height: 1.5;
            font-size: 14px;
        }

        /* å‰æ™¯ä¿æŒè¨ˆæ™‚å™¨ */
        .stay-active-timer {
            text-align: center;
            padding: 20px;
            background: linear-gradient(45deg, #E3F2FD, #BBDEFB);
            border-radius: 12px;
            border: 2px solid var(--info-color);
            margin: 16px 0;
        }

        .timer-display {
            font-size: 48px;
            font-weight: 200;
            color: var(--info-color);
            margin-bottom: 8px;
            font-family: monospace;
        }

        .timer-label {
            color: #0D47A1;
            font-weight: 600;
        }

        /* ç‹€æ…‹æŒ‡ç¤ºå™¨ */
        .status {
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            text-align: center;
            font-weight: 500;
        }

        .status-success {
            background: #E8F5E8;
            color: #1B5E20;
            border: 2px solid var(--success-color);
        }

        .status-info {
            background: #E3F2FD;
            color: #0D47A1;
            border: 2px solid var(--info-color);
        }

        .status-warning {
            background: #FFF3E0;
            color: #E65100;
            border: 2px solid var(--warning-color);
        }

        .status-error {
            background: #FFEBEE;
            color: #C62828;
            border: 2px solid var(--danger-color);
        }

        /* å¿«é€Ÿè¨­å®šé¢æ¿ */
        .quick-setup {
            background: linear-gradient(45deg, #F3E5F5, #E1BEE7);
            border: 2px solid #8A2BE2;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .quick-setup h3 {
            color: #4A148C;
            margin-bottom: 16px;
            text-align: center;
        }

        .time-input-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 12px 0;
        }

        .time-input-group label {
            font-weight: 600;
            color: #6A1B9A;
            flex: 1;
        }

        .time-input-group input,
        .time-input-group select {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #BA68C8;
            border-radius: 8px;
            font-size: 16px;
            -webkit-appearance: none;
        }

        /* å¿«é€Ÿé€±é–“é¸æ“‡å™¨ */
        .quick-week-selector {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            margin: 8px 0;
        }

        .quick-day-btn {
            padding: 10px 6px;
            font-size: 13px;
            font-weight: 600;
            border: 2px solid #BA68C8;
            border-radius: 8px;
            background: white;
            color: #6A1B9A;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }

        .quick-day-btn.selected {
            background: #8A2BE2;
            color: white;
            border-color: #8A2BE2;
            transform: scale(1.05);
        }

        .quick-day-btn:active {
            transform: scale(0.95);
        }

        .btn-link {
            background: none !important;
            border: none !important;
            text-decoration: underline;
            cursor: pointer;
            font-size: 12px;
            color: #8A2BE2;
            padding: 4px 8px;
        }

        .btn-link:hover {
            opacity: 0.8;
        }

        /* è‡ªå‹•æ‰“å¡ä»‹é¢æ¨£å¼ */
        .auto-checkin-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auto-checkin-modal {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 340px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auto-checkin-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .auto-checkin-header h2 {
            color: #6A1B9A;
            font-size: 20px;
            margin-bottom: 8px;
        }

        .auto-checkin-source {
            color: #8A2BE2;
            font-size: 14px;
            font-weight: 500;
        }

        .auto-checkin-content {
            text-align: center;
        }

        .auto-checkin-status {
            color: #333;
            font-size: 16px;
            margin-bottom: 16px;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .auto-checkin-progress {
            background: #F0F0F0;
            border-radius: 8px;
            height: 8px;
            margin-bottom: 24px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, #8A2BE2, #BA68C8);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 8px;
        }

        .auto-checkin-actions {
            display: flex;
            gap: 12px;
            flex-direction: column;
        }

        .auto-checkin-actions .btn {
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .auto-checkin-actions .btn-primary {
            background: linear-gradient(135deg, #8A2BE2, #BA68C8);
            color: white;
        }

        .auto-checkin-actions .btn-primary:active {
            transform: scale(0.98);
        }

        .auto-checkin-actions .btn-secondary {
            background: #F0F0F0;
            color: #666;
        }

        #autoCheckinInterface {
            display: none;
        }

        /* éš±è—é¡ */
        .hidden {
            display: none !important;
        }

        /* å‹•ç•«æ•ˆæœ */
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* å…¨å±æé†’æ¨£å¼ */
        .fullscreen-reminder {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-color);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            text-align: center;
            padding: 20px;
        }

        .reminder-clock {
            font-size: 120px;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        .reminder-text {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .reminder-actions {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }

        .reminder-btn {
            padding: 20px 40px;
            font-size: 20px;
            font-weight: 700;
            border: 3px solid white;
            border-radius: 15px;
            background: transparent;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .reminder-btn.primary {
            background: white;
            color: var(--primary-color);
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¨™é¡Œ -->
        <div class="header">
            <h1>ğŸ† çµ‚æ¥µæ‰“å¡è§£æ±ºæ–¹æ¡ˆ</h1>
            <p>çªç ´ iOS èƒŒæ™¯é™åˆ¶çš„å®Œç¾æ–¹æ¡ˆ</p>
        </div>

        <!-- æ™‚é–“é¡¯ç¤º -->
        <div class="card">
            <div class="time-display">
                <div class="current-time" id="timeDisplay">--:--</div>
                <div class="current-date" id="dateDisplay">è¼‰å…¥ä¸­...</div>
                <div class="next-checkin" id="nextCheckin">ä¸‹æ¬¡æ‰“å¡ï¼šæœªè¨­å®š</div>
            </div>
        </div>

        <!-- å‰æ™¯ç‹€æ…‹ç›£æ§ -->
        <div class="card">
            <div class="card-title">
                <span class="icon">ğŸ“±</span>
                æ‡‰ç”¨ç‹€æ…‹ç›£æ§
            </div>
            
            <div id="foregroundStatus" class="foreground-status foreground-inactive">
                ğŸ” æ­£åœ¨æª¢æ¸¬æ‡‰ç”¨ç‹€æ…‹...
            </div>
            
            <div class="stay-active-timer">
                <div class="timer-display" id="activeTimer">--:--</div>
                <div class="timer-label">å‰æ™¯æ´»èºæ™‚é–“</div>
            </div>
        </div>

        <!-- æ™ºæ…§é€£å‹•èªªæ˜ -->
        <div class="card" style="background: linear-gradient(135deg, #E8F5E8, #C8E6C9); border: 2px solid #4CAF50; margin-bottom: 16px;">
            <div class="card-title" style="color: #2E7D32;">
                <span class="icon">ğŸ”—</span>
                æ™ºæ…§è¡Œäº‹æ›†é€£å‹•ç³»çµ±
            </div>
            <div style="color: #1B5E20; line-height: 1.6;">
                <p><strong>ğŸ¯ å®Œæ•´è‡ªå‹•åŒ–æµç¨‹ï¼š</strong></p>
                <div style="margin: 12px 0; padding: 12px; background: rgba(76, 175, 80, 0.1); border-radius: 8px; font-size: 14px;">
                    <strong>1ï¸âƒ£ è¨­å®šé€±é–“æ’ç¨‹</strong> â†’ é¸æ“‡è¦æ‰“å¡çš„æ˜ŸæœŸå¹¾<br>
                    <strong>2ï¸âƒ£ ç”Ÿæˆæ™ºæ…§æ—¥æ›†</strong> â†’ åŒ…å«è‡ªå‹•å–šé†’é€£çµ<br>
                    <strong>3ï¸âƒ£ iOS æé†’è§¸ç™¼</strong> â†’ ç³»çµ±åœ¨è¨­å®šæ™‚é–“ç™¼é€é€šçŸ¥<br>
                    <strong>4ï¸âƒ£ é»æ“Šé€šçŸ¥å–šé†’</strong> â†’ è‡ªå‹•é–‹å•Ÿæ‰“å¡æ‡‰ç”¨<br>
                    <strong>5ï¸âƒ£ æ™ºæ…§æ‰“å¡åŸ·è¡Œ</strong> â†’ æª¢æ¸¬æ™‚é–“ä¸¦é–‹å•Ÿæ‰“å¡é é¢<br>
                    <strong>6ï¸âƒ£ Teams é€šçŸ¥</strong> â†’ è‡ªå‹•ç™¼é€åŸ·è¡Œç‹€æ…‹åˆ° Teams
                </div>
                <p><strong>ğŸš€ æ ¸å¿ƒå„ªå‹¢ï¼š</strong></p>
                <ul style="margin: 8px 0 0 20px; font-size: 14px;">
                    <li>âœ… å®Œå…¨ç¹é Safari èƒŒæ™¯é™åˆ¶</li>
                    <li>âœ… ä½¿ç”¨ iOS åŸç”Ÿç³»çµ±æé†’</li>
                    <li>âœ… æ”¯æ´é€±é–“è‡ªå‹•æ’ç¨‹</li>
                    <li>âœ… æ™ºæ…§æª¢æ¸¬æ‰“å¡æ™‚é–“</li>
                    <li>âœ… è‡ªå‹•å–šé†’æ‡‰ç”¨åŸ·è¡Œ</li>
                    <li>âœ… Teams é€šçŸ¥æ•´åˆ</li>
                </ul>
            </div>
        </div>

        <!-- iOS èƒŒæ™¯é™åˆ¶èªªæ˜ -->
        <div class="limitation-warning">
            <h3>âš ï¸ ç‚ºä»€éº¼éœ€è¦è¡Œäº‹æ›†é€£å‹•ï¼Ÿ</h3>
            <p>
                <strong>iOS é™åˆ¶ï¼š</strong>Safari åœ¨èƒŒæ™¯æ¨¡å¼ä¸‹åªèƒ½åŸ·è¡Œ 5 åˆ†é˜ï¼Œç¶²é æé†’æœƒå¤±æ•ˆã€‚<br><br>
                
                <strong>é™åˆ¶è©³æƒ…ï¼š</strong><br>
                â€¢ ğŸ• èƒŒæ™¯æœ€å¤šåŸ·è¡Œ 5 åˆ†é˜<br>
                â€¢ ğŸ”‹ çœé›»æ¨¡å¼ä¸‹æ›´åš´æ ¼<br>
                â€¢ ğŸ’¾ è¨˜æ†¶é«”ä¸è¶³æ™‚ç«‹å³æš«åœ<br>
                â€¢ ğŸ”’ å®‰å…¨æ”¿ç­–é˜»æ­¢èƒŒæ™¯æ´»å‹•<br><br>
                
                <strong>è§£æ±ºæ–¹æ¡ˆï¼š</strong>è¡Œäº‹æ›†æé†’ â†’ é»æ“Šé€šçŸ¥ â†’ è‡ªå‹•é–‹å•Ÿæ‡‰ç”¨ â†’ åŸ·è¡Œæ‰“å¡ï¼
            </p>
        </div>

        <!-- å¿«é€Ÿè¨­å®š -->
        <div class="quick-setup">
            <h3>âš¡ å¿«é€Ÿè¨­å®šæ‰“å¡æ™‚é–“</h3>
            
            <div class="time-input-group">
                <label>æ‰“å¡æ™‚é–“ï¼š</label>
                <input type="time" id="quickCheckinTime" value="09:00">
            </div>
            
            <div class="time-input-group">
                <label>æå‰æé†’ï¼š</label>
                <select id="quickReminderTime">
                    <option value="5">5 åˆ†é˜</option>
                    <option value="10">10 åˆ†é˜</option>
                    <option value="15">15 åˆ†é˜</option>
                    <option value="30">30 åˆ†é˜</option>
                </select>
            </div>
            
            <!-- é€±é–“é¸æ“‡ -->
            <div style="margin: 16px 0;">
                <label style="display: block; font-weight: 600; color: #6A1B9A; margin-bottom: 8px;">æ‰“å¡æ—¥æœŸï¼š</label>
                <div class="quick-week-selector">
                    <div class="quick-day-btn" data-day="1" onclick="toggleQuickDay(1)">ä¸€</div>
                    <div class="quick-day-btn" data-day="2" onclick="toggleQuickDay(2)">äºŒ</div>
                    <div class="quick-day-btn" data-day="3" onclick="toggleQuickDay(3)">ä¸‰</div>
                    <div class="quick-day-btn" data-day="4" onclick="toggleQuickDay(4)">å››</div>
                    <div class="quick-day-btn" data-day="5" onclick="toggleQuickDay(5)">äº”</div>
                    <div class="quick-day-btn" data-day="6" onclick="toggleQuickDay(6)">å…­</div>
                    <div class="quick-day-btn" data-day="0" onclick="toggleQuickDay(0)">æ—¥</div>
                </div>
                <div style="margin-top: 8px;">
                    <button class="btn-link" onclick="selectWorkdays()" style="font-size: 12px; color: #8A2BE2; background: none; border: none; text-decoration: underline; cursor: pointer;">
                        ğŸ“… é¸æ“‡å·¥ä½œæ—¥ (ä¸€~äº”)
                    </button>
                    <button class="btn-link" onclick="selectAllDays()" style="font-size: 12px; color: #8A2BE2; background: none; border: none; text-decoration: underline; cursor: pointer; margin-left: 16px;">
                        ğŸ—“ï¸ é¸æ“‡å…¨éƒ¨ (ä¸€~æ—¥)
                    </button>
                </div>
            </div>
            
            <!-- å¸¸è¦‹å‡æ—¥æ’é™¤ -->
            <div style="margin: 16px 0;">
                <label style="display: block; font-weight: 600; color: #6A1B9A; margin-bottom: 8px;">
                    <input type="checkbox" id="quickExcludeHolidays" checked style="margin-right: 8px;">
                    è‡ªå‹•æ’é™¤åœ‹å®šå‡æ—¥
                </label>
                <div style="font-size: 12px; color: #8A2BE2; opacity: 0.8;">
                    åŒ…å«ï¼šå…ƒæ—¦ã€æ˜¥ç¯€ã€æ¸…æ˜ã€å‹å‹•ç¯€ã€ç«¯åˆã€ä¸­ç§‹ã€åœ‹æ…¶ç­‰
                </div>
            </div>
            
            <button class="btn btn-gold" onclick="quickSetup()">
                âš¡ ä¸€éµè¨­å®šæ‰€æœ‰æé†’
            </button>
            
            <div style="margin-top: 12px; font-size: 13px; color: #6A1B9A; text-align: center; opacity: 0.9;">
                ğŸ“‹ å°‡è‡ªå‹•è¨­å®šï¼šæ—¥æ›†äº‹ä»¶ + ç³»çµ±é¬§é˜ + Siri æ·å¾‘ + æé†’äº‹é …
            </div>
            
            <!-- æ¸¬è©¦è¡Œäº‹æ›†å–šé†’ -->
            <div style="margin-top: 16px; text-align: center;">
                <button class="btn btn-secondary" onclick="testCalendarWakeup()" style="font-size: 14px; padding: 8px 16px;">
                    ğŸ§ª æ¸¬è©¦è¡Œäº‹æ›†å–šé†’åŠŸèƒ½
                </button>
            </div>
        </div>

        <!-- ç³»çµ±ç´šè§£æ±ºæ–¹æ¡ˆ -->
        <div class="card">
            <div class="card-title">
                <span class="icon">ğŸ¯</span>
                ç³»çµ±ç´šæé†’æ–¹æ¡ˆ
            </div>
            
            <div class="status status-info">
                <strong>ğŸ’¡ æ ¸å¿ƒç­–ç•¥ï¼š</strong>ä¸ä¾è³´æ‡‰ç”¨èƒŒæ™¯åŸ·è¡Œï¼Œä½¿ç”¨ iOS ç³»çµ±åŠŸèƒ½ç¢ºä¿æé†’ï¼
            </div>
            
            <div class="solution-grid">
                <div class="solution-card" onclick="setupIOSCalendar()">
                    <span class="icon">ğŸ“…</span>
                    <div class="title">iOS æ—¥æ›†</div>
                    <div class="desc">ç³»çµ±æ—¥æ›†äº‹ä»¶<br>å¸¶é€šçŸ¥æé†’</div>
                </div>
                
                <div class="solution-card" onclick="setupIOSAlarms()">
                    <span class="icon">â°</span>
                    <div class="title">iOS é¬§é˜</div>
                    <div class="desc">ç³»çµ±é¬§é˜<br>æ¯æ—¥é‡è¤‡</div>
                </div>
                
                <div class="solution-card" onclick="setupSiriShortcuts()">
                    <span class="icon">ğŸ—£ï¸</span>
                    <div class="title">Siri æ·å¾‘</div>
                    <div class="desc">èªéŸ³æ§åˆ¶<br>è‡ªå‹•åŒ–æµç¨‹</div>
                </div>
                
                <div class="solution-card" onclick="setupReminders()">
                    <span class="icon">ğŸ“</span>
                    <div class="title">iOS æé†’äº‹é …</div>
                    <div class="desc">ç³»çµ±æé†’<br>æ™‚é–“è§¸ç™¼</div>
                </div>
            </div>
            
            <!-- Teams é€šçŸ¥æŒ‰éˆ• -->
            <div style="margin-top: 16px; text-align: center;">
                <button class="btn" onclick="toggleTeamsSettings()" style="background: linear-gradient(135deg, #0078D4, #106EBE); color: white; padding: 12px 24px;">
                    ğŸ“¤ è¨­å®š Teams é€šçŸ¥
                </button>
            </div>
        </div>

        <!-- Teams é€šçŸ¥è¨­å®š -->
        <div class="card" id="teamsSettings" style="display: none; margin-top: 16px;">
            <div class="card-title">
                <span class="icon">ğŸ“¤</span>
                Teams é€šçŸ¥è¨­å®š
            </div>
            
            <div style="margin: 16px 0;">
                <label style="display: flex; align-items: center; margin-bottom: 16px;">
                    <input type="checkbox" id="teamsEnabled" onchange="updateTeamsSettings()" style="margin-right: 8px;">
                    <span style="font-weight: 600; color: #6A1B9A;">å•Ÿç”¨ Teams é€šçŸ¥</span>
                </label>
                
                <div id="teamsWebhookSettings" style="display: none;">
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-weight: 600; color: #6A1B9A; margin-bottom: 8px;">
                            ä¸»è¦ Webhook URL:
                        </label>
                        <input type="url" id="teamsWebhook" placeholder="https://outlook.office.com/webhook/..." 
                               style="width: 100%; padding: 8px 12px; border: 1px solid #BA68C8; border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-weight: 600; color: #6A1B9A; margin-bottom: 8px;">
                            å‚™ç”¨ Webhook URL (é¸å¡«):
                        </label>
                        <input type="url" id="teamsBackupWebhook" placeholder="https://outlook.office.com/webhook/..." 
                               style="width: 100%; padding: 8px 12px; border: 1px solid #BA68C8; border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-primary" onclick="saveTeamsSettings()" style="flex: 1;">
                            ğŸ’¾ å„²å­˜è¨­å®š
                        </button>
                        <button class="btn btn-secondary" onclick="testTeamsNotification()" style="flex: 1;">
                            ğŸ§ª æ¸¬è©¦é€šçŸ¥
                        </button>
                    </div>
                    
                    <div style="margin-top: 12px; padding: 12px; background: rgba(106, 27, 154, 0.1); border-radius: 8px; font-size: 13px; color: #6A1B9A;">
                        <strong>ğŸ’¡ å¦‚ä½•å–å¾— Teams Webhook URLï¼š</strong><br>
                        1. åœ¨ Teams é »é“ä¸­é»æ“Šã€Œ...ã€â†’ã€Œé€£æ¥å™¨ã€<br>
                        2. æœå°‹ã€ŒIncoming Webhookã€ä¸¦è¨­å®š<br>
                        3. è¼¸å…¥åç¨±ï¼šã€ŒMphasis æ‰“å¡é€šçŸ¥ã€<br>
                        4. è¤‡è£½ç”¢ç”Ÿçš„ Webhook URL
                    </div>
                </div>
            </div>
        </div>

        <!-- å‰æ™¯ä¿æŒæ–¹æ¡ˆ -->
        <div class="card">
            <div class="card-title">
                <span class="icon">ğŸ”„</span>
                å‰æ™¯ä¿æŒæ–¹æ¡ˆ
            </div>
            
            <div class="status status-warning">
                <strong>âš ï¸ å¯¦é©—æ€§æ–¹æ¡ˆï¼š</strong>å˜—è©¦ä¿æŒæ‡‰ç”¨åœ¨å‰æ™¯ï¼Œä½†ä¸ä¿è­‰æˆåŠŸï¼
            </div>
            
            <button class="btn btn-warning" onclick="startForegroundMode()">
                ğŸ”„ å•Ÿå‹•å‰æ™¯ä¿æŒæ¨¡å¼
            </button>
            
            <button class="btn btn-info" onclick="testForegroundReminder()">
                ğŸ§ª æ¸¬è©¦å‰æ™¯æé†’
            </button>
        </div>

        <!-- æ‰‹å‹•æ“ä½œ -->
        <div class="card">
            <div class="card-title">
                <span class="icon">ğŸ¯</span>
                ç«‹å³æ‰“å¡
            </div>
            
            <button class="btn btn-success" onclick="openCheckinPage()">
                ğŸ¯ é–‹å•Ÿæ‰“å¡é é¢
            </button>
            
            <div style="margin-top: 16px;">
                <button class="btn btn-primary" onclick="showCheckinReminder()">
                    ğŸ“¢ æ¨¡æ“¬æ‰“å¡æé†’
                </button>
            </div>
        </div>

        <!-- ç‹€æ…‹è¨Šæ¯å€åŸŸ -->
        <div id="statusArea"></div>
    </div>

    <!-- å…¨å±æé†’è¦†è“‹å±¤ -->
    <div class="fullscreen-reminder hidden" id="fullscreenReminder">
        <div class="reminder-clock">ğŸ•˜</div>
        <div class="reminder-text">æ‰“å¡æ™‚é–“åˆ°äº†ï¼</div>
        <div style="font-size: 18px; opacity: 0.9;">
            ç¾åœ¨æ˜¯ <span id="reminderTime">09:00</span>ï¼Œè©²å»æ‰“å¡äº†ï¼
        </div>
        <div class="reminder-actions">
            <button class="reminder-btn primary" onclick="openCheckinPage(); hideFullscreenReminder();">
                ç«‹å³æ‰“å¡
            </button>
            <button class="reminder-btn" onclick="snoozeReminder()">
                ç¨å¾Œæé†’
            </button>
            <button class="reminder-btn" onclick="hideFullscreenReminder()">
                é—œé–‰
            </button>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        var settings = {
            checkinTime: '09:00',
            reminderMinutes: 5,
            checkinUrl: 'https://enterprise-apps.mphasis.com/ess/v1/#/home',
            weeklyDays: [1, 2, 3, 4, 5], // é è¨­é€±ä¸€åˆ°é€±äº”
            excludeHolidays: true,
            teamsWebhook: '', // Teams Webhook URL
            teamsBackupWebhook: '', // å‚™ç”¨ Teams Webhook URL
            teamsEnabled: false // æ˜¯å¦å•Ÿç”¨ Teams é€šçŸ¥
        };
        
        var quickWeeklyDays = [1, 2, 3, 4, 5]; // å¿«é€Ÿè¨­å®šçš„é€±é–“é¸æ“‡

        var foregroundTimer = null;
        var activeStartTime = null;
        var visibilityChangeCount = 0;
        var reminderInterval = null;

        // åˆå§‹åŒ–
        function initApp() {
            console.log('ğŸ† iOS çµ‚æ¥µæ‰“å¡è§£æ±ºæ–¹æ¡ˆå•Ÿå‹•');
            loadSettings();
            updateTime();
            setInterval(updateTime, 1000);
            
            setupVisibilityMonitoring();
            startActiveTimer();
            updateQuickWeeklyDisplay();
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºè¡Œäº‹æ›†å–šé†’
            checkCalendarWakeup();
            
            // è¨­å®š URL Scheme è™•ç†å™¨
            setupURLSchemeHandler();
            
            showMessage('âœ… çµ‚æ¥µè§£æ±ºæ–¹æ¡ˆå·²å°±ç·’ï¼å»ºè­°ä½¿ç”¨ç³»çµ±ç´šæé†’æ–¹æ¡ˆã€‚', 'success');
        }

        // è¨­å®šå¯è¦‹æ€§ç›£æ§
        function setupVisibilityMonitoring() {
            // ç›£æ§é é¢å¯è¦‹æ€§è®ŠåŒ–
            document.addEventListener('visibilitychange', function() {
                visibilityChangeCount++;
                updateForegroundStatus();
                
                if (document.hidden) {
                    console.log('âš ï¸ æ‡‰ç”¨é€²å…¥èƒŒæ™¯æ¨¡å¼');
                    handleBackgroundMode();
                } else {
                    console.log('âœ… æ‡‰ç”¨å›åˆ°å‰æ™¯æ¨¡å¼');
                    handleForegroundMode();
                }
            });

            // ç›£æ§çª—å£ç„¦é»è®ŠåŒ–
            window.addEventListener('focus', function() {
                console.log('ğŸ¯ çª—å£ç²å¾—ç„¦é»');
                handleForegroundMode();
            });

            window.addEventListener('blur', function() {
                console.log('ğŸ˜´ çª—å£å¤±å»ç„¦é»');
                handleBackgroundMode();
            });

            // åˆå§‹ç‹€æ…‹æª¢æŸ¥
            updateForegroundStatus();
        }

        // è™•ç†èƒŒæ™¯æ¨¡å¼
        function handleBackgroundMode() {
            updateForegroundStatus();
            
            // å˜—è©¦ä¿æŒæœ€ä½é™åº¦çš„æ´»å‹•
            if (reminderInterval) {
                // ä½¿ç”¨ setTimeout è€Œä¸æ˜¯ setInterval ä¾†é¿å…è¢«æš«åœ
                scheduleNextCheck();
            }
        }

        // è™•ç†å‰æ™¯æ¨¡å¼
        function handleForegroundMode() {
            activeStartTime = Date.now();
            updateForegroundStatus();
            
            // é‡æ–°å•Ÿå‹•æ­£å¸¸çš„æª¢æŸ¥æ©Ÿåˆ¶
            if (reminderInterval) {
                clearInterval(reminderInterval);
                startForegroundReminderCheck();
            }
        }

        // æ›´æ–°å‰æ™¯ç‹€æ…‹é¡¯ç¤º
        function updateForegroundStatus() {
            var statusElement = document.getElementById('foregroundStatus');
            var isActive = !document.hidden && document.hasFocus();
            
            if (isActive) {
                statusElement.className = 'foreground-status foreground-active';
                statusElement.innerHTML = 'âœ… æ‡‰ç”¨åœ¨å‰æ™¯é‹è¡Œä¸­<br><small>åˆ‡æ›æ¬¡æ•¸ï¼š' + visibilityChangeCount + '</small>';
            } else {
                statusElement.className = 'foreground-status foreground-inactive';
                statusElement.innerHTML = 'âš ï¸ æ‡‰ç”¨åœ¨èƒŒæ™¯æ¨¡å¼<br><small>æé†’åŠŸèƒ½å¯èƒ½å—é™</small>';
            }
        }

        // å•Ÿå‹•æ´»èºè¨ˆæ™‚å™¨
        function startActiveTimer() {
            activeStartTime = Date.now();
            
            setInterval(function() {
                updateActiveTimer();
            }, 1000);
        }

        // æ›´æ–°æ´»èºè¨ˆæ™‚å™¨
        function updateActiveTimer() {
            if (!activeStartTime) {
                document.getElementById('activeTimer').textContent = '--:--';
                return;
            }
            
            var elapsed = Date.now() - activeStartTime;
            var minutes = Math.floor(elapsed / 60000);
            var seconds = Math.floor((elapsed % 60000) / 1000);
            
            var timeString = minutes.toString().padStart(2, '0') + ':' + 
                           seconds.toString().padStart(2, '0');
            
            document.getElementById('activeTimer').textContent = timeString;
            
            // è¶…é 5 åˆ†é˜é¡¯ç¤ºè­¦å‘Š
            if (minutes >= 5) {
                document.getElementById('activeTimer').style.color = 'var(--danger-color)';
            } else if (minutes >= 3) {
                document.getElementById('activeTimer').style.color = 'var(--warning-color)';
            } else {
                document.getElementById('activeTimer').style.color = 'var(--info-color)';
            }
        }

        // æ›´æ–°æ™‚é–“é¡¯ç¤º
        function updateTime() {
            try {
                var now = new Date();
                var hours = now.getHours().toString().padStart(2, '0');
                var minutes = now.getMinutes().toString().padStart(2, '0');
                var timeString = hours + ':' + minutes;
                
                var options = { 
                    year: 'numeric',
                    month: 'long', 
                    day: 'numeric',
                    weekday: 'long'
                };
                var dateString = now.toLocaleDateString('zh-TW', options);
                
                document.getElementById('timeDisplay').textContent = timeString;
                document.getElementById('dateDisplay').textContent = dateString;
                
                updateNextCheckinTime();
                checkForReminder();
            } catch (error) {
                console.error('æ™‚é–“æ›´æ–°å¤±æ•—:', error);
            }
        }

        // æ›´æ–°ä¸‹æ¬¡æ‰“å¡æ™‚é–“
        function updateNextCheckinTime() {
            var now = new Date();
            var today = new Date();
            var timeParts = settings.checkinTime.split(':');
            today.setHours(parseInt(timeParts[0]), parseInt(timeParts[1]), 0, 0);
            
            var nextCheckinElement = document.getElementById('nextCheckin');
            
            if (now < today) {
                nextCheckinElement.textContent = 'ä»Šæ—¥æ‰“å¡ï¼š' + settings.checkinTime;
                nextCheckinElement.style.background = 'var(--success-color)';
            } else {
                var tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                nextCheckinElement.textContent = 'æ˜æ—¥æ‰“å¡ï¼š' + settings.checkinTime;
                nextCheckinElement.style.background = 'var(--gray-color)';
            }
        }

        // æª¢æŸ¥æ˜¯å¦éœ€è¦æé†’
        function checkForReminder() {
            var now = new Date();
            var today = new Date();
            var timeParts = settings.checkinTime.split(':');
            today.setHours(parseInt(timeParts[0]), parseInt(timeParts[1]) - settings.reminderMinutes, 0, 0);
            
            // æª¢æŸ¥æ˜¯å¦åˆ°äº†æé†’æ™‚é–“ï¼ˆç²¾ç¢ºåˆ°åˆ†é˜ï¼‰
            if (Math.abs(now.getTime() - today.getTime()) < 30000) { // 30ç§’å…§
                triggerCheckinReminder();
            }
        }

        // è§¸ç™¼æ‰“å¡æé†’
        function triggerCheckinReminder() {
            console.log('ğŸ”” è§¸ç™¼æ‰“å¡æé†’');
            
            // å¦‚æœåœ¨å‰æ™¯ï¼Œé¡¯ç¤ºå…¨å±æé†’
            if (!document.hidden) {
                showFullscreenReminder();
            }
            
            // å˜—è©¦å¤šç¨®æé†’æ–¹å¼
            try {
                // èªéŸ³æé†’
                if ('speechSynthesis' in window) {
                    var utterance = new SpeechSynthesisUtterance('æ‰“å¡æ™‚é–“åˆ°äº†ï¼');
                    utterance.lang = 'zh-TW';
                    speechSynthesis.speak(utterance);
                }
                
                // æŒ¯å‹•æé†’
                if ('vibrate' in navigator) {
                    navigator.vibrate([500, 200, 500, 200, 500]);
                }
                
                // å˜—è©¦éŸ³æ•ˆ
                playAlertSound();
                
            } catch (error) {
                console.error('æé†’å¤±æ•—:', error);
            }
        }

        // é¡¯ç¤ºå…¨å±æé†’
        function showFullscreenReminder() {
            var reminderElement = document.getElementById('fullscreenReminder');
            document.getElementById('reminderTime').textContent = settings.checkinTime;
            reminderElement.classList.remove('hidden');
            
            // å˜—è©¦é€²å…¥å…¨è¢å¹•
            try {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                }
            } catch (error) {
                console.log('ç„¡æ³•é€²å…¥å…¨è¢å¹•:', error);
            }
        }

        // éš±è—å…¨å±æé†’
        function hideFullscreenReminder() {
            document.getElementById('fullscreenReminder').classList.add('hidden');
            
            // é€€å‡ºå…¨è¢å¹•
            try {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            } catch (error) {
                console.log('ç„¡æ³•é€€å‡ºå…¨è¢å¹•:', error);
            }
        }

        // å»¶é²æé†’
        function snoozeReminder() {
            hideFullscreenReminder();
            showMessage('â° å°‡åœ¨ 5 åˆ†é˜å¾Œå†æ¬¡æé†’', 'info');
            
            setTimeout(function() {
                if (!document.hidden) {
                    triggerCheckinReminder();
                }
            }, 5 * 60 * 1000);
        }

        // æ’­æ”¾æé†’éŸ³æ•ˆ
        function playAlertSound() {
            try {
                var audioContext = new (window.AudioContext || window.webkitAudioContext)();
                var oscillator = audioContext.createOscillator();
                var gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // æ’­æ”¾ä¸€å€‹éŸ¿äº®çš„æé†’éŸ³
                oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(1046, audioContext.currentTime + 0.2);
                oscillator.frequency.setValueAtTime(880, audioContext.currentTime + 0.4);
                
                gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.6);
            } catch (error) {
                console.error('éŸ³æ•ˆæ’­æ”¾å¤±æ•—:', error);
            }
        }

        // æª¢æŸ¥è¡Œäº‹æ›†å–šé†’
        function checkCalendarWakeup() {
            var urlParams = new URLSearchParams(window.location.search);
            var wakeupSource = urlParams.get('wakeup');
            var wakeupTime = urlParams.get('time');
            
            if (wakeupSource === 'calendar') {
                console.log('ğŸ”” è¡Œäº‹æ›†å–šé†’æª¢æ¸¬:', wakeupTime);
                showMessage('ğŸ”” è¡Œäº‹æ›†æé†’å–šé†’ï¼æº–å‚™è‡ªå‹•æ‰“å¡...', 'info');
                
                // å»¶é²åŸ·è¡Œè‡ªå‹•æ‰“å¡æµç¨‹ï¼Œè®“ä½¿ç”¨è€…çœ‹åˆ°æé†’
                setTimeout(() => {
                    executeAutoCheckin('calendar');
                }, 2000);
                
                return true;
            }
            
            // æª¢æŸ¥æ˜¯å¦ç‚º Siri æ·å¾‘å–šé†’
            if (wakeupSource === 'siri') {
                console.log('ğŸ—£ï¸ Siri æ·å¾‘å–šé†’æª¢æ¸¬');
                showMessage('ğŸ—£ï¸ Siri æ·å¾‘å–šé†’ï¼ç«‹å³åŸ·è¡Œæ‰“å¡...', 'info');
                setTimeout(() => {
                    executeAutoCheckin('siri');
                }, 1000);
                return true;
            }
            
            return false;
        }

        // è¨­å®š URL Scheme è™•ç†å™¨
        function setupURLSchemeHandler() {
            // ç›£è½ popstate äº‹ä»¶ï¼ˆè¿”å›æŒ‰éˆ•æˆ– URL è®ŠåŒ–ï¼‰
            window.addEventListener('popstate', function(event) {
                checkCalendarWakeup();
            });
            
            // ç›£è½ focus äº‹ä»¶ï¼ˆæ‡‰ç”¨å¾èƒŒæ™¯è¿”å›å‰æ™¯ï¼‰
            window.addEventListener('focus', function() {
                console.log('ğŸ“± æ‡‰ç”¨å›åˆ°å‰æ™¯');
                checkCalendarWakeup();
            });
            
            // ç›£è½ pageshow äº‹ä»¶ï¼ˆé é¢é¡¯ç¤ºï¼‰
            window.addEventListener('pageshow', function(event) {
                if (event.persisted) {
                    console.log('ğŸ“„ é é¢å¾ç·©å­˜æ¢å¾©');
                    checkCalendarWakeup();
                }
            });
        }

        // åŸ·è¡Œè‡ªå‹•æ‰“å¡æµç¨‹
        function executeAutoCheckin(source) {
            showMessage(`ğŸ¯ ${source === 'calendar' ? 'è¡Œäº‹æ›†' : 'Siri'} è§¸ç™¼è‡ªå‹•æ‰“å¡æµç¨‹...`, 'info');
            
            // é¡¯ç¤ºè‡ªå‹•æ‰“å¡ä»‹é¢
            showAutoCheckinInterface(source);
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºæœ‰æ•ˆæ‰“å¡æ™‚é–“
            if (isValidCheckinTime()) {
                // åŸ·è¡Œè‡ªå‹•æ‰“å¡é‚è¼¯
                performSmartCheckin(source);
            } else {
                showMessage('â° ç•¶å‰ä¸åœ¨è¨­å®šçš„æ‰“å¡æ™‚é–“ç¯„åœå…§', 'warning');
            }
        }

        // æª¢æŸ¥æ˜¯å¦ç‚ºæœ‰æ•ˆæ‰“å¡æ™‚é–“
        function isValidCheckinTime() {
            var now = new Date();
            var currentDay = now.getDay();
            var currentTime = now.getHours() * 60 + now.getMinutes();
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºè¨­å®šçš„æ‰“å¡æ—¥æœŸ
            if (!settings.weeklyDays.includes(currentDay)) {
                console.log('ä»Šå¤©ä¸æ˜¯è¨­å®šçš„æ‰“å¡æ—¥æœŸ');
                return false;
            }
            
            // æª¢æŸ¥æ˜¯å¦åœ¨æ‰“å¡æ™‚é–“ç¯„åœå…§ï¼ˆå‰å¾Œ30åˆ†é˜ï¼‰
            var checkinTimeParts = settings.checkinTime.split(':');
            var checkinTimeMinutes = parseInt(checkinTimeParts[0]) * 60 + parseInt(checkinTimeParts[1]);
            var timeDiff = Math.abs(currentTime - checkinTimeMinutes);
            
            if (timeDiff <= 30) {
                console.log('åœ¨æœ‰æ•ˆæ‰“å¡æ™‚é–“ç¯„åœå…§');
                return true;
            }
            
            console.log(`æ™‚é–“å·®ç•°: ${timeDiff} åˆ†é˜ï¼Œè¶…å‡ºç¯„åœ`);
            return false;
        }

        // é¡¯ç¤ºè‡ªå‹•æ‰“å¡ä»‹é¢
        function showAutoCheckinInterface(source) {
            var autoCheckinDiv = document.getElementById('autoCheckinInterface');
            if (!autoCheckinDiv) {
                autoCheckinDiv = document.createElement('div');
                autoCheckinDiv.id = 'autoCheckinInterface';
                autoCheckinDiv.innerHTML = `
                    <div class="auto-checkin-overlay">
                        <div class="auto-checkin-modal">
                            <div class="auto-checkin-header">
                                <h2>ğŸ¯ è‡ªå‹•æ‰“å¡åŸ·è¡Œä¸­</h2>
                                <div class="auto-checkin-source">
                                    ä¾†æºï¼š${source === 'calendar' ? 'ğŸ“… iOS è¡Œäº‹æ›†' : 'ğŸ—£ï¸ Siri æ·å¾‘'}
                                </div>
                            </div>
                            <div class="auto-checkin-content">
                                <div class="auto-checkin-status" id="autoCheckinStatus">
                                    æ­£åœ¨æº–å‚™æ‰“å¡...
                                </div>
                                <div class="auto-checkin-progress">
                                    <div class="progress-bar" id="autoCheckinProgress"></div>
                                </div>
                                <div class="auto-checkin-actions">
                                    <button class="btn btn-primary" onclick="proceedToCheckin()" id="proceedBtn">
                                        ğŸš€ ç«‹å³å‰å¾€æ‰“å¡
                                    </button>
                                    <button class="btn btn-secondary" onclick="closeAutoCheckin()" id="cancelBtn">
                                        âŒ å–æ¶ˆ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(autoCheckinDiv);
            }
            
            autoCheckinDiv.style.display = 'block';
        }

        // åŸ·è¡Œæ™ºæ…§æ‰“å¡
        function performSmartCheckin(source) {
            var statusElement = document.getElementById('autoCheckinStatus');
            var progressElement = document.getElementById('autoCheckinProgress');
            
            var steps = [
                { text: 'ğŸ” æª¢æŸ¥æ‰“å¡è¨­å®š...', progress: 25 },
                { text: 'ğŸ“± æº–å‚™é–‹å•Ÿæ‰“å¡é é¢...', progress: 50 },
                { text: 'ğŸ“¤ æº–å‚™ç™¼é€ Teams é€šçŸ¥...', progress: 75 },
                { text: 'ğŸ‰ è‡ªå‹•æ‰“å¡æµç¨‹å®Œæˆï¼', progress: 100 }
            ];
            
            var currentStep = 0;
            
            var stepInterval = setInterval(() => {
                if (currentStep < steps.length) {
                    var step = steps[currentStep];
                    statusElement.textContent = step.text;
                    progressElement.style.width = step.progress + '%';
                    currentStep++;
                } else {
                    clearInterval(stepInterval);
                    // æº–å‚™å®Œæˆï¼Œç›´æ¥åŸ·è¡Œæ‰“å¡
                    document.getElementById('proceedBtn').style.display = 'block';
                    document.getElementById('proceedBtn').textContent = 'ğŸš€ é–‹å•Ÿæ‰“å¡é é¢';
                }
            }, 800);
        }

        // å‰å¾€æ‰“å¡
        function proceedToCheckin() {
            closeAutoCheckin();
            
            // è¨˜éŒ„è‡ªå‹•æ‰“å¡äº‹ä»¶
            logAutoCheckinEvent();
            
            // ç™¼é€ Teams é–‹å§‹æ‰“å¡é€šçŸ¥
            sendTeamsNotification(
                'ğŸš€ è‡ªå‹•æ‰“å¡åŸ·è¡Œ',
                `è¡Œäº‹æ›†æé†’è§¸ç™¼è‡ªå‹•æ‰“å¡\næ™‚é–“ï¼š${new Date().toLocaleString()}\nå³å°‡é–‹å•Ÿæ‰“å¡é é¢`,
                'æé†’'
            );
            
            // é–‹å•Ÿæ‰“å¡é é¢
            window.open(settings.checkinUrl, '_blank');
            
            showMessage('ğŸš€ å·²é–‹å•Ÿæ‰“å¡é é¢ï¼Teams é€šçŸ¥å·²ç™¼é€ã€‚', 'success');
            
            // å»¶é²æª¢æŸ¥æ‰“å¡çµæœï¼ˆçµ¦ç”¨æˆ¶æ™‚é–“å®Œæˆæ‰“å¡ï¼‰
            setTimeout(() => {
                checkCheckinResult();
            }, 30000); // 30ç§’å¾Œæª¢æŸ¥
        }

        // é—œé–‰è‡ªå‹•æ‰“å¡ä»‹é¢
        function closeAutoCheckin() {
            var autoCheckinDiv = document.getElementById('autoCheckinInterface');
            if (autoCheckinDiv) {
                autoCheckinDiv.style.display = 'none';
            }
        }

        // è¨˜éŒ„è‡ªå‹•æ‰“å¡äº‹ä»¶
        function logAutoCheckinEvent() {
            var event = {
                timestamp: new Date().toISOString(),
                source: 'auto',
                checkinTime: settings.checkinTime,
                actualTime: new Date().toTimeString().substr(0, 5)
            };
            
            var logs = JSON.parse(localStorage.getItem('checkin_logs') || '[]');
            logs.push(event);
            
            // åªä¿ç•™æœ€è¿‘ 30 ç­†è¨˜éŒ„
            if (logs.length > 30) {
                logs = logs.slice(-30);
            }
            
            localStorage.setItem('checkin_logs', JSON.stringify(logs));
            console.log('ğŸ“ è‡ªå‹•æ‰“å¡äº‹ä»¶å·²è¨˜éŒ„:', event);
        }

        // æ¸¬è©¦è¡Œäº‹æ›†å–šé†’åŠŸèƒ½
        function testCalendarWakeup() {
            showMessage('ğŸ§ª æ¨¡æ“¬è¡Œäº‹æ›†å–šé†’æ¸¬è©¦...', 'info');
            
            // æ›´æ–° URL åŒ…å«æ¸¬è©¦åƒæ•¸
            var testUrl = window.location.href.split('?')[0] + '?wakeup=calendar&time=' + 
                         new Date().toTimeString().substr(0, 5).replace(':', '') + '&test=true';
            
            // å»¶é²åŸ·è¡Œï¼Œæ¨¡æ“¬çœŸå¯¦å–šé†’æƒ…å¢ƒ
            setTimeout(() => {
                history.pushState({}, '', testUrl);
                executeAutoCheckin('calendar');
            }, 1000);
        }

        // Teams é€šçŸ¥åŠŸèƒ½
        function sendTeamsNotification(title, message, level) {
            if (!settings.teamsEnabled || !settings.teamsWebhook) {
                console.log('Teams é€šçŸ¥å·²åœç”¨æˆ–æœªè¨­å®š Webhook');
                return Promise.resolve();
            }

            var levelColors = {
                "æˆåŠŸ": "00FF00",  // ç¶ è‰²
                "éŒ¯èª¤": "FF0000",  // ç´…è‰²
                "æé†’": "FFFF00"   // é»ƒè‰²
            };

            var currentTime = new Date().toLocaleString('zh-TW');
            var deviceName = navigator.userAgent.includes('iPhone') ? 'iPhone' : 
                           navigator.userAgent.includes('iPad') ? 'iPad' : 'iOS è£ç½®';
            var color = levelColors[level] || "00FF00";

            var payload = {
                "@type": "MessageCard",
                "@context": "http://schema.org/extensions",
                "themeColor": color,
                "title": title,
                "text": message,
                "sections": [{
                    "facts": [
                        {"name": "è£ç½®åç¨±", "value": deviceName},
                        {"name": "åŸ·è¡Œæ™‚é–“", "value": currentTime},
                        {"name": "ä¾†æº", "value": "iOS çµ‚æ¥µæ‰“å¡ç³»çµ±"}
                    ]
                }]
            };

            return sendTeamsWebhook(payload, settings.teamsWebhook)
                .catch(error => {
                    console.error('ä¸»è¦ Webhook ç™¼é€å¤±æ•—:', error);
                    if (settings.teamsBackupWebhook) {
                        console.log('å˜—è©¦å‚™ç”¨ Webhook...');
                        return sendTeamsWebhook(payload, settings.teamsBackupWebhook);
                    }
                    throw error;
                });
        }

        // ç™¼é€ Teams Webhook
        function sendTeamsWebhook(payload, webhookUrl) {
            return fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            })
            .then(response => {
                if (response.ok) {
                    console.log('âœ… Teams é€šçŸ¥ç™¼é€æˆåŠŸ');
                    showMessage('ğŸ“¤ Teams é€šçŸ¥ç™¼é€æˆåŠŸ', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            })
            .catch(error => {
                console.error('âŒ Teams é€šçŸ¥ç™¼é€å¤±æ•—:', error);
                showMessage('âŒ Teams é€šçŸ¥ç™¼é€å¤±æ•—', 'error');
                throw error;
            });
        }

        // æª¢æŸ¥æ‰“å¡çµæœ
        function checkCheckinResult() {
            // ç°¡å–®çš„æ‰“å¡çµæœæª¢æŸ¥é‚è¼¯
            // å¯¦éš›ä¸Šï¼Œç”±æ–¼è·¨åŸŸé™åˆ¶ï¼Œæˆ‘å€‘ç„¡æ³•ç›´æ¥æª¢æŸ¥æ‰“å¡ç¶²ç«™çš„ç‹€æ…‹
            // æ‰€ä»¥é€™è£¡ä¸»è¦æ˜¯ç™¼é€ä¸€å€‹å®Œæˆé€šçŸ¥
            
            sendTeamsNotification(
                'âœ… è‡ªå‹•æ‰“å¡æµç¨‹å®Œæˆ',
                `æ‰“å¡é é¢å·²é–‹å•Ÿ\næ™‚é–“ï¼š${new Date().toLocaleString()}\nè«‹ç¢ºèªæ‰“å¡æ˜¯å¦æˆåŠŸ\n\nğŸ’¡ ç”±æ–¼ç€è¦½å™¨å®‰å…¨é™åˆ¶ï¼Œç„¡æ³•è‡ªå‹•æª¢æ¸¬æ‰“å¡çµæœï¼Œè«‹æ‰‹å‹•ç¢ºèªæ‰“å¡ç‹€æ…‹ã€‚`,
                'æˆåŠŸ'
            );
        }

        // å¿«é€Ÿé€±é–“æ—¥æœŸåˆ‡æ›
        function toggleQuickDay(day) {
            var dayBtn = document.querySelector('.quick-day-btn[data-day="' + day + '"]');
            var index = quickWeeklyDays.indexOf(day);
            
            if (index > -1) {
                quickWeeklyDays.splice(index, 1);
                dayBtn.classList.remove('selected');
            } else {
                quickWeeklyDays.push(day);
                dayBtn.classList.add('selected');
            }
            
            console.log('å¿«é€Ÿè¨­å®šé€±é–“é¸æ“‡:', quickWeeklyDays);
        }

        // é¸æ“‡å·¥ä½œæ—¥ (é€±ä¸€åˆ°é€±äº”)
        function selectWorkdays() {
            quickWeeklyDays = [1, 2, 3, 4, 5];
            updateQuickWeeklyDisplay();
            showMessage('ğŸ“… å·²é¸æ“‡å·¥ä½œæ—¥ (é€±ä¸€åˆ°é€±äº”)', 'info');
        }

        // é¸æ“‡å…¨éƒ¨æ—¥æœŸ
        function selectAllDays() {
            quickWeeklyDays = [0, 1, 2, 3, 4, 5, 6];
            updateQuickWeeklyDisplay();
            showMessage('ğŸ—“ï¸ å·²é¸æ“‡å…¨éƒ¨æ—¥æœŸ (é€±ä¸€åˆ°é€±æ—¥)', 'info');
        }

        // æ›´æ–°å¿«é€Ÿé€±é–“é¡¯ç¤º
        function updateQuickWeeklyDisplay() {
            // æ¸…é™¤æ‰€æœ‰é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.quick-day-btn').forEach(function(btn) {
                btn.classList.remove('selected');
            });
            
            // è¨­å®šé¸ä¸­ç‹€æ…‹
            quickWeeklyDays.forEach(function(day) {
                var dayBtn = document.querySelector('.quick-day-btn[data-day="' + day + '"]');
                if (dayBtn) {
                    dayBtn.classList.add('selected');
                }
            });
        }

        // å¿«é€Ÿè¨­å®š
        function quickSetup() {
            var checkinTime = document.getElementById('quickCheckinTime').value;
            var reminderMinutes = parseInt(document.getElementById('quickReminderTime').value);
            var excludeHolidays = document.getElementById('quickExcludeHolidays').checked;
            
            if (!checkinTime) {
                showMessage('âŒ è«‹è¨­å®šæ‰“å¡æ™‚é–“', 'error');
                return;
            }
            
            if (quickWeeklyDays.length === 0) {
                showMessage('âŒ è«‹é¸æ“‡è‡³å°‘ä¸€å€‹æ‰“å¡æ—¥æœŸ', 'error');
                return;
            }
            
            // æ›´æ–°è¨­å®š
            settings.checkinTime = checkinTime;
            settings.reminderMinutes = reminderMinutes;
            settings.weeklyDays = quickWeeklyDays.slice(); // è¤‡è£½é™£åˆ—
            settings.excludeHolidays = excludeHolidays;
            saveSettings();
            
            var dayNames = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            var selectedDaysText = quickWeeklyDays.map(day => 'é€±' + dayNames[day]).join('ã€');
            
            showMessage('âš¡ å¿«é€Ÿè¨­å®šå®Œæˆï¼\n' +
                       'ğŸ• æ™‚é–“ï¼š' + checkinTime + '\n' +
                       'ğŸ“… æ—¥æœŸï¼š' + selectedDaysText + '\n' +
                       'â° æé†’ï¼šæå‰' + reminderMinutes + 'åˆ†é˜\n' +
                       'ğŸ–ï¸ å‡æ—¥ï¼š' + (excludeHolidays ? 'è‡ªå‹•æ’é™¤' : 'ä¸æ’é™¤'), 'success');
            
            // è‡ªå‹•é–‹å•Ÿæ‰€æœ‰ç³»çµ±è¨­å®š
            setTimeout(() => setupIOSCalendar(), 1000);
            setTimeout(() => setupIOSAlarms(), 3000);
            setTimeout(() => setupSiriShortcuts(), 5000);
            setTimeout(() => setupReminders(), 7000);
        }

        // è¨­å®š iOS æ—¥æ›†
        function setupIOSCalendar() {
            var timeParts = settings.checkinTime.split(':');
            var reminderHour = parseInt(timeParts[0]);
            var reminderMinute = parseInt(timeParts[1]) - settings.reminderMinutes;
            
            if (reminderMinute < 0) {
                reminderMinute += 60;
                reminderHour -= 1;
            }
            
            // è½‰æ›é€±é–“é¸æ“‡ç‚º iCal æ ¼å¼
            var dayMapping = ['SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'];
            var selectedDays = settings.weeklyDays.map(day => dayMapping[day]).join(',');
            
            // ç”Ÿæˆå–šé†’ URLï¼ˆç•¶å‰é é¢ + è¡Œäº‹æ›†å–šé†’åƒæ•¸ï¼‰
            var wakeupUrl = window.location.href.split('?')[0] + '?wakeup=calendar&time=' + 
                           reminderHour.toString().padStart(2, '0') + 
                           reminderMinute.toString().padStart(2, '0');
            
            var icalContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//iOSçµ‚æ¥µæ‰“å¡é€£å‹•ç³»çµ±//NONSGML//EN
BEGIN:VEVENT
SUMMARY:ğŸ¯ Mphasis è‡ªå‹•æ‰“å¡æé†’
DESCRIPTION:ğŸ”” æ™ºæ…§æ‰“å¡ç³»çµ±å•Ÿå‹•ï¼\\n\\nğŸ“± é»æ“Šæ­¤æé†’å°‡è‡ªå‹•é–‹å•Ÿæ‰“å¡æ‡‰ç”¨\\nğŸ¯ è‡ªå‹•å°èˆªåˆ°æ‰“å¡é é¢\\nâš¡ æ™ºæ…§æª¢æ¸¬æ‰“å¡ç‹€æ…‹\\n\\nğŸ”— è‡ªå‹•å–šé†’é€£çµï¼š${wakeupUrl}\\n\\nğŸ’¡ ä½¿ç”¨æ–¹å¼ï¼š\\n1. æ”¶åˆ°æé†’æ™‚é»æ“Šé€šçŸ¥\\n2. ç³»çµ±è‡ªå‹•é–‹å•Ÿæ‰“å¡æ‡‰ç”¨\\n3. è·Ÿéš¨æŒ‡å¼•å®Œæˆæ‰“å¡
DTSTART:${formatDateForICal(reminderHour, reminderMinute)}
DTEND:${formatDateForICal(reminderHour, reminderMinute + 15)}
RRULE:FREQ=WEEKLY;BYDAY=${selectedDays}
URL:${wakeupUrl}
BEGIN:VALARM
TRIGGER:-PT0M
ACTION:DISPLAY
DESCRIPTION:ğŸš€ ç«‹å³æ‰“å¡ï¼é»æ“Šé–‹å•Ÿæ™ºæ…§æ‰“å¡ç³»çµ±
URL:${wakeupUrl}
END:VALARM
BEGIN:VALARM
TRIGGER:-PT5M
ACTION:DISPLAY
DESCRIPTION:â° 5åˆ†é˜å¾Œéœ€è¦æ‰“å¡ï¼æº–å‚™é–‹å§‹
END:VALARM
END:VEVENT`;

            // å¦‚æœå•Ÿç”¨å‡æ—¥æ’é™¤ï¼ŒåŠ å…¥å‡æ—¥ä¾‹å¤–
            if (settings.excludeHolidays) {
                var currentYear = new Date().getFullYear();
                var holidays = [
                    currentYear + '0101', // å…ƒæ—¦
                    currentYear + '0210', // è¾²æ›†æ–°å¹´
                    currentYear + '0211',
                    currentYear + '0212',
                    currentYear + '0404', // å…’ç«¥ç¯€
                    currentYear + '0405', // æ¸…æ˜ç¯€
                    currentYear + '0501', // å‹å‹•ç¯€
                    currentYear + '0610', // ç«¯åˆç¯€
                    currentYear + '0917', // ä¸­ç§‹ç¯€
                    currentYear + '1010'  // åœ‹æ…¶æ—¥
                ];
                
                icalContent += '\nEXDATE:' + holidays.map(date => date + 'T' + 
                    reminderHour.toString().padStart(2, '0') + 
                    reminderMinute.toString().padStart(2, '0') + '00Z').join(',');
            }

            icalContent += '\nEND:VEVENT\nEND:VCALENDAR';
            
            var blob = new Blob([icalContent], { type: 'text/calendar' });
            var url = URL.createObjectURL(blob);
            
            var link = document.createElement('a');
            link.href = url;
            link.download = 'mphasis-smart-checkin-calendar.ics';
            link.click();
            
            var dayNames = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            var selectedDaysText = settings.weeklyDays.map(day => 'é€±' + dayNames[day]).join('ã€');
            
            showMessage('ğŸ“… æ™ºæ…§é€£å‹•æ—¥æ›†å·²ä¸‹è¼‰ï¼\n' +
                       'ğŸ”— è¡Œäº‹æ›†æé†’å°‡è‡ªå‹•å–šé†’æ‰“å¡æ‡‰ç”¨\n' +
                       'ğŸ“‹ è¨­å®šå…§å®¹ï¼š\n' +
                       'ğŸ• ' + settings.checkinTime + ' æ‰“å¡æé†’\n' +
                       'ğŸ“… ' + selectedDaysText + '\n' +
                       'ğŸ–ï¸ ' + (settings.excludeHolidays ? 'å·²æ’é™¤å‡æ—¥' : 'åŒ…å«å‡æ—¥') + '\n' +
                       'âš¡ æ™ºæ…§å–šé†’ï¼šè¡Œäº‹æ›† â†’ è‡ªå‹•æ‰“å¡', 'success');
        }

        // æ ¼å¼åŒ–æ—¥æœŸçµ¦ iCal ç”¨
        function formatDateForICal(hour, minute) {
            var date = new Date();
            date.setHours(hour, minute, 0, 0);
            return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
        }

        // è¨­å®š iOS é¬§é˜
        function setupIOSAlarms() {
            var timeParts = settings.checkinTime.split(':');
            var reminderHour = parseInt(timeParts[0]);
            var reminderMinute = parseInt(timeParts[1]) - settings.reminderMinutes;
            
            if (reminderMinute < 0) {
                reminderMinute += 60;
                reminderHour -= 1;
            }
            
            var reminderTime = reminderHour.toString().padStart(2, '0') + ':' + 
                             reminderMinute.toString().padStart(2, '0');
            
            var instructions = `ğŸ“± è¨­å®š iOS ç³»çµ±é¬§é˜ï¼š

ğŸ• æé†’æ™‚é–“ï¼š${reminderTime}
ğŸ·ï¸ æ¨™ç±¤ï¼šMphasisæ‰“å¡
ğŸ”„ é‡è¤‡ï¼šé€±ä¸€åˆ°é€±äº”

è¨­å®šæ­¥é©Ÿï¼š
1. é–‹å•Ÿã€Œæ™‚é˜ã€æ‡‰ç”¨
2. é»æ“Šã€Œé¬§é˜ã€æ¨™ç±¤
3. é»æ“Šå³ä¸Šè§’ã€Œ+ã€
4. è¨­å®šæ™‚é–“ï¼š${reminderTime}
5. é»æ“Šã€Œé‡è¤‡ã€é¸æ“‡é€±ä¸€åˆ°é€±äº”
6. åœ¨ã€Œæ¨™ç±¤ã€ä¸­è¼¸å…¥ï¼šMphasisæ‰“å¡
7. é»æ“Šã€Œå„²å­˜ã€

ğŸ¯ é¬§é˜éŸ¿èµ·æ™‚å°±æ˜¯æ‰“å¡æ™‚é–“ï¼`;
            
            alert(instructions);
            
            // å˜—è©¦é–‹å•Ÿæ™‚é˜æ‡‰ç”¨
            try {
                window.location.href = 'clock-alarm://';
            } catch (error) {
                console.log('ç„¡æ³•è‡ªå‹•é–‹å•Ÿæ™‚é˜æ‡‰ç”¨');
            }
        }

        // è¨­å®š Siri æ·å¾‘
        function setupSiriShortcuts() {
            var shortcutName = 'Mphasisæ™ºæ…§æ‰“å¡';
            
            // ç”Ÿæˆ Siri å–šé†’ URL
            var siriWakeupUrl = window.location.href.split('?')[0] + '?wakeup=siri&time=' + 
                               settings.checkinTime.replace(':', '');
            
            var instructions = `ğŸ—£ï¸ å»ºç«‹ Siri æ™ºæ…§æ‰“å¡æ·å¾‘ï¼š

ğŸ“± ç¬¬ä¸€æ­¥ - å»ºç«‹æ·å¾‘ï¼š
1. é–‹å•Ÿã€Œæ·å¾‘ã€æ‡‰ç”¨
2. é»æ“Šå³ä¸Šè§’ã€Œ+ã€æ–°å¢æ·å¾‘
3. æœå°‹ã€Œé–‹å•Ÿ URLã€å‹•ä½œ
4. è¼¸å…¥å–šé†’ç¶²å€ï¼š
   ${siriWakeupUrl}
5. è¨­å®šæ·å¾‘åç¨±ï¼šã€Œ${shortcutName}ã€
6. é»æ“Šã€Œå®Œæˆã€

ğŸ™ï¸ ç¬¬äºŒæ­¥ - èªéŸ³è§¸ç™¼ï¼š
1. åœ¨æ·å¾‘ä¸­æ‰¾åˆ°ã€Œ${shortcutName}ã€
2. é»æ“Šã€Œ...ã€è¨­å®š
3. é»æ“Šã€ŒåŠ åˆ° Siriã€
4. éŒ„è£½è§¸ç™¼è©ï¼šã€Œå˜¿ Siriï¼Œæ‰“å¡æ™‚é–“ã€
5. é»æ“Šã€Œå®Œæˆã€

â° ç¬¬ä¸‰æ­¥ - è‡ªå‹•åŒ–ï¼š
1. åˆ‡æ›åˆ°ã€Œè‡ªå‹•åŒ–ã€é é¢
2. é»æ“Šå³ä¸Šè§’ã€Œ+ã€
3. é¸æ“‡ã€Œå»ºç«‹å€‹äººè‡ªå‹•åŒ–ã€
4. é¸æ“‡ã€Œæ™‚é–“ã€
5. è¨­å®šæ™‚é–“ï¼š${settings.checkinTime}
6. è¨­å®šé‡è¤‡ï¼šé¸æ“‡è¦æ‰“å¡çš„æ—¥æœŸ
7. é»æ“Šã€Œä¸‹ä¸€æ­¥ã€
8. æœå°‹ã€ŒåŸ·è¡Œæ·å¾‘ã€
9. é¸æ“‡ã€Œ${shortcutName}ã€
10. é—œé–‰ã€ŒåŸ·è¡Œå‰è©¢å•ã€
11. é»æ“Šã€Œå®Œæˆã€

ğŸ¯ æ™ºæ…§åŠŸèƒ½ï¼š
âœ… è‡ªå‹•æª¢æ¸¬æ‰“å¡æ™‚é–“
âœ… æ™ºæ…§é–‹å•Ÿæ‰“å¡é é¢
âœ… æ”¯æ´èªéŸ³æ§åˆ¶
âœ… è‡ªå‹•åŒ–åŸ·è¡Œ

ğŸ”— å–šé†’ç¶²å€å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼`;
            
            // è¤‡è£½å–šé†’ URL åˆ°å‰ªè²¼ç°¿
            try {
                navigator.clipboard.writeText(siriWakeupUrl);
            } catch (error) {
                console.log('ç„¡æ³•è¤‡è£½åˆ°å‰ªè²¼ç°¿:', error);
            }
            
            showMessage(instructions, 'info');
            
            // å˜—è©¦é–‹å•Ÿæ·å¾‘æ‡‰ç”¨
            setTimeout(() => {
                try {
                    window.location.href = 'shortcuts://';
                } catch (error) {
                    console.log('ç„¡æ³•é–‹å•Ÿæ·å¾‘æ‡‰ç”¨:', error);
                }
            }, 2000);
        }

        // è¨­å®š iOS æé†’äº‹é …
        function setupReminders() {
            var instructions = `ğŸ“ å»ºç«‹ iOS æé†’äº‹é …ï¼š

æé†’å…§å®¹ï¼šã€ŒMphasis æ‰“å¡æ™‚é–“ã€
æé†’æ™‚é–“ï¼šæ¯å¤© ${settings.checkinTime}

è¨­å®šæ­¥é©Ÿï¼š
1. é–‹å•Ÿã€Œæé†’äº‹é …ã€æ‡‰ç”¨
2. é»æ“Šå³ä¸‹è§’ã€Œ+ã€
3. è¼¸å…¥ï¼šMphasis æ‰“å¡æ™‚é–“
4. é»æ“Šã€Œiã€åœ–ç¤º
5. é–‹å•Ÿã€Œåœ¨æŸæ—¥æé†’æˆ‘ã€
6. è¨­å®šæ™‚é–“ï¼š${settings.checkinTime}
7. é–‹å•Ÿã€Œé‡è¤‡ã€é¸æ“‡ã€Œæ¯å¤©ã€
8. é»æ“Šã€Œå®Œæˆã€

ğŸ¯ ç³»çµ±æœƒåœ¨è¨­å®šæ™‚é–“è‡ªå‹•æé†’æ‚¨æ‰“å¡ï¼`;
            
            alert(instructions);
            
            // å˜—è©¦é–‹å•Ÿæé†’äº‹é …æ‡‰ç”¨
            try {
                window.location.href = 'x-apple-reminderkit://';
            } catch (error) {
                console.log('ç„¡æ³•è‡ªå‹•é–‹å•Ÿæé†’äº‹é …æ‡‰ç”¨');
            }
        }

        // å•Ÿå‹•å‰æ™¯ä¿æŒæ¨¡å¼
        function startForegroundMode() {
            showMessage('ğŸ”„ å•Ÿå‹•å‰æ™¯ä¿æŒæ¨¡å¼...', 'info');
            
            // é‡ç½®è¨ˆæ™‚å™¨
            activeStartTime = Date.now();
            
            // å•Ÿå‹•å‰æ™¯æé†’æª¢æŸ¥
            startForegroundReminderCheck();
            
            // å˜—è©¦ä¿æŒå±å¹•å–šé†’
            try {
                if ('wakeLock' in navigator) {
                    navigator.wakeLock.request('screen').then(function(wakeLock) {
                        console.log('ğŸ”† å±å¹•ä¿æŒå–šé†’');
                    }).catch(function(error) {
                        console.log('ç„¡æ³•ä¿æŒå±å¹•å–šé†’:', error);
                    });
                }
            } catch (error) {
                console.log('ä¸æ”¯æ´å±å¹•å–šé†’ API');
            }
            
            showMessage('âœ… å‰æ™¯ä¿æŒæ¨¡å¼å·²å•Ÿå‹•ï¼è«‹ä¿æŒæ‡‰ç”¨åœ¨å‰æ™¯ã€‚', 'success');
        }

        // å•Ÿå‹•å‰æ™¯æé†’æª¢æŸ¥
        function startForegroundReminderCheck() {
            if (reminderInterval) {
                clearInterval(reminderInterval);
            }
            
            reminderInterval = setInterval(function() {
                if (!document.hidden) {
                    checkForReminder();
                }
            }, 30000); // æ¯30ç§’æª¢æŸ¥ä¸€æ¬¡
        }

        // æ’ç¨‹ä¸‹æ¬¡æª¢æŸ¥ï¼ˆèƒŒæ™¯æ¨¡å¼ç”¨ï¼‰
        function scheduleNextCheck() {
            setTimeout(function() {
                if (document.hidden) {
                    checkForReminder();
                    scheduleNextCheck(); // éæ­¸æ’ç¨‹
                }
            }, 60000); // 1åˆ†é˜å¾Œæª¢æŸ¥
        }

        // æ¸¬è©¦å‰æ™¯æé†’
        function testForegroundReminder() {
            if (document.hidden) {
                showMessage('âš ï¸ è«‹ä¿æŒæ‡‰ç”¨åœ¨å‰æ™¯ä»¥æ¸¬è©¦æé†’', 'warning');
                return;
            }
            
            showMessage('ğŸ§ª æ¸¬è©¦æé†’ä¸­...', 'info');
            setTimeout(function() {
                triggerCheckinReminder();
            }, 2000);
        }

        // æ¨¡æ“¬æ‰“å¡æé†’
        function showCheckinReminder() {
            triggerCheckinReminder();
        }

        // é–‹å•Ÿæ‰“å¡é é¢
        function openCheckinPage() {
            var popup = window.open(settings.checkinUrl, 'checkin', 'width=414,height=736');
            
            if (popup) {
                showMessage('âœ… æ‰“å¡é é¢å·²é–‹å•Ÿï¼', 'success');
            } else {
                showMessage('âŒ ç„¡æ³•é–‹å•Ÿé é¢ï¼Œè«‹æª¢æŸ¥å½ˆçª—è¨­å®š', 'error');
            }
        }

        // å„²å­˜è¨­å®š
        function saveSettings() {
            try {
                localStorage.setItem('ios_ultimate_settings', JSON.stringify(settings));
            } catch (error) {
                console.error('å„²å­˜è¨­å®šå¤±æ•—:', error);
            }
        }

        // è¼‰å…¥è¨­å®š
        function loadSettings() {
            try {
                var saved = localStorage.getItem('ios_ultimate_settings');
                if (saved) {
                    var savedSettings = JSON.parse(saved);
                    settings = Object.assign(settings, savedSettings);
                    
                    // æ›´æ–° UI
                    document.getElementById('quickCheckinTime').value = settings.checkinTime;
                    document.getElementById('quickReminderTime').value = settings.reminderMinutes;
                    document.getElementById('quickExcludeHolidays').checked = settings.excludeHolidays !== false;
                    
                    // æ›´æ–°å¿«é€Ÿé€±é–“é¸æ“‡
                    if (settings.weeklyDays) {
                        quickWeeklyDays = settings.weeklyDays.slice();
                    }
                    
                    // æ›´æ–° Teams è¨­å®š UI
                    if (document.getElementById('teamsEnabled')) {
                        document.getElementById('teamsEnabled').checked = settings.teamsEnabled || false;
                        document.getElementById('teamsWebhook').value = settings.teamsWebhook || '';
                        document.getElementById('teamsBackupWebhook').value = settings.teamsBackupWebhook || '';
                        updateTeamsSettings();
                    }
                }
            } catch (error) {
                console.error('è¼‰å…¥è¨­å®šå¤±æ•—:', error);
            }
        }

        // Teams è¨­å®šç›¸é—œå‡½æ•¸
        function toggleTeamsSettings() {
            var teamsSettings = document.getElementById('teamsSettings');
            if (teamsSettings.style.display === 'none') {
                teamsSettings.style.display = 'block';
                loadSettings(); // ç¢ºä¿è¼‰å…¥æœ€æ–°è¨­å®š
            } else {
                teamsSettings.style.display = 'none';
            }
        }

        function updateTeamsSettings() {
            var enabled = document.getElementById('teamsEnabled').checked;
            var webhookSettings = document.getElementById('teamsWebhookSettings');
            
            if (enabled) {
                webhookSettings.style.display = 'block';
            } else {
                webhookSettings.style.display = 'none';
            }
        }

        function saveTeamsSettings() {
            var enabled = document.getElementById('teamsEnabled').checked;
            var webhook = document.getElementById('teamsWebhook').value.trim();
            var backupWebhook = document.getElementById('teamsBackupWebhook').value.trim();
            
            if (enabled && !webhook) {
                showMessage('âŒ è«‹è¼¸å…¥ä¸»è¦ Webhook URL', 'error');
                return;
            }
            
            // ç°¡å–®çš„ URL é©—è­‰
            if (enabled && webhook && !webhook.startsWith('https://')) {
                showMessage('âŒ Webhook URL å¿…é ˆä»¥ https:// é–‹é ­', 'error');
                return;
            }
            
            // æ›´æ–°è¨­å®š
            settings.teamsEnabled = enabled;
            settings.teamsWebhook = webhook;
            settings.teamsBackupWebhook = backupWebhook;
            
            // å„²å­˜è¨­å®š
            saveSettings();
            
            showMessage('âœ… Teams è¨­å®šå·²å„²å­˜', 'success');
        }

        function testTeamsNotification() {
            var enabled = document.getElementById('teamsEnabled').checked;
            var webhook = document.getElementById('teamsWebhook').value.trim();
            
            if (!enabled) {
                showMessage('âŒ è«‹å…ˆå•Ÿç”¨ Teams é€šçŸ¥', 'error');
                return;
            }
            
            if (!webhook) {
                showMessage('âŒ è«‹è¼¸å…¥ Webhook URL', 'error');
                return;
            }
            
            // æš«æ™‚æ›´æ–°è¨­å®šä»¥é€²è¡Œæ¸¬è©¦
            var originalSettings = {
                teamsEnabled: settings.teamsEnabled,
                teamsWebhook: settings.teamsWebhook,
                teamsBackupWebhook: settings.teamsBackupWebhook
            };
            
            settings.teamsEnabled = enabled;
            settings.teamsWebhook = webhook;
            settings.teamsBackupWebhook = document.getElementById('teamsBackupWebhook').value.trim();
            
            // ç™¼é€æ¸¬è©¦é€šçŸ¥
            sendTeamsNotification(
                'ğŸ§ª Teams é€šçŸ¥æ¸¬è©¦',
                `é€™æ˜¯ä¸€å‰‡æ¸¬è©¦é€šçŸ¥\næ™‚é–“ï¼š${new Date().toLocaleString()}\nå¦‚æœæ‚¨æ”¶åˆ°æ­¤è¨Šæ¯ï¼Œè¡¨ç¤º Teams é€šçŸ¥è¨­å®šæˆåŠŸï¼`,
                'æé†’'
            ).finally(() => {
                // æ¢å¾©åŸå§‹è¨­å®š
                settings.teamsEnabled = originalSettings.teamsEnabled;
                settings.teamsWebhook = originalSettings.teamsWebhook;
                settings.teamsBackupWebhook = originalSettings.teamsBackupWebhook;
            });
        }

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(message, type) {
            var statusArea = document.getElementById('statusArea');
            var className = 'status-' + (type || 'info');
            
            statusArea.innerHTML = '<div class="status ' + className + ' fade-in">' + message + '</div>';
            
            setTimeout(function() {
                if (statusArea.innerHTML.includes(message)) {
                    statusArea.innerHTML = '';
                }
            }, 5000);
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }

        console.log('ğŸ† iOS çµ‚æ¥µæ‰“å¡è§£æ±ºæ–¹æ¡ˆå·²è¼‰å…¥');
    </script>
</body>
</html>
