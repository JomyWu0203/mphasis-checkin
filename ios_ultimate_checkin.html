<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üèÜ iOS ÁµÇÊ•µÊâìÂç°Ëß£Ê±∫ÊñπÊ°à</title>
    
    <!-- iOS PWA ÂÑ™Âåñ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ÁµÇÊ•µÊâìÂç°">
    <meta name="theme-color" content="#FF6B35">
    
    <style>
        :root {
            --primary-color: #FF6B35;
            --secondary-color: #F7931E;
            --success-color: #34C759;
            --danger-color: #FF3B30;
            --info-color: #007AFF;
            --warning-color: #FF9500;
            --gray-color: #8E8E93;
            --light-gray: #F2F2F7;
            --gold-color: #FFD700;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            background: var(--light-gray);
            color: #000;
            min-height: 100vh;
            padding: env(safe-area-inset-top) 16px env(safe-area-inset-bottom) 16px;
        }

        .container {
            max-width: 390px;
            margin: 0 auto;
        }

        /* Ê®ôÈ°åÂçÄÂüü */
        .header {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-align: center;
            padding: 24px 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(255, 107, 53, 0.3);
            position: relative;
        }

        .header::before {
            content: 'üèÜ';
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 30px;
            background: var(--gold-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: spin 3s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        /* Âç°ÁâáÊ®£Âºè */
        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #000;
            display: flex;
            align-items: center;
        }

        .card-title .icon {
            margin-right: 8px;
            font-size: 22px;
        }

        /* ÊôÇÈñìÈ°ØÁ§∫ */
        .time-display {
            text-align: center;
            padding: 20px;
        }

        .current-time {
            font-size: 36px;
            font-weight: 200;
            color: #000;
            margin-bottom: 6px;
            font-feature-settings: "tnum";
        }

        .current-date {
            font-size: 15px;
            color: var(--gray-color);
            margin-bottom: 12px;
        }

        .next-checkin {
            background: var(--info-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
        }

        /* ÂâçÊôØ‰øùÊåÅÁãÄÊÖã */
        .foreground-status {
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            text-align: center;
            border: 2px solid;
            position: relative;
        }

        .foreground-active {
            background: #E8F5E8;
            color: #1B5E20;
            border-color: var(--success-color);
            animation: pulse-green 2s infinite;
        }

        .foreground-inactive {
            background: #FFEBEE;
            color: #C62828;
            border-color: var(--danger-color);
            animation: pulse-red 2s infinite;
        }

        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(52, 199, 89, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(52, 199, 89, 0); }
            100% { box-shadow: 0 0 0 0 rgba(52, 199, 89, 0); }
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 59, 48, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0); }
        }

        /* ÊåâÈàïÊ®£Âºè */
        .btn {
            display: block;
            width: 100%;
            padding: 16px 20px;
            font-size: 17px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            margin: 12px 0;
            text-decoration: none;
            text-align: center;
            cursor: pointer;
            touch-action: manipulation;
            -webkit-appearance: none;
            transition: all 0.2s ease;
            position: relative;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 199, 89, 0.3);
        }

        .btn-info {
            background: var(--info-color);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 149, 0, 0.3);
        }

        .btn-gold {
            background: linear-gradient(45deg, var(--gold-color), #FFA500);
            color: #000;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .btn:active {
            transform: scale(0.98);
            opacity: 0.8;
        }

        /* Á≥ªÁµ±Ëß£Ê±∫ÊñπÊ°àÁ∂≤Ê†º */
        .solution-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 20px 0;
        }

        .solution-card {
            background: #F8F9FA;
            border: 2px solid #E5E5EA;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .solution-card:hover {
            border-color: var(--primary-color);
            background: rgba(255, 107, 53, 0.05);
        }

        .solution-card .icon {
            font-size: 32px;
            margin-bottom: 8px;
            display: block;
        }

        .solution-card .title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .solution-card .desc {
            font-size: 11px;
            color: var(--gray-color);
            line-height: 1.2;
        }

        /* ËÉåÊôØÈôêÂà∂Ë™™Êòé */
        .limitation-warning {
            background: linear-gradient(45deg, #FFF3E0, #FFE0B2);
            border: 2px solid var(--warning-color);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .limitation-warning h3 {
            color: #E65100;
            margin-bottom: 12px;
        }

        .limitation-warning p {
            color: #BF360C;
            line-height: 1.5;
            font-size: 14px;
        }

        /* ÂâçÊôØ‰øùÊåÅË®àÊôÇÂô® */
        .stay-active-timer {
            text-align: center;
            padding: 20px;
            background: linear-gradient(45deg, #E3F2FD, #BBDEFB);
            border-radius: 12px;
            border: 2px solid var(--info-color);
            margin: 16px 0;
        }

        .timer-display {
            font-size: 48px;
            font-weight: 200;
            color: var(--info-color);
            margin-bottom: 8px;
            font-family: monospace;
        }

        .timer-label {
            color: #0D47A1;
            font-weight: 600;
        }

        /* ÁãÄÊÖãÊåáÁ§∫Âô® */
        .status {
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            text-align: center;
            font-weight: 500;
        }

        .status-success {
            background: #E8F5E8;
            color: #1B5E20;
            border: 2px solid var(--success-color);
        }

        .status-info {
            background: #E3F2FD;
            color: #0D47A1;
            border: 2px solid var(--info-color);
        }

        .status-warning {
            background: #FFF3E0;
            color: #E65100;
            border: 2px solid var(--warning-color);
        }

        .status-error {
            background: #FFEBEE;
            color: #C62828;
            border: 2px solid var(--danger-color);
        }

        /* Âø´ÈÄüË®≠ÂÆöÈù¢Êùø */
        .quick-setup {
            background: linear-gradient(45deg, #F3E5F5, #E1BEE7);
            border: 2px solid #8A2BE2;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .quick-setup h3 {
            color: #4A148C;
            margin-bottom: 16px;
            text-align: center;
        }

        .time-input-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 12px 0;
        }

        .time-input-group label {
            font-weight: 600;
            color: #6A1B9A;
            flex: 1;
        }

        .time-input-group input,
        .time-input-group select {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #BA68C8;
            border-radius: 8px;
            font-size: 16px;
            -webkit-appearance: none;
        }

        /* Âø´ÈÄüÈÄ±ÈñìÈÅ∏ÊìáÂô® */
        .quick-week-selector {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            margin: 8px 0;
        }

        .quick-day-btn {
            padding: 10px 6px;
            font-size: 13px;
            font-weight: 600;
            border: 2px solid #BA68C8;
            border-radius: 8px;
            background: white;
            color: #6A1B9A;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }

        .quick-day-btn.selected {
            background: #8A2BE2;
            color: white;
            border-color: #8A2BE2;
            transform: scale(1.05);
        }

        .quick-day-btn:active {
            transform: scale(0.95);
        }

        .btn-link {
            background: none !important;
            border: none !important;
            text-decoration: underline;
            cursor: pointer;
            font-size: 12px;
            color: #8A2BE2;
            padding: 4px 8px;
        }

        .btn-link:hover {
            opacity: 0.8;
        }

        /* Ëá™ÂãïÊâìÂç°‰ªãÈù¢Ê®£Âºè */
        .auto-checkin-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auto-checkin-modal {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 340px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auto-checkin-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .auto-checkin-header h2 {
            color: #6A1B9A;
            font-size: 20px;
            margin-bottom: 8px;
        }

        .auto-checkin-source {
            color: #8A2BE2;
            font-size: 14px;
            font-weight: 500;
        }

        .auto-checkin-content {
            text-align: center;
        }

        .auto-checkin-status {
            color: #333;
            font-size: 16px;
            margin-bottom: 16px;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .auto-checkin-progress {
            background: #F0F0F0;
            border-radius: 8px;
            height: 8px;
            margin-bottom: 24px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, #8A2BE2, #BA68C8);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 8px;
        }

        .auto-checkin-actions {
            display: flex;
            gap: 12px;
            flex-direction: column;
        }

        .auto-checkin-actions .btn {
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .auto-checkin-actions .btn-primary {
            background: linear-gradient(135deg, #8A2BE2, #BA68C8);
            color: white;
        }

        .auto-checkin-actions .btn-primary:active {
            transform: scale(0.98);
        }

        .auto-checkin-actions .btn-secondary {
            background: #F0F0F0;
            color: #666;
        }

        #autoCheckinInterface {
            display: none;
        }

        /* Èö±ËóèÈ°û */
        .hidden {
            display: none !important;
        }

        /* ÂãïÁï´ÊïàÊûú */
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* ÂÖ®Â±èÊèêÈÜíÊ®£Âºè */
        .fullscreen-reminder {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-color);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            text-align: center;
            padding: 20px;
        }

        .reminder-clock {
            font-size: 120px;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        .reminder-text {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .reminder-actions {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }

        .reminder-btn {
            padding: 20px 40px;
            font-size: 20px;
            font-weight: 700;
            border: 3px solid white;
            border-radius: 15px;
            background: transparent;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .reminder-btn.primary {
            background: white;
            color: var(--primary-color);
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ê®ôÈ°å -->
        <div class="header">
            <h1>üèÜ ÁµÇÊ•µÊâìÂç°Ëß£Ê±∫ÊñπÊ°à</h1>
            <p>Á™ÅÁ†¥ iOS ËÉåÊôØÈôêÂà∂ÁöÑÂÆåÁæéÊñπÊ°à</p>
        </div>

        <!-- ÊôÇÈñìÈ°ØÁ§∫ -->
        <div class="card">
            <div class="time-display">
                <div class="current-time" id="timeDisplay">--:--</div>
                <div class="current-date" id="dateDisplay">ËºâÂÖ•‰∏≠...</div>
                <div class="next-checkin" id="nextCheckin">‰∏ãÊ¨°ÊâìÂç°ÔºöÊú™Ë®≠ÂÆö</div>
            </div>
        </div>

        <!-- ÂâçÊôØÁãÄÊÖãÁõ£Êéß -->
        <div class="card">
            <div class="card-title">
                <span class="icon">üì±</span>
                ÊáâÁî®ÁãÄÊÖãÁõ£Êéß
            </div>
            
            <div id="foregroundStatus" class="foreground-status foreground-inactive">
                üîç Ê≠£Âú®Ê™¢Ê∏¨ÊáâÁî®ÁãÄÊÖã...
            </div>
            
            <div class="stay-active-timer">
                <div class="timer-display" id="activeTimer">--:--</div>
                <div class="timer-label">ÂâçÊôØÊ¥ªË∫çÊôÇÈñì</div>
            </div>
        </div>

        <!-- Êô∫ÊÖßÈÄ£ÂãïË™™Êòé -->
        <div class="card" style="background: linear-gradient(135deg, #E8F5E8, #C8E6C9); border: 2px solid #4CAF50; margin-bottom: 16px;">
            <div class="card-title" style="color: #2E7D32;">
                <span class="icon">üîó</span>
                Êô∫ÊÖßË°å‰∫ãÊõÜÈÄ£ÂãïÁ≥ªÁµ±
            </div>
            <div style="color: #1B5E20; line-height: 1.6;">
                <p><strong>üéØ ÂÆåÊï¥Ëá™ÂãïÂåñÊµÅÁ®ãÔºö</strong></p>
                <div style="margin: 12px 0; padding: 12px; background: rgba(76, 175, 80, 0.1); border-radius: 8px; font-size: 14px;">
                    <strong>1Ô∏è‚É£ Ë®≠ÂÆöÈÄ±ÈñìÊéíÁ®ã</strong> ‚Üí ÈÅ∏ÊìáË¶ÅÊâìÂç°ÁöÑÊòüÊúüÂπæ<br>
                    <strong>2Ô∏è‚É£ ÁîüÊàêÊô∫ÊÖßÊó•ÊõÜ</strong> ‚Üí ÂåÖÂê´Ëá™ÂãïÂñöÈÜíÈÄ£Áµê<br>
                    <strong>3Ô∏è‚É£ iOS ÊèêÈÜíËß∏Áôº</strong> ‚Üí Á≥ªÁµ±Âú®Ë®≠ÂÆöÊôÇÈñìÁôºÈÄÅÈÄöÁü•<br>
                    <strong>4Ô∏è‚É£ ÈªûÊìäÈÄöÁü•ÂñöÈÜí</strong> ‚Üí Ëá™ÂãïÈñãÂïüÊâìÂç°ÊáâÁî®<br>
                    <strong>5Ô∏è‚É£ Êô∫ÊÖßÊâìÂç°Âü∑Ë°å</strong> ‚Üí Ê™¢Ê∏¨ÊôÇÈñì‰∏¶ÈñãÂïüÊâìÂç°È†ÅÈù¢<br>
                    <strong>6Ô∏è‚É£ Teams ÈÄöÁü•</strong> ‚Üí Ëá™ÂãïÁôºÈÄÅÂü∑Ë°åÁãÄÊÖãÂà∞ Teams
                </div>
                <p><strong>üöÄ Ê†∏ÂøÉÂÑ™Âã¢Ôºö</strong></p>
                <ul style="margin: 8px 0 0 20px; font-size: 14px;">
                    <li>‚úÖ ÂÆåÂÖ®ÁπûÈÅé Safari ËÉåÊôØÈôêÂà∂</li>
                    <li>‚úÖ ‰ΩøÁî® iOS ÂéüÁîüÁ≥ªÁµ±ÊèêÈÜí</li>
                    <li>‚úÖ ÊîØÊè¥ÈÄ±ÈñìËá™ÂãïÊéíÁ®ã</li>
                    <li>‚úÖ Êô∫ÊÖßÊ™¢Ê∏¨ÊâìÂç°ÊôÇÈñì</li>
                    <li>‚úÖ Ëá™ÂãïÂñöÈÜíÊáâÁî®Âü∑Ë°å</li>
                    <li>‚úÖ Teams ÈÄöÁü•Êï¥Âêà</li>
                </ul>
            </div>
        </div>

        <!-- iOS ËÉåÊôØÈôêÂà∂Ë™™Êòé -->
        <div class="limitation-warning">
            <h3>‚ö†Ô∏è ÁÇ∫‰ªÄÈ∫ºÈúÄË¶ÅË°å‰∫ãÊõÜÈÄ£ÂãïÔºü</h3>
            <p>
                <strong>iOS ÈôêÂà∂Ôºö</strong>Safari Âú®ËÉåÊôØÊ®°Âºè‰∏ãÂè™ËÉΩÂü∑Ë°å 5 ÂàÜÈêòÔºåÁ∂≤È†ÅÊèêÈÜíÊúÉÂ§±Êïà„ÄÇ<br><br>
                
                <strong>ÈôêÂà∂Ë©≥ÊÉÖÔºö</strong><br>
                ‚Ä¢ üïê ËÉåÊôØÊúÄÂ§öÂü∑Ë°å 5 ÂàÜÈêò<br>
                ‚Ä¢ üîã ÁúÅÈõªÊ®°Âºè‰∏ãÊõ¥Âö¥Ê†º<br>
                ‚Ä¢ üíæ Ë®òÊÜ∂È´î‰∏çË∂≥ÊôÇÁ´ãÂç≥Êö´ÂÅú<br>
                ‚Ä¢ üîí ÂÆâÂÖ®ÊîøÁ≠ñÈòªÊ≠¢ËÉåÊôØÊ¥ªÂãï<br><br>
                
                <strong>Ëß£Ê±∫ÊñπÊ°àÔºö</strong>Ë°å‰∫ãÊõÜÊèêÈÜí ‚Üí ÈªûÊìäÈÄöÁü• ‚Üí Ëá™ÂãïÈñãÂïüÊáâÁî® ‚Üí Âü∑Ë°åÊâìÂç°ÔºÅ
            </p>
        </div>

        <!-- Âø´ÈÄüË®≠ÂÆö -->
        <div class="quick-setup">
            <h3>‚ö° Âø´ÈÄüË®≠ÂÆöÊâìÂç°ÊôÇÈñì</h3>
            
            <div class="time-input-group">
                <label>ÊâìÂç°ÊôÇÈñìÔºö</label>
                <input type="time" id="quickCheckinTime" value="09:00">
            </div>
            
            <div class="time-input-group">
                <label>ÊèêÂâçÊèêÈÜíÔºö</label>
                <select id="quickReminderTime">
                    <option value="5">5 ÂàÜÈêò</option>
                    <option value="10">10 ÂàÜÈêò</option>
                    <option value="15">15 ÂàÜÈêò</option>
                    <option value="30">30 ÂàÜÈêò</option>
                </select>
            </div>
            
            <!-- ÈÄ±ÈñìÈÅ∏Êìá -->
            <div style="margin: 16px 0;">
                <label style="display: block; font-weight: 600; color: #6A1B9A; margin-bottom: 8px;">ÊâìÂç°Êó•ÊúüÔºö</label>
                <div class="quick-week-selector">
                    <div class="quick-day-btn" data-day="1" onclick="toggleQuickDay(1)">‰∏Ä</div>
                    <div class="quick-day-btn" data-day="2" onclick="toggleQuickDay(2)">‰∫å</div>
                    <div class="quick-day-btn" data-day="3" onclick="toggleQuickDay(3)">‰∏â</div>
                    <div class="quick-day-btn" data-day="4" onclick="toggleQuickDay(4)">Âõõ</div>
                    <div class="quick-day-btn" data-day="5" onclick="toggleQuickDay(5)">‰∫î</div>
                    <div class="quick-day-btn" data-day="6" onclick="toggleQuickDay(6)">ÂÖ≠</div>
                    <div class="quick-day-btn" data-day="0" onclick="toggleQuickDay(0)">Êó•</div>
                </div>
                <div style="margin-top: 8px;">
                    <button class="btn-link" onclick="selectWorkdays()" style="font-size: 12px; color: #8A2BE2; background: none; border: none; text-decoration: underline; cursor: pointer;">
                        üìÖ ÈÅ∏ÊìáÂ∑•‰ΩúÊó• (‰∏Ä~‰∫î)
                    </button>
                    <button class="btn-link" onclick="selectAllDays()" style="font-size: 12px; color: #8A2BE2; background: none; border: none; text-decoration: underline; cursor: pointer; margin-left: 16px;">
                        üóìÔ∏è ÈÅ∏ÊìáÂÖ®ÈÉ® (‰∏Ä~Êó•)
                    </button>
                </div>
            </div>
            
            <!-- Â∏∏Ë¶ãÂÅáÊó•ÊéíÈô§ -->
            <div style="margin: 16px 0;">
                <label style="display: block; font-weight: 600; color: #6A1B9A; margin-bottom: 8px;">
                    <input type="checkbox" id="quickExcludeHolidays" checked style="margin-right: 8px;">
                    Ëá™ÂãïÊéíÈô§ÂúãÂÆöÂÅáÊó•
                </label>
                <div style="font-size: 12px; color: #8A2BE2; opacity: 0.8;">
                    ÂåÖÂê´ÔºöÂÖÉÊó¶„ÄÅÊò•ÁØÄ„ÄÅÊ∏ÖÊòé„ÄÅÂãûÂãïÁØÄ„ÄÅÁ´ØÂçà„ÄÅ‰∏≠Áßã„ÄÅÂúãÊÖ∂Á≠â
                </div>
            </div>
            
            <button class="btn btn-gold" onclick="quickSetup()">
                ‚ö° ‰∏ÄÈçµË®≠ÂÆöÊâÄÊúâÊèêÈÜí
            </button>
            
            <div style="margin-top: 12px; font-size: 13px; color: #6A1B9A; text-align: center; opacity: 0.9;">
                üìã Â∞áËá™ÂãïË®≠ÂÆöÔºöÊó•ÊõÜ‰∫ã‰ª∂ + Á≥ªÁµ±È¨ßÈêò + Siri Êç∑Âæë + ÊèêÈÜí‰∫ãÈ†Ö
            </div>
            
            <!-- Ê∏¨Ë©¶Ë°å‰∫ãÊõÜÂñöÈÜí -->
            <div style="margin-top: 16px; text-align: center;">
                <button class="btn btn-secondary" onclick="testCalendarWakeup()" style="font-size: 14px; padding: 8px 16px;">
                    üß™ Ê∏¨Ë©¶Ë°å‰∫ãÊõÜÂñöÈÜíÂäüËÉΩ
                </button>
            </div>
        </div>

        <!-- Á≥ªÁµ±Á¥öËß£Ê±∫ÊñπÊ°à -->
        <div class="card">
            <div class="card-title">
                <span class="icon">üéØ</span>
                Á≥ªÁµ±Á¥öÊèêÈÜíÊñπÊ°à
            </div>
            
            <div class="status status-info">
                <strong>üí° Ê†∏ÂøÉÁ≠ñÁï•Ôºö</strong>‰∏ç‰æùË≥¥ÊáâÁî®ËÉåÊôØÂü∑Ë°åÔºå‰ΩøÁî® iOS Á≥ªÁµ±ÂäüËÉΩÁ¢∫‰øùÊèêÈÜíÔºÅ
            </div>
            
            <div class="solution-grid">
                <div class="solution-card" onclick="setupIOSCalendar()">
                    <span class="icon">üìÖ</span>
                    <div class="title">iOS Êó•ÊõÜ</div>
                    <div class="desc">Á≥ªÁµ±Êó•ÊõÜ‰∫ã‰ª∂<br>Â∏∂ÈÄöÁü•ÊèêÈÜí</div>
                </div>
                
                <div class="solution-card" onclick="setupIOSAlarms()">
                    <span class="icon">‚è∞</span>
                    <div class="title">iOS È¨ßÈêò</div>
                    <div class="desc">Á≥ªÁµ±È¨ßÈêò<br>ÊØèÊó•ÈáçË§á</div>
                </div>
                
                <div class="solution-card" onclick="setupSiriShortcuts()">
                    <span class="icon">üó£Ô∏è</span>
                    <div class="title">Siri Êç∑Âæë</div>
                    <div class="desc">Ë™ûÈü≥ÊéßÂà∂<br>Ëá™ÂãïÂåñÊµÅÁ®ã</div>
                </div>
                
                <div class="solution-card" onclick="setupReminders()">
                    <span class="icon">üìù</span>
                    <div class="title">iOS ÊèêÈÜí‰∫ãÈ†Ö</div>
                    <div class="desc">Á≥ªÁµ±ÊèêÈÜí<br>ÊôÇÈñìËß∏Áôº</div>
                </div>
            </div>
            
            <!-- Teams ÈÄöÁü•ÊåâÈàï -->
            <div style="margin-top: 16px; text-align: center;">
                <button class="btn" onclick="toggleTeamsSettings()" style="background: linear-gradient(135deg, #0078D4, #106EBE); color: white; padding: 12px 24px;">
                    üì§ Ë®≠ÂÆö Teams ÈÄöÁü•
                </button>
            </div>
        </div>

        <!-- Teams ÈÄöÁü•Ë®≠ÂÆö -->
        <div class="card" id="teamsSettings" style="display: none; margin-top: 16px;">
            <div class="card-title">
                <span class="icon">üì§</span>
                Teams ÈÄöÁü•Ë®≠ÂÆö
            </div>
            
            <div style="margin: 16px 0;">
                <label style="display: flex; align-items: center; margin-bottom: 16px;">
                    <input type="checkbox" id="teamsEnabled" onchange="updateTeamsSettings()" style="margin-right: 8px;">
                    <span style="font-weight: 600; color: #6A1B9A;">ÂïüÁî® Teams ÈÄöÁü•</span>
                </label>
                
                <div id="teamsWebhookSettings" style="display: none;">
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-weight: 600; color: #6A1B9A; margin-bottom: 8px;">
                            ‰∏ªË¶Å Webhook URL:
                        </label>
                        <input type="url" id="teamsWebhook" placeholder="https://outlook.office.com/webhook/..." 
                               style="width: 100%; padding: 8px 12px; border: 1px solid #BA68C8; border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-weight: 600; color: #6A1B9A; margin-bottom: 8px;">
                            ÂÇôÁî® Webhook URL (ÈÅ∏Â°´):
                        </label>
                        <input type="url" id="teamsBackupWebhook" placeholder="https://outlook.office.com/webhook/..." 
                               style="width: 100%; padding: 8px 12px; border: 1px solid #BA68C8; border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-primary" onclick="saveTeamsSettings()" style="flex: 1;">
                            üíæ ÂÑ≤Â≠òË®≠ÂÆö
                        </button>
                        <button class="btn btn-secondary" onclick="testTeamsNotification()" style="flex: 1;">
                            üß™ Ê∏¨Ë©¶ÈÄöÁü•
                        </button>
                    </div>
                    
                    <div style="margin-top: 12px; padding: 12px; background: rgba(106, 27, 154, 0.1); border-radius: 8px; font-size: 13px; color: #6A1B9A;">
                        <strong>üí° Â¶Ç‰ΩïÂèñÂæó Teams Webhook URLÔºö</strong><br>
                        1. Âú® Teams È†ªÈÅì‰∏≠ÈªûÊìä„Äå...„Äç‚Üí„ÄåÈÄ£Êé•Âô®„Äç<br>
                        2. ÊêúÂ∞ã„ÄåIncoming Webhook„Äç‰∏¶Ë®≠ÂÆö<br>
                        3. Ëº∏ÂÖ•ÂêçÁ®±Ôºö„ÄåMphasis ÊâìÂç°ÈÄöÁü•„Äç<br>
                        4. Ë§áË£ΩÁî¢ÁîüÁöÑ Webhook URL
                    </div>
                </div>
            </div>
        </div>

        <!-- ÂâçÊôØ‰øùÊåÅÊñπÊ°à -->
        <div class="card">
            <div class="card-title">
                <span class="icon">üîÑ</span>
                ÂâçÊôØ‰øùÊåÅÊñπÊ°à
            </div>
            
            <div class="status status-warning">
                <strong>‚ö†Ô∏è ÂØ¶È©óÊÄßÊñπÊ°àÔºö</strong>ÂòóË©¶‰øùÊåÅÊáâÁî®Âú®ÂâçÊôØÔºå‰ΩÜ‰∏ç‰øùË≠âÊàêÂäüÔºÅ
            </div>
            
            <button class="btn btn-warning" onclick="startForegroundMode()">
                üîÑ ÂïüÂãïÂâçÊôØ‰øùÊåÅÊ®°Âºè
            </button>
            
            <button class="btn btn-info" onclick="testForegroundReminder()">
                üß™ Ê∏¨Ë©¶ÂâçÊôØÊèêÈÜí
            </button>
        </div>

        <!-- ÊâãÂãïÊìç‰Ωú -->
        <div class="card">
            <div class="card-title">
                <span class="icon">üéØ</span>
                Á´ãÂç≥ÊâìÂç°
            </div>
            
            <button class="btn btn-success" onclick="openCheckinPage()">
                üéØ ÈñãÂïüÊâìÂç°È†ÅÈù¢
            </button>
            
            <div style="margin-top: 16px;">
                <button class="btn btn-primary" onclick="showCheckinReminder()">
                    üì¢ Ê®°Êì¨ÊâìÂç°ÊèêÈÜí
                </button>
            </div>
        </div>

        <!-- ÁãÄÊÖãË®äÊÅØÂçÄÂüü -->
        <div id="statusArea"></div>
    </div>

    <!-- ÂÖ®Â±èÊèêÈÜíË¶ÜËìãÂ±§ -->
    <div class="fullscreen-reminder hidden" id="fullscreenReminder">
        <div class="reminder-clock">üïò</div>
        <div class="reminder-text">ÊâìÂç°ÊôÇÈñìÂà∞‰∫ÜÔºÅ</div>
        <div style="font-size: 18px; opacity: 0.9;">
            ÁèæÂú®ÊòØ <span id="reminderTime">09:00</span>ÔºåË©≤ÂéªÊâìÂç°‰∫ÜÔºÅ
        </div>
        <div class="reminder-actions">
            <button class="reminder-btn primary" onclick="openCheckinPage(); hideFullscreenReminder();">
                Á´ãÂç≥ÊâìÂç°
            </button>
            <button class="reminder-btn" onclick="snoozeReminder()">
                Á®çÂæåÊèêÈÜí
            </button>
            <button class="reminder-btn" onclick="hideFullscreenReminder()">
                ÈóúÈñâ
            </button>
        </div>
    </div>

    <script>
        // ÂÖ®ÂüüËÆäÊï∏
        var settings = {
            checkinTime: '09:00',
            reminderMinutes: 5,
            checkinUrl: 'https://enterprise-apps.mphasis.com/ess/v1/#/home',
            weeklyDays: [1, 2, 3, 4, 5], // È†êË®≠ÈÄ±‰∏ÄÂà∞ÈÄ±‰∫î
            excludeHolidays: true,
            teamsWebhook: '', // Teams Webhook URL
            teamsBackupWebhook: '', // ÂÇôÁî® Teams Webhook URL
            teamsEnabled: false // ÊòØÂê¶ÂïüÁî® Teams ÈÄöÁü•
        };
        
        var quickWeeklyDays = [1, 2, 3, 4, 5]; // Âø´ÈÄüË®≠ÂÆöÁöÑÈÄ±ÈñìÈÅ∏Êìá

        var foregroundTimer = null;
        var activeStartTime = null;
        var visibilityChangeCount = 0;
        var reminderInterval = null;

        // ÂàùÂßãÂåñ
        function initApp() {
            console.log('üèÜ iOS ÁµÇÊ•µÊâìÂç°Ëß£Ê±∫ÊñπÊ°àÂïüÂãï');
            loadSettings();
            updateTime();
            setInterval(updateTime, 1000);
            
            setupVisibilityMonitoring();
            startActiveTimer();
            updateQuickWeeklyDisplay();
            
            // Ê™¢Êü•ÊòØÂê¶ÁÇ∫Ë°å‰∫ãÊõÜÂñöÈÜí
            checkCalendarWakeup();
            
            // Ë®≠ÂÆö URL Scheme ËôïÁêÜÂô®
            setupURLSchemeHandler();
            
            showMessage('‚úÖ ÁµÇÊ•µËß£Ê±∫ÊñπÊ°àÂ∑≤Â∞±Á∑íÔºÅÂª∫Ë≠∞‰ΩøÁî®Á≥ªÁµ±Á¥öÊèêÈÜíÊñπÊ°à„ÄÇ', 'success');
        }

        // Ë®≠ÂÆöÂèØË¶ãÊÄßÁõ£Êéß
        function setupVisibilityMonitoring() {
            // Áõ£ÊéßÈ†ÅÈù¢ÂèØË¶ãÊÄßËÆäÂåñ
            document.addEventListener('visibilitychange', function() {
                visibilityChangeCount++;
                updateForegroundStatus();
                
                if (document.hidden) {
                    console.log('‚ö†Ô∏è ÊáâÁî®ÈÄ≤ÂÖ•ËÉåÊôØÊ®°Âºè');
                    handleBackgroundMode();
                } else {
                    console.log('‚úÖ ÊáâÁî®ÂõûÂà∞ÂâçÊôØÊ®°Âºè');
                    handleForegroundMode();
                }
            });

            // Áõ£ÊéßÁ™óÂè£ÁÑ¶ÈªûËÆäÂåñ
            window.addEventListener('focus', function() {
                console.log('üéØ Á™óÂè£Áç≤ÂæóÁÑ¶Èªû');
                handleForegroundMode();
            });

            window.addEventListener('blur', function() {
                console.log('üò¥ Á™óÂè£Â§±ÂéªÁÑ¶Èªû');
                handleBackgroundMode();
            });

            // ÂàùÂßãÁãÄÊÖãÊ™¢Êü•
            updateForegroundStatus();
        }

        // ËôïÁêÜËÉåÊôØÊ®°Âºè
        function handleBackgroundMode() {
            updateForegroundStatus();
            
            // ÂòóË©¶‰øùÊåÅÊúÄ‰ΩéÈôêÂ∫¶ÁöÑÊ¥ªÂãï
            if (reminderInterval) {
                // ‰ΩøÁî® setTimeout ËÄå‰∏çÊòØ setInterval ‰æÜÈÅøÂÖçË¢´Êö´ÂÅú
                scheduleNextCheck();
            }
        }

        // ËôïÁêÜÂâçÊôØÊ®°Âºè
        function handleForegroundMode() {
            activeStartTime = Date.now();
            updateForegroundStatus();
            
            // ÈáçÊñ∞ÂïüÂãïÊ≠£Â∏∏ÁöÑÊ™¢Êü•Ê©üÂà∂
            if (reminderInterval) {
                clearInterval(reminderInterval);
                startForegroundReminderCheck();
            }
        }

        // Êõ¥Êñ∞ÂâçÊôØÁãÄÊÖãÈ°ØÁ§∫
        function updateForegroundStatus() {
            var statusElement = document.getElementById('foregroundStatus');
            var isActive = !document.hidden && document.hasFocus();
            
            if (isActive) {
                statusElement.className = 'foreground-status foreground-active';
                statusElement.innerHTML = '‚úÖ ÊáâÁî®Âú®ÂâçÊôØÈÅãË°å‰∏≠<br><small>ÂàáÊèõÊ¨°Êï∏Ôºö' + visibilityChangeCount + '</small>';
            } else {
                statusElement.className = 'foreground-status foreground-inactive';
                statusElement.innerHTML = '‚ö†Ô∏è ÊáâÁî®Âú®ËÉåÊôØÊ®°Âºè<br><small>ÊèêÈÜíÂäüËÉΩÂèØËÉΩÂèóÈôê</small>';
            }
        }

        // ÂïüÂãïÊ¥ªË∫çË®àÊôÇÂô®
        function startActiveTimer() {
            activeStartTime = Date.now();
            
            setInterval(function() {
                updateActiveTimer();
            }, 1000);
        }

        // Êõ¥Êñ∞Ê¥ªË∫çË®àÊôÇÂô®
        function updateActiveTimer() {
            if (!activeStartTime) {
                document.getElementById('activeTimer').textContent = '--:--';
                return;
            }
            
            var elapsed = Date.now() - activeStartTime;
            var minutes = Math.floor(elapsed / 60000);
            var seconds = Math.floor((elapsed % 60000) / 1000);
            
            var timeString = minutes.toString().padStart(2, '0') + ':' + 
                           seconds.toString().padStart(2, '0');
            
            document.getElementById('activeTimer').textContent = timeString;
            
            // Ë∂ÖÈÅé 5 ÂàÜÈêòÈ°ØÁ§∫Ë≠¶Âëä
            if (minutes >= 5) {
                document.getElementById('activeTimer').style.color = 'var(--danger-color)';
            } else if (minutes >= 3) {
                document.getElementById('activeTimer').style.color = 'var(--warning-color)';
            } else {
                document.getElementById('activeTimer').style.color = 'var(--info-color)';
            }
        }

        // Êõ¥Êñ∞ÊôÇÈñìÈ°ØÁ§∫
        function updateTime() {
            try {
                var now = new Date();
                var hours = now.getHours().toString().padStart(2, '0');
                var minutes = now.getMinutes().toString().padStart(2, '0');
                var timeString = hours + ':' + minutes;
                
                var options = { 
                    year: 'numeric',
                    month: 'long', 
                    day: 'numeric',
                    weekday: 'long'
                };
                var dateString = now.toLocaleDateString('zh-TW', options);
                
                document.getElementById('timeDisplay').textContent = timeString;
                document.getElementById('dateDisplay').textContent = dateString;
                
                updateNextCheckinTime();
                checkForReminder();
            } catch (error) {
                console.error('ÊôÇÈñìÊõ¥Êñ∞Â§±Êïó:', error);
            }
        }

        // Êõ¥Êñ∞‰∏ãÊ¨°ÊâìÂç°ÊôÇÈñì
        function updateNextCheckinTime() {
            var now = new Date();
            var today = new Date();
            var timeParts = settings.checkinTime.split(':');
            today.setHours(parseInt(timeParts[0]), parseInt(timeParts[1]), 0, 0);
            
            var nextCheckinElement = document.getElementById('nextCheckin');
            
            if (now < today) {
                nextCheckinElement.textContent = '‰ªäÊó•ÊâìÂç°Ôºö' + settings.checkinTime;
                nextCheckinElement.style.background = 'var(--success-color)';
            } else {
                var tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                nextCheckinElement.textContent = 'ÊòéÊó•ÊâìÂç°Ôºö' + settings.checkinTime;
                nextCheckinElement.style.background = 'var(--gray-color)';
            }
        }

        // Ê™¢Êü•ÊòØÂê¶ÈúÄË¶ÅÊèêÈÜí
        function checkForReminder() {
            var now = new Date();
            var today = new Date();
            var timeParts = settings.checkinTime.split(':');
            today.setHours(parseInt(timeParts[0]), parseInt(timeParts[1]) - settings.reminderMinutes, 0, 0);
            
            // Ê™¢Êü•ÊòØÂê¶Âà∞‰∫ÜÊèêÈÜíÊôÇÈñìÔºàÁ≤æÁ¢∫Âà∞ÂàÜÈêòÔºâ
            if (Math.abs(now.getTime() - today.getTime()) < 30000) { // 30ÁßíÂÖß
                triggerCheckinReminder();
            }
        }

        // Ëß∏ÁôºÊâìÂç°ÊèêÈÜí
        function triggerCheckinReminder() {
            console.log('üîî Ëß∏ÁôºÊâìÂç°ÊèêÈÜí');
            
            // Â¶ÇÊûúÂú®ÂâçÊôØÔºåÈ°ØÁ§∫ÂÖ®Â±èÊèêÈÜí
            if (!document.hidden) {
                showFullscreenReminder();
            }
            
            // ÂòóË©¶Â§öÁ®ÆÊèêÈÜíÊñπÂºè
            try {
                // Ë™ûÈü≥ÊèêÈÜí
                if ('speechSynthesis' in window) {
                    var utterance = new SpeechSynthesisUtterance('ÊâìÂç°ÊôÇÈñìÂà∞‰∫ÜÔºÅ');
                    utterance.lang = 'zh-TW';
                    speechSynthesis.speak(utterance);
                }
                
                // ÊåØÂãïÊèêÈÜí
                if ('vibrate' in navigator) {
                    navigator.vibrate([500, 200, 500, 200, 500]);
                }
                
                // ÂòóË©¶Èü≥Êïà
                playAlertSound();
                
            } catch (error) {
                console.error('ÊèêÈÜíÂ§±Êïó:', error);
            }
        }

        // È°ØÁ§∫ÂÖ®Â±èÊèêÈÜí
        function showFullscreenReminder() {
            var reminderElement = document.getElementById('fullscreenReminder');
            document.getElementById('reminderTime').textContent = settings.checkinTime;
            reminderElement.classList.remove('hidden');
            
            // ÂòóË©¶ÈÄ≤ÂÖ•ÂÖ®Ëû¢Âπï
            try {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                }
            } catch (error) {
                console.log('ÁÑ°Ê≥ïÈÄ≤ÂÖ•ÂÖ®Ëû¢Âπï:', error);
            }
        }

        // Èö±ËóèÂÖ®Â±èÊèêÈÜí
        function hideFullscreenReminder() {
            document.getElementById('fullscreenReminder').classList.add('hidden');
            
            // ÈÄÄÂá∫ÂÖ®Ëû¢Âπï
            try {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            } catch (error) {
                console.log('ÁÑ°Ê≥ïÈÄÄÂá∫ÂÖ®Ëû¢Âπï:', error);
            }
        }

        // Âª∂ÈÅ≤ÊèêÈÜí
        function snoozeReminder() {
            hideFullscreenReminder();
            showMessage('‚è∞ Â∞áÂú® 5 ÂàÜÈêòÂæåÂÜçÊ¨°ÊèêÈÜí', 'info');
            
            setTimeout(function() {
                if (!document.hidden) {
                    triggerCheckinReminder();
                }
            }, 5 * 60 * 1000);
        }

        // Êí≠ÊîæÊèêÈÜíÈü≥Êïà
        function playAlertSound() {
            try {
                var audioContext = new (window.AudioContext || window.webkitAudioContext)();
                var oscillator = audioContext.createOscillator();
                var gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Êí≠Êîæ‰∏ÄÂÄãÈüø‰∫ÆÁöÑÊèêÈÜíÈü≥
                oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(1046, audioContext.currentTime + 0.2);
                oscillator.frequency.setValueAtTime(880, audioContext.currentTime + 0.4);
                
                gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.6);
            } catch (error) {
                console.error('Èü≥ÊïàÊí≠ÊîæÂ§±Êïó:', error);
            }
        }

        // Ê™¢Êü•Ë°å‰∫ãÊõÜÂñöÈÜí
        function checkCalendarWakeup() {
            var urlParams = new URLSearchParams(window.location.search);
            var wakeupSource = urlParams.get('wakeup');
            var wakeupTime = urlParams.get('time');
            
            if (wakeupSource === 'calendar') {
                console.log('üîî Ë°å‰∫ãÊõÜÂñöÈÜíÊ™¢Ê∏¨:', wakeupTime);
                showMessage('üîî Ë°å‰∫ãÊõÜÊèêÈÜíÂñöÈÜíÔºÅÊ∫ñÂÇôËá™ÂãïÊâìÂç°...', 'info');
                
                // Âª∂ÈÅ≤Âü∑Ë°åËá™ÂãïÊâìÂç°ÊµÅÁ®ãÔºåËÆì‰ΩøÁî®ËÄÖÁúãÂà∞ÊèêÈÜí
                setTimeout(() => {
                    executeAutoCheckin('calendar');
                }, 2000);
                
                return true;
            }
            
            // Ê™¢Êü•ÊòØÂê¶ÁÇ∫ Siri Êç∑ÂæëÂñöÈÜí
            if (wakeupSource === 'siri') {
                console.log('üó£Ô∏è Siri Êç∑ÂæëÂñöÈÜíÊ™¢Ê∏¨');
                showMessage('üó£Ô∏è Siri Êç∑ÂæëÂñöÈÜíÔºÅÁ´ãÂç≥Âü∑Ë°åÊâìÂç°...', 'info');
                setTimeout(() => {
                    executeAutoCheckin('siri');
                }, 1000);
                return true;
            }
            
            return false;
        }

        // Ë®≠ÂÆö URL Scheme ËôïÁêÜÂô®
        function setupURLSchemeHandler() {
            // Áõ£ËÅΩ popstate ‰∫ã‰ª∂ÔºàËøîÂõûÊåâÈàïÊàñ URL ËÆäÂåñÔºâ
            window.addEventListener('popstate', function(event) {
                checkCalendarWakeup();
            });
            
            // Áõ£ËÅΩ focus ‰∫ã‰ª∂ÔºàÊáâÁî®ÂæûËÉåÊôØËøîÂõûÂâçÊôØÔºâ
            window.addEventListener('focus', function() {
                console.log('üì± ÊáâÁî®ÂõûÂà∞ÂâçÊôØ');
                checkCalendarWakeup();
            });
            
            // Áõ£ËÅΩ pageshow ‰∫ã‰ª∂ÔºàÈ†ÅÈù¢È°ØÁ§∫Ôºâ
            window.addEventListener('pageshow', function(event) {
                if (event.persisted) {
                    console.log('üìÑ È†ÅÈù¢ÂæûÁ∑©Â≠òÊÅ¢Âæ©');
                    checkCalendarWakeup();
                }
            });
        }

        // Âü∑Ë°åËá™ÂãïÊâìÂç°ÊµÅÁ®ã
        function executeAutoCheckin(source) {
            showMessage(`üéØ ${source === 'calendar' ? 'Ë°å‰∫ãÊõÜ' : 'Siri'} Ëß∏ÁôºËá™ÂãïÊâìÂç°ÊµÅÁ®ã...`, 'info');
            
            // È°ØÁ§∫Ëá™ÂãïÊâìÂç°‰ªãÈù¢
            showAutoCheckinInterface(source);
            
            // Ê™¢Êü•ÊòØÂê¶ÁÇ∫ÊúâÊïàÊâìÂç°ÊôÇÈñì
            if (isValidCheckinTime()) {
                // Âü∑Ë°åËá™ÂãïÊâìÂç°ÈÇèËºØ
                performSmartCheckin(source);
            } else {
                showMessage('‚è∞ Áï∂Ââç‰∏çÂú®Ë®≠ÂÆöÁöÑÊâìÂç°ÊôÇÈñìÁØÑÂúçÂÖß', 'warning');
            }
        }

        // Ê™¢Êü•ÊòØÂê¶ÁÇ∫ÊúâÊïàÊâìÂç°ÊôÇÈñì
        function isValidCheckinTime() {
            var now = new Date();
            var currentDay = now.getDay();
            var currentTime = now.getHours() * 60 + now.getMinutes();
            
            // Ê™¢Êü•ÊòØÂê¶ÁÇ∫Ë®≠ÂÆöÁöÑÊâìÂç°Êó•Êúü
            if (!settings.weeklyDays.includes(currentDay)) {
                console.log('‰ªäÂ§©‰∏çÊòØË®≠ÂÆöÁöÑÊâìÂç°Êó•Êúü');
                return false;
            }
            
            // Ê™¢Êü•ÊòØÂê¶Âú®ÊâìÂç°ÊôÇÈñìÁØÑÂúçÂÖßÔºàÂâçÂæå30ÂàÜÈêòÔºâ
            var checkinTimeParts = settings.checkinTime.split(':');
            var checkinTimeMinutes = parseInt(checkinTimeParts[0]) * 60 + parseInt(checkinTimeParts[1]);
            var timeDiff = Math.abs(currentTime - checkinTimeMinutes);
            
            if (timeDiff <= 30) {
                console.log('Âú®ÊúâÊïàÊâìÂç°ÊôÇÈñìÁØÑÂúçÂÖß');
                return true;
            }
            
            console.log(`ÊôÇÈñìÂ∑ÆÁï∞: ${timeDiff} ÂàÜÈêòÔºåË∂ÖÂá∫ÁØÑÂúç`);
            return false;
        }

        // È°ØÁ§∫Ëá™ÂãïÊâìÂç°‰ªãÈù¢
        function showAutoCheckinInterface(source) {
            var autoCheckinDiv = document.getElementById('autoCheckinInterface');
            if (!autoCheckinDiv) {
                autoCheckinDiv = document.createElement('div');
                autoCheckinDiv.id = 'autoCheckinInterface';
                autoCheckinDiv.innerHTML = `
                    <div class="auto-checkin-overlay">
                        <div class="auto-checkin-modal">
                            <div class="auto-checkin-header">
                                <h2>üéØ Ëá™ÂãïÊâìÂç°Âü∑Ë°å‰∏≠</h2>
                                <div class="auto-checkin-source">
                                    ‰æÜÊ∫êÔºö${source === 'calendar' ? 'üìÖ iOS Ë°å‰∫ãÊõÜ' : 'üó£Ô∏è Siri Êç∑Âæë'}
                                </div>
                            </div>
                            <div class="auto-checkin-content">
                                <div class="auto-checkin-status" id="autoCheckinStatus">
                                    Ê≠£Âú®Ê∫ñÂÇôÊâìÂç°...
                                </div>
                                <div class="auto-checkin-progress">
                                    <div class="progress-bar" id="autoCheckinProgress"></div>
                                </div>
                                <div class="auto-checkin-actions">
                                    <button class="btn btn-primary" onclick="proceedToCheckin()" id="proceedBtn">
                                        üöÄ Á´ãÂç≥ÂâçÂæÄÊâìÂç°
                                    </button>
                                    <button class="btn btn-secondary" onclick="closeAutoCheckin()" id="cancelBtn">
                                        ‚ùå ÂèñÊ∂à
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(autoCheckinDiv);
            }
            
            autoCheckinDiv.style.display = 'block';
        }

        // Âü∑Ë°åÊô∫ÊÖßÊâìÂç°
        function performSmartCheckin(source) {
            var statusElement = document.getElementById('autoCheckinStatus');
            var progressElement = document.getElementById('autoCheckinProgress');
            
            var steps = [
                { text: 'üîç Ê™¢Êü•ÊâìÂç°Ë®≠ÂÆö...', progress: 25 },
                { text: 'üì± Ê∫ñÂÇôÈñãÂïüÊâìÂç°È†ÅÈù¢...', progress: 50 },
                { text: 'üì§ Ê∫ñÂÇôÁôºÈÄÅ Teams ÈÄöÁü•...', progress: 75 },
                { text: 'üéâ Ëá™ÂãïÊâìÂç°ÊµÅÁ®ãÂÆåÊàêÔºÅ', progress: 100 }
            ];
            
            var currentStep = 0;
            
            var stepInterval = setInterval(() => {
                if (currentStep < steps.length) {
                    var step = steps[currentStep];
                    statusElement.textContent = step.text;
                    progressElement.style.width = step.progress + '%';
                    currentStep++;
                } else {
                    clearInterval(stepInterval);
                    // Ê∫ñÂÇôÂÆåÊàêÔºåÁõ¥Êé•Âü∑Ë°åÊâìÂç°
                    document.getElementById('proceedBtn').style.display = 'block';
                    document.getElementById('proceedBtn').textContent = 'üöÄ ÈñãÂïüÊâìÂç°È†ÅÈù¢';
                }
            }, 800);
        }

        // ÂâçÂæÄÊâìÂç°
        function proceedToCheckin() {
            closeAutoCheckin();
            
            // Ë®òÈåÑËá™ÂãïÊâìÂç°‰∫ã‰ª∂
            logAutoCheckinEvent();
            
            // ÁôºÈÄÅ Teams ÈñãÂßãÊâìÂç°ÈÄöÁü•
            sendTeamsNotification(
                'üöÄ Ëá™ÂãïÊâìÂç°Âü∑Ë°å',
                `Ë°å‰∫ãÊõÜÊèêÈÜíËß∏ÁôºËá™ÂãïÊâìÂç°\nÊôÇÈñìÔºö${new Date().toLocaleString()}\nÂç≥Â∞áÈñãÂïüÊâìÂç°È†ÅÈù¢`,
                'ÊèêÈÜí'
            );
            
            // ÈñãÂïüÊâìÂç°È†ÅÈù¢
            window.open(settings.checkinUrl, '_blank');
            
            showMessage('üöÄ Â∑≤ÈñãÂïüÊâìÂç°È†ÅÈù¢ÔºÅTeams ÈÄöÁü•Â∑≤ÁôºÈÄÅ„ÄÇ', 'success');
            
            // Âª∂ÈÅ≤Ê™¢Êü•ÊâìÂç°ÁµêÊûúÔºàÁµ¶Áî®Êà∂ÊôÇÈñìÂÆåÊàêÊâìÂç°Ôºâ
            setTimeout(() => {
                checkCheckinResult();
            }, 30000); // 30ÁßíÂæåÊ™¢Êü•
        }

        // ÈóúÈñâËá™ÂãïÊâìÂç°‰ªãÈù¢
        function closeAutoCheckin() {
            var autoCheckinDiv = document.getElementById('autoCheckinInterface');
            if (autoCheckinDiv) {
                autoCheckinDiv.style.display = 'none';
            }
        }

        // Ë®òÈåÑËá™ÂãïÊâìÂç°‰∫ã‰ª∂
        function logAutoCheckinEvent() {
            var event = {
                timestamp: new Date().toISOString(),
                source: 'auto',
                checkinTime: settings.checkinTime,
                actualTime: new Date().toTimeString().substr(0, 5)
            };
            
            var logs = JSON.parse(localStorage.getItem('checkin_logs') || '[]');
            logs.push(event);
            
            // Âè™‰øùÁïôÊúÄËøë 30 Á≠ÜË®òÈåÑ
            if (logs.length > 30) {
                logs = logs.slice(-30);
            }
            
            localStorage.setItem('checkin_logs', JSON.stringify(logs));
            console.log('üìù Ëá™ÂãïÊâìÂç°‰∫ã‰ª∂Â∑≤Ë®òÈåÑ:', event);
        }

        // Ê∏¨Ë©¶Ë°å‰∫ãÊõÜÂñöÈÜíÂäüËÉΩ
        function testCalendarWakeup() {
            showMessage('üß™ Ê®°Êì¨Ë°å‰∫ãÊõÜÂñöÈÜíÊ∏¨Ë©¶...', 'info');
            
            // Êõ¥Êñ∞ URL ÂåÖÂê´Ê∏¨Ë©¶ÂèÉÊï∏
            var testUrl = window.location.href.split('?')[0] + '?wakeup=calendar&time=' + 
                         new Date().toTimeString().substr(0, 5).replace(':', '') + '&test=true';
            
            // Âª∂ÈÅ≤Âü∑Ë°åÔºåÊ®°Êì¨ÁúüÂØ¶ÂñöÈÜíÊÉÖÂ¢É
            setTimeout(() => {
                history.pushState({}, '', testUrl);
                executeAutoCheckin('calendar');
            }, 1000);
        }

        // Teams ÈÄöÁü•ÂäüËÉΩ
        function sendTeamsNotification(title, message, level) {
            if (!settings.teamsEnabled || !settings.teamsWebhook) {
                console.log('Teams ÈÄöÁü•Â∑≤ÂÅúÁî®ÊàñÊú™Ë®≠ÂÆö Webhook');
                return Promise.resolve();
            }

            var levelColors = {
                "ÊàêÂäü": "00FF00",  // Á∂†Ëâ≤
                "ÈåØË™§": "FF0000",  // Á¥ÖËâ≤
                "ÊèêÈÜí": "FFFF00"   // ÈªÉËâ≤
            };

            var currentTime = new Date().toLocaleString('zh-TW');
            var deviceName = navigator.userAgent.includes('iPhone') ? 'iPhone' : 
                           navigator.userAgent.includes('iPad') ? 'iPad' : 'iOS Ë£ùÁΩÆ';
            var color = levelColors[level] || "00FF00";

            var payload = {
                "@type": "MessageCard",
                "@context": "http://schema.org/extensions",
                "themeColor": color,
                "title": title,
                "text": message,
                "sections": [{
                    "facts": [
                        {"name": "Ë£ùÁΩÆÂêçÁ®±", "value": deviceName},
                        {"name": "Âü∑Ë°åÊôÇÈñì", "value": currentTime},
                        {"name": "‰æÜÊ∫ê", "value": "iOS ÁµÇÊ•µÊâìÂç°Á≥ªÁµ±"}
                    ]
                }]
            };

            return sendTeamsWebhook(payload, settings.teamsWebhook)
                .catch(error => {
                    console.error('‰∏ªË¶Å Webhook ÁôºÈÄÅÂ§±Êïó:', error);
                    if (settings.teamsBackupWebhook) {
                        console.log('ÂòóË©¶ÂÇôÁî® Webhook...');
                        return sendTeamsWebhook(payload, settings.teamsBackupWebhook);
                    }
                    throw error;
                });
        }

        // ÁôºÈÄÅ Teams Webhook
        function sendTeamsWebhook(payload, webhookUrl) {
            return fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            })
            .then(response => {
                if (response.ok) {
                    console.log('‚úÖ Teams ÈÄöÁü•ÁôºÈÄÅÊàêÂäü');
                    showMessage('üì§ Teams ÈÄöÁü•ÁôºÈÄÅÊàêÂäü', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            })
            .catch(error => {
                console.error('‚ùå Teams ÈÄöÁü•ÁôºÈÄÅÂ§±Êïó:', error);
                showMessage('‚ùå Teams ÈÄöÁü•ÁôºÈÄÅÂ§±Êïó', 'error');
                throw error;
            });
        }

        // Ê™¢Êü•ÊâìÂç°ÁµêÊûú
        function checkCheckinResult() {
            // Á∞°ÂñÆÁöÑÊâìÂç°ÁµêÊûúÊ™¢Êü•ÈÇèËºØ
            // ÂØ¶Èöõ‰∏äÔºåÁî±ÊñºË∑®ÂüüÈôêÂà∂ÔºåÊàëÂÄëÁÑ°Ê≥ïÁõ¥Êé•Ê™¢Êü•ÊâìÂç°Á∂≤Á´ôÁöÑÁãÄÊÖã
            // ÊâÄ‰ª•ÈÄôË£°‰∏ªË¶ÅÊòØÁôºÈÄÅ‰∏ÄÂÄãÂÆåÊàêÈÄöÁü•
            
            sendTeamsNotification(
                '‚úÖ Ëá™ÂãïÊâìÂç°ÊµÅÁ®ãÂÆåÊàê',
                `ÊâìÂç°È†ÅÈù¢Â∑≤ÈñãÂïü\nÊôÇÈñìÔºö${new Date().toLocaleString()}\nË´ãÁ¢∫Ë™çÊâìÂç°ÊòØÂê¶ÊàêÂäü\n\nüí° Áî±ÊñºÁÄèË¶ΩÂô®ÂÆâÂÖ®ÈôêÂà∂ÔºåÁÑ°Ê≥ïËá™ÂãïÊ™¢Ê∏¨ÊâìÂç°ÁµêÊûúÔºåË´ãÊâãÂãïÁ¢∫Ë™çÊâìÂç°ÁãÄÊÖã„ÄÇ`,
                'ÊàêÂäü'
            );
        }

        // Âø´ÈÄüÈÄ±ÈñìÊó•ÊúüÂàáÊèõ
        function toggleQuickDay(day) {
            var dayBtn = document.querySelector('.quick-day-btn[data-day="' + day + '"]');
            var index = quickWeeklyDays.indexOf(day);
            
            if (index > -1) {
                quickWeeklyDays.splice(index, 1);
                dayBtn.classList.remove('selected');
            } else {
                quickWeeklyDays.push(day);
                dayBtn.classList.add('selected');
            }
            
            console.log('Âø´ÈÄüË®≠ÂÆöÈÄ±ÈñìÈÅ∏Êìá:', quickWeeklyDays);
        }

        // ÈÅ∏ÊìáÂ∑•‰ΩúÊó• (ÈÄ±‰∏ÄÂà∞ÈÄ±‰∫î)
        function selectWorkdays() {
            quickWeeklyDays = [1, 2, 3, 4, 5];
            updateQuickWeeklyDisplay();
            showMessage('üìÖ Â∑≤ÈÅ∏ÊìáÂ∑•‰ΩúÊó• (ÈÄ±‰∏ÄÂà∞ÈÄ±‰∫î)', 'info');
        }

        // ÈÅ∏ÊìáÂÖ®ÈÉ®Êó•Êúü
        function selectAllDays() {
            quickWeeklyDays = [0, 1, 2, 3, 4, 5, 6];
            updateQuickWeeklyDisplay();
            showMessage('üóìÔ∏è Â∑≤ÈÅ∏ÊìáÂÖ®ÈÉ®Êó•Êúü (ÈÄ±‰∏ÄÂà∞ÈÄ±Êó•)', 'info');
        }

        // Êõ¥Êñ∞Âø´ÈÄüÈÄ±ÈñìÈ°ØÁ§∫
        function updateQuickWeeklyDisplay() {
            // Ê∏ÖÈô§ÊâÄÊúâÈÅ∏‰∏≠ÁãÄÊÖã
            document.querySelectorAll('.quick-day-btn').forEach(function(btn) {
                btn.classList.remove('selected');
            });
            
            // Ë®≠ÂÆöÈÅ∏‰∏≠ÁãÄÊÖã
            quickWeeklyDays.forEach(function(day) {
                var dayBtn = document.querySelector('.quick-day-btn[data-day="' + day + '"]');
                if (dayBtn) {
                    dayBtn.classList.add('selected');
                }
            });
        }

        // Âø´ÈÄüË®≠ÂÆö
        function quickSetup() {
            var checkinTime = document.getElementById('quickCheckinTime').value;
            var reminderMinutes = parseInt(document.getElementById('quickReminderTime').value);
            var excludeHolidays = document.getElementById('quickExcludeHolidays').checked;
            
            if (!checkinTime) {
                showMessage('‚ùå Ë´ãË®≠ÂÆöÊâìÂç°ÊôÇÈñì', 'error');
                return;
            }
            
            if (quickWeeklyDays.length === 0) {
                showMessage('‚ùå Ë´ãÈÅ∏ÊìáËá≥Â∞ë‰∏ÄÂÄãÊâìÂç°Êó•Êúü', 'error');
                return;
            }
            
            // Êõ¥Êñ∞Ë®≠ÂÆö
            settings.checkinTime = checkinTime;
            settings.reminderMinutes = reminderMinutes;
            settings.weeklyDays = quickWeeklyDays.slice(); // Ë§áË£ΩÈô£Âàó
            settings.excludeHolidays = excludeHolidays;
            saveSettings();
            
            var dayNames = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
            var selectedDaysText = quickWeeklyDays.map(day => 'ÈÄ±' + dayNames[day]).join('„ÄÅ');
            
            showMessage('‚ö° Âø´ÈÄüË®≠ÂÆöÂÆåÊàêÔºÅ\n' +
                       'üïê ÊôÇÈñìÔºö' + checkinTime + '\n' +
                       'üìÖ Êó•ÊúüÔºö' + selectedDaysText + '\n' +
                       '‚è∞ ÊèêÈÜíÔºöÊèêÂâç' + reminderMinutes + 'ÂàÜÈêò\n' +
                       'üèñÔ∏è ÂÅáÊó•Ôºö' + (excludeHolidays ? 'Ëá™ÂãïÊéíÈô§' : '‰∏çÊéíÈô§'), 'success');
            
            // Ëá™ÂãïÈñãÂïüÊâÄÊúâÁ≥ªÁµ±Ë®≠ÂÆö
            setTimeout(() => setupIOSCalendar(), 1000);
            setTimeout(() => setupIOSAlarms(), 3000);
            setTimeout(() => setupSiriShortcuts(), 5000);
            setTimeout(() => setupReminders(), 7000);
        }

        // Ë®≠ÂÆö iOS Êó•ÊõÜ
        function setupIOSCalendar() {
            var timeParts = settings.checkinTime.split(':');
            var reminderHour = parseInt(timeParts[0]);
            var reminderMinute = parseInt(timeParts[1]) - settings.reminderMinutes;
            
            if (reminderMinute < 0) {
                reminderMinute += 60;
                reminderHour -= 1;
            }
            
            // ËΩâÊèõÈÄ±ÈñìÈÅ∏ÊìáÁÇ∫ iCal Ê†ºÂºè
            var dayMapping = ['SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'];
            var selectedDays = settings.weeklyDays.map(day => dayMapping[day]).join(',');
            
            // ÁîüÊàêÂñöÈÜí URLÔºàÁï∂ÂâçÈ†ÅÈù¢ + Ë°å‰∫ãÊõÜÂñöÈÜíÂèÉÊï∏Ôºâ
            var wakeupUrl = window.location.href.split('?')[0] + '?wakeup=calendar&time=' + 
                           reminderHour.toString().padStart(2, '0') + 
                           reminderMinute.toString().padStart(2, '0');
            
            var icalContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//iOSÁµÇÊ•µÊâìÂç°ÈÄ£ÂãïÁ≥ªÁµ±//NONSGML//EN
BEGIN:VEVENT
SUMMARY:üéØ Mphasis Ëá™ÂãïÊâìÂç°ÊèêÈÜí
DESCRIPTION:üîî Êô∫ÊÖßÊâìÂç°Á≥ªÁµ±ÂïüÂãïÔºÅ\\n\\nüì± ÈªûÊìäÊ≠§ÊèêÈÜíÂ∞áËá™ÂãïÈñãÂïüÊâìÂç°ÊáâÁî®\\nüéØ Ëá™ÂãïÂ∞éËà™Âà∞ÊâìÂç°È†ÅÈù¢\\n‚ö° Êô∫ÊÖßÊ™¢Ê∏¨ÊâìÂç°ÁãÄÊÖã\\n\\nüîó Ëá™ÂãïÂñöÈÜíÈÄ£ÁµêÔºö${wakeupUrl}\\n\\nüí° ‰ΩøÁî®ÊñπÂºèÔºö\\n1. Êî∂Âà∞ÊèêÈÜíÊôÇÈªûÊìäÈÄöÁü•\\n2. Á≥ªÁµ±Ëá™ÂãïÈñãÂïüÊâìÂç°ÊáâÁî®\\n3. Ë∑üÈö®ÊåáÂºïÂÆåÊàêÊâìÂç°
DTSTART:${formatDateForICal(reminderHour, reminderMinute)}
DTEND:${formatDateForICal(reminderHour, reminderMinute + 15)}
RRULE:FREQ=WEEKLY;BYDAY=${selectedDays}
URL:${wakeupUrl}
BEGIN:VALARM
TRIGGER:-PT0M
ACTION:DISPLAY
DESCRIPTION:üöÄ Á´ãÂç≥ÊâìÂç°ÔºÅÈªûÊìäÈñãÂïüÊô∫ÊÖßÊâìÂç°Á≥ªÁµ±
URL:${wakeupUrl}
END:VALARM
BEGIN:VALARM
TRIGGER:-PT5M
ACTION:DISPLAY
DESCRIPTION:‚è∞ 5ÂàÜÈêòÂæåÈúÄË¶ÅÊâìÂç°ÔºÅÊ∫ñÂÇôÈñãÂßã
END:VALARM
END:VEVENT`;

            // Â¶ÇÊûúÂïüÁî®ÂÅáÊó•ÊéíÈô§ÔºåÂä†ÂÖ•ÂÅáÊó•‰æãÂ§ñ
            if (settings.excludeHolidays) {
                var currentYear = new Date().getFullYear();
                var holidays = [
                    currentYear + '0101', // ÂÖÉÊó¶
                    currentYear + '0210', // Ëæ≤ÊõÜÊñ∞Âπ¥
                    currentYear + '0211',
                    currentYear + '0212',
                    currentYear + '0404', // ÂÖíÁ´•ÁØÄ
                    currentYear + '0405', // Ê∏ÖÊòéÁØÄ
                    currentYear + '0501', // ÂãûÂãïÁØÄ
                    currentYear + '0610', // Á´ØÂçàÁØÄ
                    currentYear + '0917', // ‰∏≠ÁßãÁØÄ
                    currentYear + '1010'  // ÂúãÊÖ∂Êó•
                ];
                
                icalContent += '\nEXDATE:' + holidays.map(date => date + 'T' + 
                    reminderHour.toString().padStart(2, '0') + 
                    reminderMinute.toString().padStart(2, '0') + '00Z').join(',');
            }

            icalContent += '\nEND:VEVENT\nEND:VCALENDAR';
            
            var blob = new Blob([icalContent], { type: 'text/calendar' });
            var url = URL.createObjectURL(blob);
            
            var link = document.createElement('a');
            link.href = url;
            link.download = 'mphasis-smart-checkin-calendar.ics';
            link.click();
            
            var dayNames = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
            var selectedDaysText = settings.weeklyDays.map(day => 'ÈÄ±' + dayNames[day]).join('„ÄÅ');
            
            showMessage('üìÖ Êô∫ÊÖßÈÄ£ÂãïÊó•ÊõÜÂ∑≤‰∏ãËºâÔºÅ\n' +
                       'üîó Ë°å‰∫ãÊõÜÊèêÈÜíÂ∞áËá™ÂãïÂñöÈÜíÊâìÂç°ÊáâÁî®\n' +
                       'üìã Ë®≠ÂÆöÂÖßÂÆπÔºö\n' +
                       'üïê ' + settings.checkinTime + ' ÊâìÂç°ÊèêÈÜí\n' +
                       'üìÖ ' + selectedDaysText + '\n' +
                       'üèñÔ∏è ' + (settings.excludeHolidays ? 'Â∑≤ÊéíÈô§ÂÅáÊó•' : 'ÂåÖÂê´ÂÅáÊó•') + '\n' +
                       '‚ö° Êô∫ÊÖßÂñöÈÜíÔºöË°å‰∫ãÊõÜ ‚Üí Ëá™ÂãïÊâìÂç°', 'success');
        }

        // Ê†ºÂºèÂåñÊó•ÊúüÁµ¶ iCal Áî®
        function formatDateForICal(hour, minute) {
            var date = new Date();
            date.setHours(hour, minute, 0, 0);
            return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
        }

        // Ë®≠ÂÆö iOS È¨ßÈêò
        function setupIOSAlarms() {
            var timeParts = settings.checkinTime.split(':');
            var reminderHour = parseInt(timeParts[0]);
            var reminderMinute = parseInt(timeParts[1]) - settings.reminderMinutes;
            
            if (reminderMinute < 0) {
                reminderMinute += 60;
                reminderHour -= 1;
            }
            
            var reminderTime = reminderHour.toString().padStart(2, '0') + ':' + 
                             reminderMinute.toString().padStart(2, '0');
            
            var instructions = `üì± Ë®≠ÂÆö iOS Á≥ªÁµ±È¨ßÈêòÔºö

üïê ÊèêÈÜíÊôÇÈñìÔºö${reminderTime}
üè∑Ô∏è Ê®ôÁ±§ÔºöMphasisÊâìÂç°
üîÑ ÈáçË§áÔºöÈÄ±‰∏ÄÂà∞ÈÄ±‰∫î

Ë®≠ÂÆöÊ≠•È©üÔºö
1. ÈñãÂïü„ÄåÊôÇÈêò„ÄçÊáâÁî®
2. ÈªûÊìä„ÄåÈ¨ßÈêò„ÄçÊ®ôÁ±§
3. ÈªûÊìäÂè≥‰∏äËßí„Äå+„Äç
4. Ë®≠ÂÆöÊôÇÈñìÔºö${reminderTime}
5. ÈªûÊìä„ÄåÈáçË§á„ÄçÈÅ∏ÊìáÈÄ±‰∏ÄÂà∞ÈÄ±‰∫î
6. Âú®„ÄåÊ®ôÁ±§„Äç‰∏≠Ëº∏ÂÖ•ÔºöMphasisÊâìÂç°
7. ÈªûÊìä„ÄåÂÑ≤Â≠ò„Äç

üéØ È¨ßÈêòÈüøËµ∑ÊôÇÂ∞±ÊòØÊâìÂç°ÊôÇÈñìÔºÅ`;
            
            alert(instructions);
            
            // ÂòóË©¶ÈñãÂïüÊôÇÈêòÊáâÁî®
            try {
                window.location.href = 'clock-alarm://';
            } catch (error) {
                console.log('ÁÑ°Ê≥ïËá™ÂãïÈñãÂïüÊôÇÈêòÊáâÁî®');
            }
        }

        // Ë®≠ÂÆö Siri Êç∑Âæë
        function setupSiriShortcuts() {
            var shortcutName = 'MphasisÊô∫ÊÖßÊâìÂç°';
            
            // ÁîüÊàê Siri ÂñöÈÜí URL
            var siriWakeupUrl = window.location.href.split('?')[0] + '?wakeup=siri&time=' + 
                               settings.checkinTime.replace(':', '');
            
            var instructions = `üó£Ô∏è Âª∫Á´ã Siri Êô∫ÊÖßÊâìÂç°Êç∑ÂæëÔºö

üì± Á¨¨‰∏ÄÊ≠• - Âª∫Á´ãÊç∑ÂæëÔºö
1. ÈñãÂïü„ÄåÊç∑Âæë„ÄçÊáâÁî®
2. ÈªûÊìäÂè≥‰∏äËßí„Äå+„ÄçÊñ∞Â¢ûÊç∑Âæë
3. ÊêúÂ∞ã„ÄåÈñãÂïü URL„ÄçÂãï‰Ωú
4. Ëº∏ÂÖ•ÂñöÈÜíÁ∂≤ÂùÄÔºö
   ${siriWakeupUrl}
5. Ë®≠ÂÆöÊç∑ÂæëÂêçÁ®±Ôºö„Äå${shortcutName}„Äç
6. ÈªûÊìä„ÄåÂÆåÊàê„Äç

üéôÔ∏è Á¨¨‰∫åÊ≠• - Ë™ûÈü≥Ëß∏ÁôºÔºö
1. Âú®Êç∑Âæë‰∏≠ÊâæÂà∞„Äå${shortcutName}„Äç
2. ÈªûÊìä„Äå...„ÄçË®≠ÂÆö
3. ÈªûÊìä„ÄåÂä†Âà∞ Siri„Äç
4. ÈåÑË£ΩËß∏ÁôºË©ûÔºö„ÄåÂòø SiriÔºåÊâìÂç°ÊôÇÈñì„Äç
5. ÈªûÊìä„ÄåÂÆåÊàê„Äç

‚è∞ Á¨¨‰∏âÊ≠• - Ëá™ÂãïÂåñÔºö
1. ÂàáÊèõÂà∞„ÄåËá™ÂãïÂåñ„ÄçÈ†ÅÈù¢
2. ÈªûÊìäÂè≥‰∏äËßí„Äå+„Äç
3. ÈÅ∏Êìá„ÄåÂª∫Á´ãÂÄã‰∫∫Ëá™ÂãïÂåñ„Äç
4. ÈÅ∏Êìá„ÄåÊôÇÈñì„Äç
5. Ë®≠ÂÆöÊôÇÈñìÔºö${settings.checkinTime}
6. Ë®≠ÂÆöÈáçË§áÔºöÈÅ∏ÊìáË¶ÅÊâìÂç°ÁöÑÊó•Êúü
7. ÈªûÊìä„Äå‰∏ã‰∏ÄÊ≠•„Äç
8. ÊêúÂ∞ã„ÄåÂü∑Ë°åÊç∑Âæë„Äç
9. ÈÅ∏Êìá„Äå${shortcutName}„Äç
10. ÈóúÈñâ„ÄåÂü∑Ë°åÂâçË©¢Âïè„Äç
11. ÈªûÊìä„ÄåÂÆåÊàê„Äç

üéØ Êô∫ÊÖßÂäüËÉΩÔºö
‚úÖ Ëá™ÂãïÊ™¢Ê∏¨ÊâìÂç°ÊôÇÈñì
‚úÖ Êô∫ÊÖßÈñãÂïüÊâìÂç°È†ÅÈù¢
‚úÖ ÊîØÊè¥Ë™ûÈü≥ÊéßÂà∂
‚úÖ Ëá™ÂãïÂåñÂü∑Ë°å

üîó ÂñöÈÜíÁ∂≤ÂùÄÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ`;
            
            // Ë§áË£ΩÂñöÈÜí URL Âà∞Ââ™Ë≤ºÁ∞ø
            try {
                navigator.clipboard.writeText(siriWakeupUrl);
            } catch (error) {
                console.log('ÁÑ°Ê≥ïË§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø:', error);
            }
            
            showMessage(instructions, 'info');
            
            // ÂòóË©¶ÈñãÂïüÊç∑ÂæëÊáâÁî®
            setTimeout(() => {
                try {
                    window.location.href = 'shortcuts://';
                } catch (error) {
                    console.log('ÁÑ°Ê≥ïÈñãÂïüÊç∑ÂæëÊáâÁî®:', error);
                }
            }, 2000);
        }

        // Ë®≠ÂÆö iOS ÊèêÈÜí‰∫ãÈ†Ö
        function setupReminders() {
            var instructions = `üìù Âª∫Á´ã iOS ÊèêÈÜí‰∫ãÈ†ÖÔºö

ÊèêÈÜíÂÖßÂÆπÔºö„ÄåMphasis ÊâìÂç°ÊôÇÈñì„Äç
ÊèêÈÜíÊôÇÈñìÔºöÊØèÂ§© ${settings.checkinTime}

Ë®≠ÂÆöÊ≠•È©üÔºö
1. ÈñãÂïü„ÄåÊèêÈÜí‰∫ãÈ†Ö„ÄçÊáâÁî®
2. ÈªûÊìäÂè≥‰∏ãËßí„Äå+„Äç
3. Ëº∏ÂÖ•ÔºöMphasis ÊâìÂç°ÊôÇÈñì
4. ÈªûÊìä„Äåi„ÄçÂúñÁ§∫
5. ÈñãÂïü„ÄåÂú®ÊüêÊó•ÊèêÈÜíÊàë„Äç
6. Ë®≠ÂÆöÊôÇÈñìÔºö${settings.checkinTime}
7. ÈñãÂïü„ÄåÈáçË§á„ÄçÈÅ∏Êìá„ÄåÊØèÂ§©„Äç
8. ÈªûÊìä„ÄåÂÆåÊàê„Äç

üéØ Á≥ªÁµ±ÊúÉÂú®Ë®≠ÂÆöÊôÇÈñìËá™ÂãïÊèêÈÜíÊÇ®ÊâìÂç°ÔºÅ`;
            
            alert(instructions);
            
            // ÂòóË©¶ÈñãÂïüÊèêÈÜí‰∫ãÈ†ÖÊáâÁî®
            try {
                window.location.href = 'x-apple-reminderkit://';
            } catch (error) {
                console.log('ÁÑ°Ê≥ïËá™ÂãïÈñãÂïüÊèêÈÜí‰∫ãÈ†ÖÊáâÁî®');
            }
        }

        // ÂïüÂãïÂâçÊôØ‰øùÊåÅÊ®°Âºè
        function startForegroundMode() {
            showMessage('üîÑ ÂïüÂãïÂâçÊôØ‰øùÊåÅÊ®°Âºè...', 'info');
            
            // ÈáçÁΩÆË®àÊôÇÂô®
            activeStartTime = Date.now();
            
            // ÂïüÂãïÂâçÊôØÊèêÈÜíÊ™¢Êü•
            startForegroundReminderCheck();
            
            // ÂòóË©¶‰øùÊåÅÂ±èÂπïÂñöÈÜí
            try {
                if ('wakeLock' in navigator) {
                    navigator.wakeLock.request('screen').then(function(wakeLock) {
                        console.log('üîÜ Â±èÂπï‰øùÊåÅÂñöÈÜí');
                    }).catch(function(error) {
                        console.log('ÁÑ°Ê≥ï‰øùÊåÅÂ±èÂπïÂñöÈÜí:', error);
                    });
                }
            } catch (error) {
                console.log('‰∏çÊîØÊè¥Â±èÂπïÂñöÈÜí API');
            }
            
            showMessage('‚úÖ ÂâçÊôØ‰øùÊåÅÊ®°ÂºèÂ∑≤ÂïüÂãïÔºÅË´ã‰øùÊåÅÊáâÁî®Âú®ÂâçÊôØ„ÄÇ', 'success');
        }

        // ÂïüÂãïÂâçÊôØÊèêÈÜíÊ™¢Êü•
        function startForegroundReminderCheck() {
            if (reminderInterval) {
                clearInterval(reminderInterval);
            }
            
            reminderInterval = setInterval(function() {
                if (!document.hidden) {
                    checkForReminder();
                }
            }, 30000); // ÊØè30ÁßíÊ™¢Êü•‰∏ÄÊ¨°
        }

        // ÊéíÁ®ã‰∏ãÊ¨°Ê™¢Êü•ÔºàËÉåÊôØÊ®°ÂºèÁî®Ôºâ
        function scheduleNextCheck() {
            setTimeout(function() {
                if (document.hidden) {
                    checkForReminder();
                    scheduleNextCheck(); // ÈÅûÊ≠∏ÊéíÁ®ã
                }
            }, 60000); // 1ÂàÜÈêòÂæåÊ™¢Êü•
        }

        // Ê∏¨Ë©¶ÂâçÊôØÊèêÈÜí
        function testForegroundReminder() {
            if (document.hidden) {
                showMessage('‚ö†Ô∏è Ë´ã‰øùÊåÅÊáâÁî®Âú®ÂâçÊôØ‰ª•Ê∏¨Ë©¶ÊèêÈÜí', 'warning');
                return;
            }
            
            showMessage('üß™ Ê∏¨Ë©¶ÊèêÈÜí‰∏≠...', 'info');
            setTimeout(function() {
                triggerCheckinReminder();
            }, 2000);
        }

        // Ê®°Êì¨ÊâìÂç°ÊèêÈÜí
        function showCheckinReminder() {
            triggerCheckinReminder();
        }

        // ÈñãÂïüÊâìÂç°È†ÅÈù¢
        function openCheckinPage() {
            var popup = window.open(settings.checkinUrl, 'checkin', 'width=414,height=736');
            
            if (popup) {
                showMessage('‚úÖ ÊâìÂç°È†ÅÈù¢Â∑≤ÈñãÂïüÔºÅ', 'success');
            } else {
                showMessage('‚ùå ÁÑ°Ê≥ïÈñãÂïüÈ†ÅÈù¢ÔºåË´ãÊ™¢Êü•ÂΩàÁ™óË®≠ÂÆö', 'error');
            }
        }

        // ÂÑ≤Â≠òË®≠ÂÆö
        function saveSettings() {
            try {
                localStorage.setItem('ios_ultimate_settings', JSON.stringify(settings));
            } catch (error) {
                console.error('ÂÑ≤Â≠òË®≠ÂÆöÂ§±Êïó:', error);
            }
        }

        // ËºâÂÖ•Ë®≠ÂÆö
        function loadSettings() {
            try {
                var saved = localStorage.getItem('ios_ultimate_settings');
                if (saved) {
                    var savedSettings = JSON.parse(saved);
                    settings = Object.assign(settings, savedSettings);
                    
                    // Êõ¥Êñ∞ UI
                    document.getElementById('quickCheckinTime').value = settings.checkinTime;
                    document.getElementById('quickReminderTime').value = settings.reminderMinutes;
                    document.getElementById('quickExcludeHolidays').checked = settings.excludeHolidays !== false;
                    
                    // Êõ¥Êñ∞Âø´ÈÄüÈÄ±ÈñìÈÅ∏Êìá
                    if (settings.weeklyDays) {
                        quickWeeklyDays = settings.weeklyDays.slice();
                    }
                    
                    // Êõ¥Êñ∞ Teams Ë®≠ÂÆö UI
                    if (document.getElementById('teamsEnabled')) {
                        document.getElementById('teamsEnabled').checked = settings.teamsEnabled || false;
                        document.getElementById('teamsWebhook').value = settings.teamsWebhook || '';
                        document.getElementById('teamsBackupWebhook').value = settings.teamsBackupWebhook || '';
                        updateTeamsSettings();
                    }
                }
            } catch (error) {
                console.error('ËºâÂÖ•Ë®≠ÂÆöÂ§±Êïó:', error);
            }
        }

        // Teams Ë®≠ÂÆöÁõ∏ÈóúÂáΩÊï∏
        function toggleTeamsSettings() {
            var teamsSettings = document.getElementById('teamsSettings');
            if (teamsSettings.style.display === 'none') {
                teamsSettings.style.display = 'block';
                loadSettings(); // Á¢∫‰øùËºâÂÖ•ÊúÄÊñ∞Ë®≠ÂÆö
            } else {
                teamsSettings.style.display = 'none';
            }
        }

        function updateTeamsSettings() {
            var enabled = document.getElementById('teamsEnabled').checked;
            var webhookSettings = document.getElementById('teamsWebhookSettings');
            
            if (enabled) {
                webhookSettings.style.display = 'block';
            } else {
                webhookSettings.style.display = 'none';
            }
        }

        function saveTeamsSettings() {
            var enabled = document.getElementById('teamsEnabled').checked;
            var webhook = document.getElementById('teamsWebhook').value.trim();
            var backupWebhook = document.getElementById('teamsBackupWebhook').value.trim();
            
            if (enabled && !webhook) {
                showMessage('‚ùå Ë´ãËº∏ÂÖ•‰∏ªË¶Å Webhook URL', 'error');
                return;
            }
            
            // Á∞°ÂñÆÁöÑ URL È©óË≠â
            if (enabled && webhook && !webhook.startsWith('https://')) {
                showMessage('‚ùå Webhook URL ÂøÖÈ†à‰ª• https:// ÈñãÈ†≠', 'error');
                return;
            }
            
            // Êõ¥Êñ∞Ë®≠ÂÆö
            settings.teamsEnabled = enabled;
            settings.teamsWebhook = webhook;
            settings.teamsBackupWebhook = backupWebhook;
            
            // ÂÑ≤Â≠òË®≠ÂÆö
            saveSettings();
            
            showMessage('‚úÖ Teams Ë®≠ÂÆöÂ∑≤ÂÑ≤Â≠ò', 'success');
        }

        function testTeamsNotification() {
            var enabled = document.getElementById('teamsEnabled').checked;
            var webhook = document.getElementById('teamsWebhook').value.trim();
            
            if (!enabled) {
                showMessage('‚ùå Ë´ãÂÖàÂïüÁî® Teams ÈÄöÁü•', 'error');
                return;
            }
            
            if (!webhook) {
                showMessage('‚ùå Ë´ãËº∏ÂÖ• Webhook URL', 'error');
                return;
            }
            
            // Êö´ÊôÇÊõ¥Êñ∞Ë®≠ÂÆö‰ª•ÈÄ≤Ë°åÊ∏¨Ë©¶
            var originalSettings = {
                teamsEnabled: settings.teamsEnabled,
                teamsWebhook: settings.teamsWebhook,
                teamsBackupWebhook: settings.teamsBackupWebhook
            };
            
            settings.teamsEnabled = enabled;
            settings.teamsWebhook = webhook;
            settings.teamsBackupWebhook = document.getElementById('teamsBackupWebhook').value.trim();
            
            // ÁôºÈÄÅÊ∏¨Ë©¶ÈÄöÁü•
            sendTeamsNotification(
                'üß™ Teams ÈÄöÁü•Ê∏¨Ë©¶',
                `ÈÄôÊòØ‰∏ÄÂâáÊ∏¨Ë©¶ÈÄöÁü•\nÊôÇÈñìÔºö${new Date().toLocaleString()}\nÂ¶ÇÊûúÊÇ®Êî∂Âà∞Ê≠§Ë®äÊÅØÔºåË°®Á§∫ Teams ÈÄöÁü•Ë®≠ÂÆöÊàêÂäüÔºÅ`,
                'ÊèêÈÜí'
            ).finally(() => {
                // ÊÅ¢Âæ©ÂéüÂßãË®≠ÂÆö
                settings.teamsEnabled = originalSettings.teamsEnabled;
                settings.teamsWebhook = originalSettings.teamsWebhook;
                settings.teamsBackupWebhook = originalSettings.teamsBackupWebhook;
            });
        }

        // È°ØÁ§∫Ë®äÊÅØ
        function showMessage(message, type) {
            var statusArea = document.getElementById('statusArea');
            var className = 'status-' + (type || 'info');
            
            statusArea.innerHTML = '<div class="status ' + className + ' fade-in">' + message + '</div>';
            
            setTimeout(function() {
                if (statusArea.innerHTML.includes(message)) {
                    statusArea.innerHTML = '';
                }
            }, 5000);
        }

        // È†ÅÈù¢ËºâÂÖ•ÂÆåÊàêÂæåÂàùÂßãÂåñ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }

        console.log('üèÜ iOS ÁµÇÊ•µÊâìÂç°Ëß£Ê±∫ÊñπÊ°àÂ∑≤ËºâÂÖ•');
    </script>
</body>
</html>
