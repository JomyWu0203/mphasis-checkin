<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔍 iOS 輸入限制分析</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .success { background: #e8f5e8; border-left: 4px solid #4caf50; }
        .error { background: #ffebee; border-left: 4px solid #f44336; }
        .warning { background: #fff3e0; border-left: 4px solid #ff9800; }
        .info { background: #e3f2fd; border-left: 4px solid #2196f3; }
        .btn {
            background: #2196f3;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
            width: 100%;
        }
        .btn:hover { background: #1976d2; }
        .btn-warning { background: #ff9800; }
        .btn-success { background: #4caf50; }
        .input-field {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            margin: 8px 0;
            box-sizing: border-box;
        }
        .input-field:disabled {
            background: #f5f5f5;
            color: #999;
        }
        .log {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .code {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            border: 1px solid #ddd;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>🔍 iOS 輸入限制分析工具</h1>
        <p>專門分析透過配置檔案安裝後的輸入限制問題</p>
    </div>

    <div class="card error">
        <h2>❌ 發現的問題</h2>
        <p><strong>透過安裝檔安裝後才無法輸入</strong></p>
        
        <div class="warning">
            <h3>🎯 問題根源：iOS 配置檔案的安全限制</h3>
            <ul>
                <li>🔒 <strong>受管理的 Web Clip</strong> - 使用 <code>com.apple.webClip.managed</code></li>
                <li>📱 <strong>企業安全模式</strong> - 可能限制輸入欄位</li>
                <li>🛡️ <strong>iOS MDM 限制</strong> - 防止不當修改設定</li>
                <li>⚡ <strong>FullScreen 模式</strong> - 可能影響輸入行為</li>
            </ul>
        </div>
    </div>

    <div class="card">
        <h2>🧪 輸入限制測試</h2>
        
        <div style="margin: 16px 0;">
            <h3>測試 1: 基本輸入測試</h3>
            <input type="text" id="basicInput" class="input-field" placeholder="測試基本文字輸入...">
            <button class="btn" onclick="testBasicInput()">🔍 測試基本輸入</button>
        </div>
        
        <div style="margin: 16px 0;">
            <h3>測試 2: URL 輸入測試</h3>
            <input type="url" id="urlInput" class="input-field" placeholder="測試 URL 輸入...">
            <button class="btn" onclick="testUrlInput()">🌐 測試 URL 輸入</button>
        </div>
        
        <div style="margin: 16px 0;">
            <h3>測試 3: localStorage 存取</h3>
            <input type="text" id="storageInput" class="input-field" placeholder="測試儲存功能...">
            <button class="btn" onclick="testStorage()">💾 測試儲存</button>
            <button class="btn btn-warning" onclick="loadStorage()">📥 測試載入</button>
        </div>
        
        <div style="margin: 16px 0;">
            <h3>測試 4: 動態輸入控制</h3>
            <input type="text" id="dynamicInput" class="input-field" placeholder="測試動態啟用/禁用...">
            <button class="btn" onclick="toggleInput()">🔄 切換啟用狀態</button>
        </div>
        
        <div id="testResults" style="margin-top: 16px;"></div>
    </div>

    <div class="card">
        <h2>🔧 配置檔案比較</h2>
        
        <div class="comparison">
            <div class="error" style="padding: 16px; border-radius: 8px;">
                <h3>❌ 受管理版本 (有限制)</h3>
                <div class="code">
&lt;key&gt;PayloadType&lt;/key&gt;
&lt;string&gt;com.apple.webClip.managed&lt;/string&gt;

&lt;key&gt;FullScreen&lt;/key&gt;
&lt;true/&gt;

⚠️ 可能的限制：
• 輸入欄位禁用
• 設定無法修改
• localStorage 受限
• 安全模式啟用
</div>
            </div>
            
            <div class="success" style="padding: 16px; border-radius: 8px;">
                <h3>✅ 無管理版本 (無限制)</h3>
                <div class="code">
&lt;key&gt;PayloadType&lt;/key&gt;
&lt;string&gt;com.apple.webClip&lt;/string&gt;

&lt;key&gt;FullScreen&lt;/key&gt;
&lt;false/&gt;

✅ 無限制：
• 正常輸入功能
• 完整設定權限
• localStorage 可用
• 標準網頁模式
</div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>🛠️ 解決方案</h2>
        
        <div class="success">
            <h3>方案 1: 使用無管理配置檔案 (推薦)</h3>
            <p>我已經創建了一個新的配置檔案：<code>ios_ultimate_unmanaged_configuration_profile.mobileconfig</code></p>
            <ul>
                <li>✅ 移除 <code>.managed</code> 限制</li>
                <li>✅ 關閉 FullScreen 模式</li>
                <li>✅ 保持完整輸入功能</li>
                <li>✅ 允許正常的網頁互動</li>
            </ul>
            
            <button class="btn btn-success" onclick="downloadUnmanagedProfile()">
                📥 下載無限制版配置檔案
            </button>
        </div>
        
        <div class="info">
            <h3>方案 2: 直接網頁存取 (備用)</h3>
            <p>如果配置檔案仍有問題，直接使用網頁版本：</p>
            
            <button class="btn" onclick="openDirectWeb()">
                🌐 直接開啟網頁版 (無安裝)
            </button>
            
            <button class="btn btn-warning" onclick="openDebugTool()">
                🔧 開啟設定除錯工具
            </button>
        </div>
        
        <div class="warning">
            <h3>方案 3: 移除現有配置檔案</h3>
            <p>先移除現有的受管理配置檔案，再安裝新版本：</p>
            <ol>
                <li>前往「設定」→「一般」→「VPN與裝置管理」</li>
                <li>找到「iOS終極打卡解決方案」</li>
                <li>點擊「移除描述檔」</li>
                <li>重新安裝無限制版配置檔案</li>
            </ol>
        </div>
    </div>

    <div class="card">
        <h2>📋 測試記錄</h2>
        <div id="testLog" class="log"></div>
        <button class="btn" onclick="clearLog()">🗑️ 清除記錄</button>
    </div>

    <div class="card">
        <h2>🔍 系統資訊</h2>
        <div id="systemInfo" class="log"></div>
    </div>

    <script>
        function log(message) {
            var logElement = document.getElementById('testLog');
            var timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function showResult(type, message) {
            var resultDiv = document.getElementById('testResults');
            resultDiv.innerHTML = `<div class="${type}" style="margin-top: 16px; padding: 12px; border-radius: 8px;">${message}</div>`;
        }

        function testBasicInput() {
            var input = document.getElementById('basicInput');
            var testValue = 'Test Input ' + new Date().getTime();
            
            log('🧪 測試基本輸入功能...');
            
            try {
                input.value = testValue;
                input.focus();
                
                if (input.value === testValue) {
                    log('✅ 基本輸入正常');
                    showResult('success', '✅ 基本輸入功能正常');
                } else {
                    log('❌ 基本輸入失敗');
                    showResult('error', '❌ 基本輸入功能異常');
                }
                
                log(`   - 輸入值: "${input.value}"`);
                log(`   - 禁用狀態: ${input.disabled}`);
                log(`   - 唯讀狀態: ${input.readOnly}`);
                
            } catch (error) {
                log('❌ 基本輸入測試失敗: ' + error.message);
                showResult('error', '❌ 基本輸入測試失敗: ' + error.message);
            }
        }

        function testUrlInput() {
            var input = document.getElementById('urlInput');
            var testUrl = 'https://example.com/test-' + Date.now();
            
            log('🌐 測試 URL 輸入功能...');
            
            try {
                input.value = testUrl;
                input.focus();
                
                if (input.value === testUrl) {
                    log('✅ URL 輸入正常');
                    showResult('success', '✅ URL 輸入功能正常');
                } else {
                    log('❌ URL 輸入失敗');
                    showResult('error', '❌ URL 輸入功能異常');
                }
                
                log(`   - URL 值: "${input.value}"`);
                log(`   - 驗證狀態: ${input.validity.valid}`);
                
            } catch (error) {
                log('❌ URL 輸入測試失敗: ' + error.message);
                showResult('error', '❌ URL 輸入測試失敗: ' + error.message);
            }
        }

        function testStorage() {
            var input = document.getElementById('storageInput');
            var testData = input.value || ('Test Data ' + new Date().getTime());
            
            log('💾 測試 localStorage 功能...');
            
            try {
                localStorage.setItem('ios_input_test', testData);
                var stored = localStorage.getItem('ios_input_test');
                
                if (stored === testData) {
                    log('✅ localStorage 儲存正常');
                    showResult('success', '✅ localStorage 功能正常');
                } else {
                    log('❌ localStorage 儲存失敗');
                    showResult('error', '❌ localStorage 功能異常');
                }
                
                log(`   - 儲存值: "${testData}"`);
                log(`   - 讀取值: "${stored}"`);
                
            } catch (error) {
                log('❌ localStorage 測試失敗: ' + error.message);
                showResult('error', '❌ localStorage 不可用: ' + error.message);
            }
        }

        function loadStorage() {
            var input = document.getElementById('storageInput');
            
            log('📥 測試 localStorage 載入...');
            
            try {
                var stored = localStorage.getItem('ios_input_test');
                if (stored) {
                    input.value = stored;
                    log('✅ localStorage 載入成功');
                    showResult('success', '✅ 從 localStorage 載入成功');
                } else {
                    log('⚠️ localStorage 中沒有資料');
                    showResult('warning', '⚠️ localStorage 中沒有測試資料');
                }
                
                log(`   - 載入值: "${stored}"`);
                
            } catch (error) {
                log('❌ localStorage 載入失敗: ' + error.message);
                showResult('error', '❌ localStorage 載入失敗: ' + error.message);
            }
        }

        function toggleInput() {
            var input = document.getElementById('dynamicInput');
            
            log('🔄 測試動態輸入控制...');
            
            try {
                input.disabled = !input.disabled;
                
                log(`✅ 輸入欄位切換為: ${input.disabled ? '禁用' : '啟用'}`);
                showResult('info', `ℹ️ 輸入欄位現在是: ${input.disabled ? '禁用' : '啟用'}`);
                
                // 測試在不同狀態下的輸入
                if (!input.disabled) {
                    input.value = 'Dynamic Test ' + Date.now();
                    input.focus();
                }
                
            } catch (error) {
                log('❌ 動態控制測試失敗: ' + error.message);
                showResult('error', '❌ 動態控制失敗: ' + error.message);
            }
        }

        function downloadUnmanagedProfile() {
            log('📥 準備下載無限制版配置檔案...');
            
            // 創建下載連結
            var link = document.createElement('a');
            link.href = 'ios_ultimate_unmanaged_configuration_profile.mobileconfig';
            link.download = 'ios_ultimate_unmanaged_configuration_profile.mobileconfig';
            link.click();
            
            showResult('success', '✅ 無限制版配置檔案下載開始！安裝後應該能正常輸入。');
            log('✅ 下載連結已觸發');
        }

        function openDirectWeb() {
            log('🌐 開啟直接網頁版本...');
            
            try {
                window.open('ios_ultimate_checkin.html', '_blank');
                showResult('info', 'ℹ️ 已開啟網頁版本，無配置檔案限制');
                log('✅ 網頁版本已開啟');
            } catch (error) {
                log('❌ 開啟網頁版本失敗: ' + error.message);
                showResult('error', '❌ 無法開啟網頁版本');
            }
        }

        function openDebugTool() {
            log('🔧 開啟設定除錯工具...');
            
            try {
                window.open('teams_settings_debug.html', '_blank');
                showResult('info', 'ℹ️ 已開啟除錯工具');
                log('✅ 除錯工具已開啟');
            } catch (error) {
                log('❌ 開啟除錯工具失敗: ' + error.message);
                showResult('error', '❌ 無法開啟除錯工具');
            }
        }

        function clearLog() {
            document.getElementById('testLog').textContent = '';
            document.getElementById('testResults').innerHTML = '';
        }

        function updateSystemInfo() {
            var systemDiv = document.getElementById('systemInfo');
            var info = [];
            
            // 基本系統資訊
            info.push('🔍 系統資訊分析:');
            info.push('');
            info.push(`📱 User Agent: ${navigator.userAgent}`);
            info.push(`🌐 平台: ${navigator.platform}`);
            info.push(`📋 語言: ${navigator.language}`);
            info.push(`⏰ 時區: ${Intl.DateTimeFormat().resolvedOptions().timeZone}`);
            info.push('');
            
            // 檢測是否為 iOS
            var isiOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            info.push(`📱 iOS 裝置: ${isiOS ? '是' : '否'}`);
            
            // 檢測是否在 Safari
            var isSafari = /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent);
            info.push(`🧭 Safari 瀏覽器: ${isSafari ? '是' : '否'}`);
            
            // 檢測是否為 Web Clip
            var isStandalone = window.navigator.standalone;
            info.push(`📲 Web Clip 模式: ${isStandalone ? '是 (可能有限制)' : '否 (網頁模式)'}`);
            
            // 檢測是否為全螢幕
            var isFullscreen = window.innerHeight === screen.height;
            info.push(`🖥️ 全螢幕模式: ${isFullscreen ? '是' : '否'}`);
            
            info.push('');
            
            // localStorage 支援
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                info.push('💾 localStorage: ✅ 支援');
            } catch (e) {
                info.push('💾 localStorage: ❌ 不支援 - ' + e.message);
            }
            
            // 檢測螢幕資訊
            info.push('');
            info.push('📏 螢幕資訊:');
            info.push(`   - 視窗大小: ${window.innerWidth} x ${window.innerHeight}`);
            info.push(`   - 螢幕大小: ${screen.width} x ${screen.height}`);
            info.push(`   - 裝置像素比: ${window.devicePixelRatio}`);
            
            systemDiv.textContent = info.join('\n');
        }

        // 頁面載入時初始化
        window.onload = function() {
            log('🔍 iOS 輸入限制分析工具已載入');
            updateSystemInfo();
            
            // 檢測是否為受管理的 Web Clip
            if (window.navigator.standalone) {
                log('⚠️ 檢測到 Web Clip 模式，可能存在輸入限制');
                showResult('warning', '⚠️ 目前在 Web Clip 模式下，可能存在輸入限制');
            } else {
                log('ℹ️ 目前在標準網頁模式下');
                showResult('info', 'ℹ️ 目前在標準網頁模式下，應該沒有輸入限制');
            }
        };
    </script>
</body>
</html>
