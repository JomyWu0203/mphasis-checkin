<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mphasis ÊâìÂç°Á≥ªÁµ± - Ë™øË©¶Áâà</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MphasisÊâìÂç°Ë™øË©¶">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Theme Colors -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-status-bar-style" content="#667eea">
    
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #4CAF50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --info-color: #2196F3;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: var(--text-dark);
            padding: 20px;
        }

        .container {
            max-width: 414px;
            margin: 0 auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 10px;
        }

        .header h1 {
            color: var(--text-dark);
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .debug-badge {
            background: linear-gradient(45deg, var(--warning-color), #f57c00);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 8px;
            display: inline-block;
        }

        .time-card {
            text-align: center;
            margin-bottom: 20px;
        }

        .current-time {
            font-size: 2.5rem;
            font-weight: 300;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-family: monospace;
        }

        .current-date {
            color: var(--text-light);
            font-size: 1rem;
        }

        .button {
            width: 100%;
            padding: 16px 20px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
        }

        .button-primary {
            background: linear-gradient(45deg, var(--success-color), #45a049);
            color: white;
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
        }

        .button-secondary {
            background: linear-gradient(45deg, var(--info-color), #1976D2);
            color: white;
            box-shadow: 0 4px 20px rgba(33, 150, 243, 0.3);
        }

        .button-warning {
            background: linear-gradient(45deg, var(--warning-color), #f57c00);
            color: white;
            box-shadow: 0 4px 20px rgba(255, 152, 0, 0.3);
        }

        .button-error {
            background: linear-gradient(45deg, var(--error-color), #d32f2f);
            color: white;
            box-shadow: 0 4px 20px rgba(244, 67, 54, 0.3);
        }

        .button:active {
            transform: translateY(2px);
        }

        .button:disabled {
            background: #bdc3c7;
            color: #7f8c8d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .debug-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.85rem;
            margin-bottom: 16px;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 4px 8px;
            border-radius: 4px;
            border-left: 3px solid;
        }

        .log-success {
            background: rgba(76, 175, 80, 0.1);
            border-left-color: var(--success-color);
            color: #2e7d32;
        }

        .log-error {
            background: rgba(244, 67, 54, 0.1);
            border-left-color: var(--error-color);
            color: #c62828;
        }

        .log-warning {
            background: rgba(255, 152, 0, 0.1);
            border-left-color: var(--warning-color);
            color: #ef6c00;
        }

        .log-info {
            background: rgba(33, 150, 243, 0.1);
            border-left-color: var(--info-color);
            color: #1565c0;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success { background: var(--success-color); }
        .status-error { background: var(--error-color); }
        .status-warning { background: var(--warning-color); }
        .status-info { background: var(--info-color); }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .test-results {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
        }

        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .test-item:last-child {
            border-bottom: none;
        }

        .test-name {
            font-weight: 500;
        }

        .test-status {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .clear-button {
            background: none;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-left: 8px;
        }

        .url-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            font-family: monospace;
            font-size: 0.9rem;
            word-break: break-all;
            margin: 8px 0;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, var(--success-color), #45a049);
            width: 0%;
            transition: width 0.3s ease;
        }

        .error-details {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid var(--error-color);
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            font-size: 0.9rem;
            color: #c62828;
        }

        .success-details {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--success-color);
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            font-size: 0.9rem;
            color: #2e7d32;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ê®ôÈ°å -->
        <div class="card header">
            <h1>üîß Mphasis ÊâìÂç°Á≥ªÁµ±Ë™øË©¶</h1>
            <div style="color: var(--text-light); font-size: 1rem;">ÂïèÈ°åË®∫Êñ∑Ëàá‰øÆÂæ©Â∑•ÂÖ∑</div>
            <div class="debug-badge">Ë™øË©¶Ê®°Âºè</div>
        </div>

        <!-- ÊôÇÈñìÈ°ØÁ§∫ -->
        <div class="card time-card">
            <div class="current-time" id="currentTime">--:--</div>
            <div class="current-date" id="currentDate">ËºâÂÖ•‰∏≠...</div>
        </div>

        <!-- Á≥ªÁµ±Ê™¢Ê∏¨ -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: var(--text-dark);">üîç Á≥ªÁµ±Áõ∏ÂÆπÊÄßÊ™¢Ê∏¨</h3>
            
            <button class="button button-secondary" onclick="runSystemTests()">
                üß™ Âü∑Ë°åÂÆåÊï¥Ê™¢Ê∏¨
            </button>

            <div class="test-results" id="testResults">
                <div class="test-item">
                    <span class="test-name">ÁÄèË¶ΩÂô®Ê™¢Ê∏¨</span>
                    <span class="test-status" id="browserTest">
                        <span class="status-indicator status-warning"></span>
                        Á≠âÂæÖÊ™¢Ê∏¨
                    </span>
                </div>
                <div class="test-item">
                    <span class="test-name">JavaScript ÊîØÊè¥</span>
                    <span class="test-status" id="jsTest">
                        <span class="status-indicator status-warning"></span>
                        Á≠âÂæÖÊ™¢Ê∏¨
                    </span>
                </div>
                <div class="test-item">
                    <span class="test-name">ÂΩàÁ™óÊ¨äÈôê</span>
                    <span class="test-status" id="popupTest">
                        <span class="status-indicator status-warning"></span>
                        Á≠âÂæÖÊ™¢Ê∏¨
                    </span>
                </div>
                <div class="test-item">
                    <span class="test-name">Á∂≤Ë∑ØÈÄ£Á∑ö</span>
                    <span class="test-status" id="networkTest">
                        <span class="status-indicator status-warning"></span>
                        Á≠âÂæÖÊ™¢Ê∏¨
                    </span>
                </div>
                <div class="test-item">
                    <span class="test-name">Êú¨Âú∞ÂÑ≤Â≠ò</span>
                    <span class="test-status" id="storageTest">
                        <span class="status-indicator status-warning"></span>
                        Á≠âÂæÖÊ™¢Ê∏¨
                    </span>
                </div>
            </div>
        </div>

        <!-- ÊâìÂç°Ê∏¨Ë©¶ -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: var(--text-dark);">üéØ ÊâìÂç°ÂäüËÉΩÊ∏¨Ë©¶</h3>
            
            <div class="form-group">
                <label for="testUrl">Ê∏¨Ë©¶Á∂≤ÂùÄÔºö</label>
                <input type="url" id="testUrl" value="https://mphasisone.mphasis.com/" placeholder="Ë´ãËº∏ÂÖ•ÊâìÂç°Á∂≤ÂùÄ">
            </div>

            <button class="button button-primary" onclick="testBasicOpen()">
                üåê Ê∏¨Ë©¶Âü∫Êú¨ÈñãÂïüÂäüËÉΩ
            </button>

            <button class="button button-secondary" onclick="testWithDelay()">
                ‚è±Ô∏è Ê∏¨Ë©¶Âª∂ÈÅ≤ÈñãÂïü
            </button>

            <button class="button button-warning" onclick="testPopupSettings()">
                üîß Ê∏¨Ë©¶ÂΩàÁ™óË®≠ÂÆö
            </button>

            <button class="button button-error" onclick="testFallbackMethod()">
                üõ°Ô∏è Ê∏¨Ë©¶ÂÇôÁî®ÊñπÊ°à
            </button>

            <div id="testProgressBar" class="progress-bar hidden">
                <div class="progress-fill" id="testProgress"></div>
            </div>

            <div id="testResult"></div>
        </div>

        <!-- Ë™øË©¶Êó•Ë™å -->
        <div class="card">
            <h3 style="margin-bottom: 8px; color: var(--text-dark);">üìã Ë™øË©¶Êó•Ë™å</h3>
            <button class="clear-button" onclick="clearDebugLog()">Ê∏ÖÈô§Êó•Ë™å</button>
            
            <div class="debug-log" id="debugLog">
                <div class="log-entry log-info">
                    <strong>[INFO]</strong> Ë™øË©¶Á≥ªÁµ±Â∑≤ÂïüÂãï
                </div>
            </div>
        </div>

        <!-- ‰øÆÂæ©Âª∫Ë≠∞ -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: var(--text-dark);">üõ†Ô∏è Â∏∏Ë¶ãÂïèÈ°å‰øÆÂæ©</h3>
            
            <button class="button button-secondary" onclick="showPopupHelp()">
                üö´ ÂΩàÁ™óË¢´ÈòªÊìãÁöÑËß£Ê±∫ÊñπÊ°à
            </button>

            <button class="button button-secondary" onclick="showSafariHelp()">
                üçé Safari ÁâπÊÆäË®≠ÂÆöË™™Êòé
            </button>

            <button class="button button-secondary" onclick="showAlternativeMethod()">
                üîÑ Êõø‰ª£ÊâìÂç°ÊñπÊ≥ï
            </button>

            <div id="helpContent"></div>
        </div>

        <!-- Âº∑Âà∂ÊâìÂç°Â∑•ÂÖ∑ -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: var(--text-dark);">üí™ Âº∑Âà∂ÊâìÂç°Â∑•ÂÖ∑</h3>
            <p style="margin-bottom: 16px; color: var(--text-light); font-size: 0.9rem;">
                Â¶ÇÊûúÊ®ôÊ∫ñÊñπÊ≥ïÁÑ°ÊïàÔºå‰ΩøÁî®‰ª•‰∏ãÊñπÊ≥ïÂº∑Âà∂ÈñãÂïüÊâìÂç°Á∂≤Á´ô
            </p>

            <button class="button button-primary" onclick="forceOpenSite()">
                üöÄ Âº∑Âà∂ÈñãÂïüÊâìÂç°Á∂≤Á´ô
            </button>

            <button class="button button-secondary" onclick="copyUrlToClipboard()">
                üìã Ë§áË£ΩÁ∂≤ÂùÄÂà∞Ââ™Ë≤ºÁ∞ø
            </button>

            <button class="button button-warning" onclick="createBookmark()">
                üîñ Âª∫Á´ãÊâìÂç°Êõ∏Á±§
            </button>

            <div class="url-display" id="currentUrl">
                Áï∂ÂâçÊâìÂç°Á∂≤ÂùÄÔºöloading...
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®ÂüüËÆäÊï∏
        let debugLog = [];
        let testResults = {};

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            updateCurrentUrl();
            addDebugLog('Á≥ªÁµ±ÂàùÂßãÂåñÂÆåÊàê', 'info');
        });

        // Êõ¥Êñ∞ÊôÇÈñì
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-TW', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            const dateStr = now.toLocaleDateString('zh-TW', { 
                year: 'numeric',
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            });
            
            document.getElementById('currentTime').textContent = timeStr;
            document.getElementById('currentDate').textContent = dateStr;
        }

        // Êõ¥Êñ∞Áï∂ÂâçÁ∂≤ÂùÄÈ°ØÁ§∫
        function updateCurrentUrl() {
            const url = document.getElementById('testUrl').value;
            document.getElementById('currentUrl').textContent = `Áï∂ÂâçÊâìÂç°Á∂≤ÂùÄÔºö${url}`;
        }

        // Ê∑ªÂä†Ë™øË©¶Êó•Ë™å
        function addDebugLog(message, level = 'info') {
            const timestamp = new Date().toLocaleTimeString('zh-TW');
            const entry = { timestamp, message, level };
            debugLog.push(entry);
            
            const logContainer = document.getElementById('debugLog');
            const logElement = document.createElement('div');
            logElement.className = `log-entry log-${level}`;
            logElement.innerHTML = `<strong>[${level.toUpperCase()}]</strong> ${timestamp} - ${message}`;
            
            logContainer.appendChild(logElement);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            console.log(`[${level.toUpperCase()}] ${message}`);
        }

        // Ê∏ÖÈô§Ë™øË©¶Êó•Ë™å
        function clearDebugLog() {
            debugLog = [];
            document.getElementById('debugLog').innerHTML = `
                <div class="log-entry log-info">
                    <strong>[INFO]</strong> Êó•Ë™åÂ∑≤Ê∏ÖÈô§
                </div>
            `;
            addDebugLog('Ë™øË©¶Êó•Ë™åÂ∑≤Ê∏ÖÈô§', 'info');
        }

        // Âü∑Ë°åÁ≥ªÁµ±Ê™¢Ê∏¨
        function runSystemTests() {
            addDebugLog('ÈñãÂßãÂü∑Ë°åÁ≥ªÁµ±Áõ∏ÂÆπÊÄßÊ™¢Ê∏¨', 'info');
            
            // ÁÄèË¶ΩÂô®Ê™¢Ê∏¨
            const userAgent = navigator.userAgent;
            const isSafari = /^((?!chrome|android).)*safari/i.test(userAgent);
            const isChrome = /chrome/i.test(userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(userAgent);
            
            let browserResult = 'unknown';
            if (isSafari && isIOS) {
                browserResult = 'iOS Safari';
                updateTestStatus('browserTest', 'success', 'iOS Safari ‚úì');
            } else if (isChrome) {
                browserResult = 'Chrome';
                updateTestStatus('browserTest', 'success', 'Chrome ‚úì');
            } else {
                browserResult = userAgent.substring(0, 50);
                updateTestStatus('browserTest', 'warning', 'ÂÖ∂‰ªñÁÄèË¶ΩÂô®');
            }
            addDebugLog(`ÁÄèË¶ΩÂô®Ê™¢Ê∏¨Ôºö${browserResult}`, 'info');

            // JavaScript Ê™¢Ê∏¨
            try {
                const testFunc = () => true;
                const jsWorking = testFunc();
                updateTestStatus('jsTest', 'success', 'JavaScript ‚úì');
                addDebugLog('JavaScript ÂäüËÉΩÊ≠£Â∏∏', 'success');
            } catch (e) {
                updateTestStatus('jsTest', 'error', 'JavaScript ‚úó');
                addDebugLog('JavaScript ÂäüËÉΩÁï∞Â∏∏Ôºö' + e.message, 'error');
            }

            // ÂΩàÁ™óÊ¨äÈôêÊ™¢Ê∏¨
            setTimeout(() => {
                try {
                    const popup = window.open('', '_blank', 'width=1,height=1');
                    if (popup && !popup.closed) {
                        popup.close();
                        updateTestStatus('popupTest', 'success', 'ÂΩàÁ™óÂÖÅË®± ‚úì');
                        addDebugLog('ÂΩàÁ™óÊ¨äÈôêÊ≠£Â∏∏', 'success');
                    } else {
                        updateTestStatus('popupTest', 'error', 'ÂΩàÁ™óË¢´ÈòªÊìã ‚úó');
                        addDebugLog('ÂΩàÁ™óË¢´ÁÄèË¶ΩÂô®ÈòªÊìã', 'error');
                    }
                } catch (e) {
                    updateTestStatus('popupTest', 'error', 'ÂΩàÁ™óÊ∏¨Ë©¶Â§±Êïó ‚úó');
                    addDebugLog('ÂΩàÁ™óÊ∏¨Ë©¶Áï∞Â∏∏Ôºö' + e.message, 'error');
                }
            }, 1000);

            // Á∂≤Ë∑ØÈÄ£Á∑öÊ™¢Ê∏¨
            if (navigator.onLine) {
                updateTestStatus('networkTest', 'success', 'Á∂≤Ë∑ØÈÄ£Á∑ö ‚úì');
                addDebugLog('Á∂≤Ë∑ØÈÄ£Á∑öÊ≠£Â∏∏', 'success');
            } else {
                updateTestStatus('networkTest', 'error', 'Á∂≤Ë∑ØÈõ¢Á∑ö ‚úó');
                addDebugLog('Á∂≤Ë∑ØÈÄ£Á∑öÁï∞Â∏∏', 'error');
            }

            // Êú¨Âú∞ÂÑ≤Â≠òÊ™¢Ê∏¨
            try {
                localStorage.setItem('test', 'value');
                const stored = localStorage.getItem('test');
                localStorage.removeItem('test');
                
                if (stored === 'value') {
                    updateTestStatus('storageTest', 'success', 'Êú¨Âú∞ÂÑ≤Â≠ò ‚úì');
                    addDebugLog('Êú¨Âú∞ÂÑ≤Â≠òÂäüËÉΩÊ≠£Â∏∏', 'success');
                } else {
                    updateTestStatus('storageTest', 'error', 'Êú¨Âú∞ÂÑ≤Â≠ò ‚úó');
                    addDebugLog('Êú¨Âú∞ÂÑ≤Â≠òÂäüËÉΩÁï∞Â∏∏', 'error');
                }
            } catch (e) {
                updateTestStatus('storageTest', 'error', 'Êú¨Âú∞ÂÑ≤Â≠ò ‚úó');
                addDebugLog('Êú¨Âú∞ÂÑ≤Â≠òÊ∏¨Ë©¶Â§±ÊïóÔºö' + e.message, 'error');
            }
        }

        // Êõ¥Êñ∞Ê∏¨Ë©¶ÁãÄÊÖã
        function updateTestStatus(testId, status, text) {
            const element = document.getElementById(testId);
            const indicator = element.querySelector('.status-indicator');
            
            indicator.className = `status-indicator status-${status}`;
            element.innerHTML = `
                <span class="status-indicator status-${status}"></span>
                ${text}
            `;
        }

        // Ê∏¨Ë©¶Âü∫Êú¨ÈñãÂïüÂäüËÉΩ
        function testBasicOpen() {
            const url = document.getElementById('testUrl').value;
            addDebugLog(`Ê∏¨Ë©¶Âü∫Êú¨ÈñãÂïüÂäüËÉΩÔºö${url}`, 'info');
            
            showProgressBar();
            
            try {
                const newWindow = window.open(url, '_blank');
                
                setTimeout(() => {
                    hideProgressBar();
                    
                    if (newWindow && !newWindow.closed) {
                        showTestResult('success', '‚úÖ Âü∫Êú¨ÈñãÂïüÂäüËÉΩÊ≠£Â∏∏ÔºÅÊñ∞Ë¶ñÁ™óÂ∑≤ÈñãÂïü„ÄÇ');
                        addDebugLog('Âü∫Êú¨ÈñãÂïüÂäüËÉΩÊ∏¨Ë©¶ÊàêÂäü', 'success');
                        
                        // 5ÁßíÂæåÊ™¢Êü•Ë¶ñÁ™óÁãÄÊÖã
                        setTimeout(() => {
                            if (!newWindow.closed) {
                                addDebugLog('Êñ∞Ë¶ñÁ™ó‰ªçÁÑ∂ÈñãÂïüÔºåÂäüËÉΩÊ≠£Â∏∏', 'success');
                            } else {
                                addDebugLog('Êñ∞Ë¶ñÁ™óÂ∑≤ÈóúÈñâ', 'info');
                            }
                        }, 5000);
                    } else {
                        showTestResult('error', '‚ùå Âü∫Êú¨ÈñãÂïüÂäüËÉΩÂ§±ÊïóÔºÅÂèØËÉΩÊòØÂΩàÁ™óË¢´ÈòªÊìã„ÄÇ');
                        addDebugLog('Âü∫Êú¨ÈñãÂïüÂäüËÉΩÊ∏¨Ë©¶Â§±ÊïóÔºöÂΩàÁ™óË¢´ÈòªÊìã', 'error');
                    }
                }, 2000);
                
            } catch (error) {
                hideProgressBar();
                showTestResult('error', `‚ùå ÈñãÂïüÂ§±ÊïóÔºö${error.message}`);
                addDebugLog(`ÈñãÂïüÂ§±ÊïóÔºö${error.message}`, 'error');
            }
        }

        // Ê∏¨Ë©¶Âª∂ÈÅ≤ÈñãÂïü
        function testWithDelay() {
            const url = document.getElementById('testUrl').value;
            addDebugLog(`Ê∏¨Ë©¶Âª∂ÈÅ≤ÈñãÂïüÔºö${url}`, 'info');
            
            showProgressBar();
            
            setTimeout(() => {
                try {
                    const newWindow = window.open(url, '_blank');
                    hideProgressBar();
                    
                    if (newWindow && !newWindow.closed) {
                        showTestResult('success', '‚úÖ Âª∂ÈÅ≤ÈñãÂïüÊ∏¨Ë©¶ÊàêÂäüÔºÅ');
                        addDebugLog('Âª∂ÈÅ≤ÈñãÂïüÊ∏¨Ë©¶ÊàêÂäü', 'success');
                    } else {
                        showTestResult('error', '‚ùå Âª∂ÈÅ≤ÈñãÂïüÊ∏¨Ë©¶Â§±ÊïóÔºÅ');
                        addDebugLog('Âª∂ÈÅ≤ÈñãÂïüÊ∏¨Ë©¶Â§±Êïó', 'error');
                    }
                } catch (error) {
                    hideProgressBar();
                    showTestResult('error', `‚ùå Âª∂ÈÅ≤ÈñãÂïüÂ§±ÊïóÔºö${error.message}`);
                    addDebugLog(`Âª∂ÈÅ≤ÈñãÂïüÂ§±ÊïóÔºö${error.message}`, 'error');
                }
            }, 3000);
        }

        // Ê∏¨Ë©¶ÂΩàÁ™óË®≠ÂÆö
        function testPopupSettings() {
            addDebugLog('Ê™¢Êü•ÂΩàÁ™óË®≠ÂÆö', 'info');
            
            const popup1 = window.open('', '_blank', 'width=100,height=100');
            const popup2 = window.open('', '_blank', 'popup=yes');
            const popup3 = window.open('', '_blank', 'noopener,noreferrer');
            
            setTimeout(() => {
                let workingMethods = [];
                
                if (popup1 && !popup1.closed) {
                    workingMethods.push('Ê®ôÊ∫ñÊñπÂºè');
                    popup1.close();
                }
                
                if (popup2 && !popup2.closed) {
                    workingMethods.push('popupÂèÉÊï∏');
                    popup2.close();
                }
                
                if (popup3 && !popup3.closed) {
                    workingMethods.push('ÂÆâÂÖ®ÊñπÂºè');
                    popup3.close();
                }
                
                if (workingMethods.length > 0) {
                    showTestResult('success', `‚úÖ ÂèØÁî®ÊñπÊ≥ïÔºö${workingMethods.join(', ')}`);
                    addDebugLog(`ÂΩàÁ™óÊ∏¨Ë©¶ÊàêÂäüÔºåÂèØÁî®ÊñπÊ≥ïÔºö${workingMethods.join(', ')}`, 'success');
                } else {
                    showTestResult('error', '‚ùå ÊâÄÊúâÂΩàÁ™óÊñπÊ≥ïÈÉΩË¢´ÈòªÊìã');
                    addDebugLog('ÊâÄÊúâÂΩàÁ™óÊñπÊ≥ïÈÉΩË¢´ÈòªÊìã', 'error');
                }
            }, 2000);
        }

        // Ê∏¨Ë©¶ÂÇôÁî®ÊñπÊ°à
        function testFallbackMethod() {
            const url = document.getElementById('testUrl').value;
            addDebugLog(`Ê∏¨Ë©¶ÂÇôÁî®ÊñπÊ°àÔºö${url}`, 'info');
            
            try {
                // ÊñπÊ≥ï‰∏ÄÔºölocation.href
                if (confirm('Ê∏¨Ë©¶ÊñπÊ≥ï‰∏ÄÔºöÁõ¥Êé•Ë∑≥ËΩâÔºàÊúÉÈõ¢ÈñãÁï∂ÂâçÈ†ÅÈù¢Ôºâ\\n\\nÈªûÊìäÁ¢∫ÂÆöÊ∏¨Ë©¶ÔºåÂèñÊ∂àÂâáË∑≥ÈÅé')) {
                    window.location.href = url;
                    return;
                }
                
                // ÊñπÊ≥ï‰∫åÔºöÂâµÂª∫ÈÄ£Áµê‰∏¶ÈªûÊìä
                const link = document.createElement('a');
                link.href = url;
                link.target = '_blank';
                link.rel = 'noopener noreferrer';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showTestResult('info', '‚úÖ ÂÇôÁî®ÊñπÊ°àÂ∑≤Âü∑Ë°åÔºàÂâµÂª∫ÈÄ£ÁµêÊñπÂºèÔºâ');
                addDebugLog('ÂÇôÁî®ÊñπÊ°àÊ∏¨Ë©¶ÔºöÂâµÂª∫ÈÄ£ÁµêÊñπÂºè', 'info');
                
            } catch (error) {
                showTestResult('error', `‚ùå ÂÇôÁî®ÊñπÊ°àÂ§±ÊïóÔºö${error.message}`);
                addDebugLog(`ÂÇôÁî®ÊñπÊ°àÂ§±ÊïóÔºö${error.message}`, 'error');
            }
        }

        // È°ØÁ§∫ÈÄ≤Â∫¶Ê¢ù
        function showProgressBar() {
            const progressBar = document.getElementById('testProgressBar');
            const progress = document.getElementById('testProgress');
            
            progressBar.classList.remove('hidden');
            progress.style.width = '0%';
            
            let width = 0;
            const interval = setInterval(() => {
                width += 10;
                progress.style.width = width + '%';
                
                if (width >= 100) {
                    clearInterval(interval);
                }
            }, 200);
        }

        // Èö±ËóèÈÄ≤Â∫¶Ê¢ù
        function hideProgressBar() {
            document.getElementById('testProgressBar').classList.add('hidden');
        }

        // È°ØÁ§∫Ê∏¨Ë©¶ÁµêÊûú
        function showTestResult(type, message) {
            const resultContainer = document.getElementById('testResult');
            const className = type === 'success' ? 'success-details' : 'error-details';
            
            resultContainer.innerHTML = `
                <div class="${className}">
                    ${message}
                </div>
            `;
        }

        // Âº∑Âà∂ÈñãÂïüÁ∂≤Á´ô
        function forceOpenSite() {
            const url = document.getElementById('testUrl').value;
            addDebugLog(`Âº∑Âà∂ÈñãÂïüÁ∂≤Á´ôÔºö${url}`, 'info');
            
            try {
                // ÂòóË©¶Â§öÁ®ÆÊñπÊ≥ï
                const methods = [
                    () => window.open(url, '_blank'),
                    () => window.open(url, '_blank', 'noopener,noreferrer'),
                    () => {
                        const link = document.createElement('a');
                        link.href = url;
                        link.target = '_blank';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                ];
                
                for (let i = 0; i < methods.length; i++) {
                    try {
                        methods[i]();
                        addDebugLog(`Âº∑Âà∂ÈñãÂïüÊñπÊ≥ï ${i + 1} Â∑≤Âü∑Ë°å`, 'info');
                        break;
                    } catch (e) {
                        addDebugLog(`Âº∑Âà∂ÈñãÂïüÊñπÊ≥ï ${i + 1} Â§±ÊïóÔºö${e.message}`, 'warning');
                    }
                }
                
                showTestResult('info', '‚úÖ Âº∑Âà∂ÈñãÂïüÊåá‰ª§Â∑≤Âü∑Ë°åÔºåË´ãÊ™¢Êü•ÊòØÂê¶ÊúâÊñ∞Ë¶ñÁ™óÈñãÂïü');
                
            } catch (error) {
                showTestResult('error', `‚ùå Âº∑Âà∂ÈñãÂïüÂ§±ÊïóÔºö${error.message}`);
                addDebugLog(`Âº∑Âà∂ÈñãÂïüÂ§±ÊïóÔºö${error.message}`, 'error');
            }
        }

        // Ë§áË£ΩÁ∂≤ÂùÄÂà∞Ââ™Ë≤ºÁ∞ø
        async function copyUrlToClipboard() {
            const url = document.getElementById('testUrl').value;
            
            try {
                await navigator.clipboard.writeText(url);
                showTestResult('success', '‚úÖ Á∂≤ÂùÄÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅÊÇ®ÂèØ‰ª•ÊâãÂãïÈñãÂïüÁÄèË¶ΩÂô®‰∏¶Ë≤º‰∏äÁ∂≤ÂùÄ„ÄÇ');
                addDebugLog('Á∂≤ÂùÄÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø', 'success');
            } catch (error) {
                // ÂÇôÁî®ÊñπÊ°à
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                showTestResult('success', '‚úÖ Á∂≤ÂùÄÂ∑≤Ë§áË£ΩÔºÅË´ãÊâãÂãïÈñãÂïüÁÄèË¶ΩÂô®‰∏¶Ë≤º‰∏ä„ÄÇ');
                addDebugLog('Á∂≤ÂùÄÂ∑≤Ë§áË£ΩÔºàÂÇôÁî®ÊñπÊ°àÔºâ', 'success');
            }
        }

        // Âª∫Á´ãÊâìÂç°Êõ∏Á±§
        function createBookmark() {
            const url = document.getElementById('testUrl').value;
            const bookmarkScript = `javascript:window.open('${url}', '_blank');`;
            
            try {
                navigator.clipboard.writeText(bookmarkScript);
                showTestResult('success', `‚úÖ ÊâìÂç°Êõ∏Á±§Â∑≤Ë§áË£ΩÔºÅ\\n\\n‰ΩøÁî®ÊñπÊ≥ïÔºö\\n1. Âª∫Á´ãÊñ∞Êõ∏Á±§\\n2. Ë≤º‰∏äÂâ™Ë≤ºÁ∞øÂÖßÂÆπ‰ΩúÁÇ∫Á∂≤ÂùÄ\\n3. ÈªûÊìäÊõ∏Á±§Âç≥ÂèØÊâìÂç°`);
                addDebugLog('ÊâìÂç°Êõ∏Á±§Â∑≤ÁîüÊàê‰∏¶Ë§áË£Ω', 'success');
            } catch (error) {
                showTestResult('info', `üìã Ë´ãÊâãÂãïË§áË£Ω‰ª•‰∏ãÊõ∏Á±§Ôºö\\n\\n${bookmarkScript}`);
                addDebugLog('Êõ∏Á±§ÁîüÊàêÂÆåÊàêÔºåÈúÄÊâãÂãïË§áË£Ω', 'info');
            }
        }

        // È°ØÁ§∫ÂΩàÁ™óË™™Êòé
        function showPopupHelp() {
            const helpContent = document.getElementById('helpContent');
            helpContent.innerHTML = `
                <div class="success-details">
                    <strong>üö´ ÂΩàÁ™óË¢´ÈòªÊìãÁöÑËß£Ê±∫ÊñπÊ°àÔºö</strong><br><br>
                    
                    <strong>Safari (iOS)Ôºö</strong><br>
                    ‚Ä¢ Ë®≠ÂÆö ‚Üí Safari ‚Üí ‰∏ÄËà¨ ‚Üí ÈòªÊìãÂΩàÂá∫Ë¶ñÁ™óÔºàÈóúÈñâÔºâ<br>
                    ‚Ä¢ Ë®≠ÂÆö ‚Üí Safari ‚Üí Á∂≤Á´ôË®≠ÂÆö ‚Üí ÂΩàÂá∫Ë¶ñÁ™óÔºàÂÖÅË®±Ôºâ<br><br>
                    
                    <strong>ChromeÔºö</strong><br>
                    ‚Ä¢ ÈªûÊìäÁ∂≤ÂùÄÂàóÂ∑¶ÂÅ¥ÁöÑÈéñÈ†≠ÂúñÁ§∫<br>
                    ‚Ä¢ ÂΩàÂá∫Ë¶ñÁ™ó ‚Üí ÂÖÅË®±<br><br>
                    
                    <strong>ÈÄöÁî®ÊñπÊ≥ïÔºö</strong><br>
                    ‚Ä¢ ÈáçÊñ∞ËºâÂÖ•È†ÅÈù¢ÂæåÂÜçË©¶<br>
                    ‚Ä¢ ÂòóË©¶‰ΩøÁî®„ÄåË§áË£ΩÁ∂≤ÂùÄ„ÄçÂäüËÉΩÊâãÂãïÈñãÂïü<br>
                    ‚Ä¢ ‰ΩøÁî®Êõ∏Á±§ÂäüËÉΩ
                </div>
            `;
            addDebugLog('È°ØÁ§∫ÂΩàÁ™óË™™Êòé', 'info');
        }

        // È°ØÁ§∫ Safari Ë™™Êòé
        function showSafariHelp() {
            const helpContent = document.getElementById('helpContent');
            helpContent.innerHTML = `
                <div class="success-details">
                    <strong>üçé Safari ÁâπÊÆäË®≠ÂÆöË™™ÊòéÔºö</strong><br><br>
                    
                    <strong>ÂøÖË¶ÅË®≠ÂÆöÔºö</strong><br>
                    ‚Ä¢ Ë®≠ÂÆö ‚Üí Safari ‚Üí ÈÄ≤Èöé ‚Üí JavaScriptÔºàÈñãÂïüÔºâ<br>
                    ‚Ä¢ Ë®≠ÂÆö ‚Üí Safari ‚Üí Èö±ÁßÅÊ¨äËàáÂÆâÂÖ®ÊÄß ‚Üí Èò≤Ê≠¢Ë∑®Á∂≤Á´ôËøΩËπ§ÔºàÈóúÈñâÔºâ<br>
                    ‚Ä¢ Ë®≠ÂÆö ‚Üí Safari ‚Üí ‰∏ÄËà¨ ‚Üí ÈòªÊìãÂΩàÂá∫Ë¶ñÁ™óÔºàÈóúÈñâÔºâ<br><br>
                    
                    <strong>Â¶ÇÊûú‰ªçÁÑ∂ÁÑ°ÊïàÔºö</strong><br>
                    ‚Ä¢ Ê∏ÖÈô§ Safari Âø´ÂèñÔºöË®≠ÂÆö ‚Üí Safari ‚Üí Ê∏ÖÈô§ÁÄèË¶ΩË®òÈåÑËàáÁ∂≤Á´ôË≥áÊñô<br>
                    ‚Ä¢ ÈáçÊñ∞ÂïüÂãï Safari<br>
                    ‚Ä¢ ÂòóË©¶‰ΩøÁî®ÁßÅÂØÜÁÄèË¶ΩÊ®°Âºè
                </div>
            `;
            addDebugLog('È°ØÁ§∫ Safari Ë™™Êòé', 'info');
        }

        // È°ØÁ§∫Êõø‰ª£ÊñπÊ≥ï
        function showAlternativeMethod() {
            const helpContent = document.getElementById('helpContent');
            helpContent.innerHTML = `
                <div class="success-details">
                    <strong>üîÑ Êõø‰ª£ÊâìÂç°ÊñπÊ≥ïÔºö</strong><br><br>
                    
                    <strong>ÊñπÊ≥ï‰∏ÄÔºöÊâãÂãïË§áË£ΩÁ∂≤ÂùÄ</strong><br>
                    1. ÈªûÊìä„ÄåË§áË£ΩÁ∂≤ÂùÄÂà∞Ââ™Ë≤ºÁ∞ø„Äç<br>
                    2. ÈñãÂïü Safari ÁÄèË¶ΩÂô®<br>
                    3. Ë≤º‰∏äÁ∂≤ÂùÄ‰∏¶ÂâçÂæÄ<br><br>
                    
                    <strong>ÊñπÊ≥ï‰∫åÔºö‰ΩøÁî®Êõ∏Á±§</strong><br>
                    1. ÈªûÊìä„ÄåÂª∫Á´ãÊâìÂç°Êõ∏Á±§„Äç<br>
                    2. Âª∫Á´ãÊñ∞Êõ∏Á±§‰∏¶Ë≤º‰∏äÂÖßÂÆπ<br>
                    3. ÈªûÊìäÊõ∏Á±§Âç≥ÂèØÊâìÂç°<br><br>
                    
                    <strong>ÊñπÊ≥ï‰∏âÔºöÂä†ÂÖ•‰∏ªÁï´Èù¢Êç∑Âæë</strong><br>
                    1. Áî® Safari ÈñãÂïü Mphasis Á∂≤Á´ô<br>
                    2. ÈªûÊìäÂàÜ‰∫´ ‚Üí Âä†ÂÖ•‰∏ªÁï´Èù¢<br>
                    3. Áõ¥Êé•Âæû‰∏ªÁï´Èù¢ÈñãÂïü
                </div>
            `;
            addDebugLog('È°ØÁ§∫Êõø‰ª£ÊñπÊ≥ïË™™Êòé', 'info');
        }

        // Áõ£ËÅΩÁ∂≤ÂùÄËÆäÊõ¥
        document.getElementById('testUrl').addEventListener('input', updateCurrentUrl);

        // Áõ£ËÅΩÈåØË™§
        window.addEventListener('error', function(e) {
            addDebugLog(`JavaScript ÈåØË™§Ôºö${e.message}`, 'error');
        });

        // È†ÅÈù¢ËºâÂÖ•ÂÆåÊàê
        addDebugLog('Ë™øË©¶Â∑•ÂÖ∑ËºâÂÖ•ÂÆåÊàê', 'success');
    </script>
</body>
</html>

