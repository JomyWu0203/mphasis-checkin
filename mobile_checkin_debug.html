<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mphasis æ‰“å¡ç³»çµ± - èª¿è©¦ç‰ˆ</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Mphasisæ‰“å¡èª¿è©¦">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Theme Colors -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-status-bar-style" content="#667eea">
    
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #4CAF50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --info-color: #2196F3;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: var(--text-dark);
            padding: 20px;
        }

        .container {
            max-width: 414px;
            margin: 0 auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 10px;
        }

        .header h1 {
            color: var(--text-dark);
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .debug-badge {
            background: linear-gradient(45deg, var(--warning-color), #f57c00);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 8px;
            display: inline-block;
        }

        .time-card {
            text-align: center;
            margin-bottom: 20px;
        }

        .current-time {
            font-size: 2.5rem;
            font-weight: 300;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-family: monospace;
        }

        .current-date {
            color: var(--text-light);
            font-size: 1rem;
        }

        .button {
            width: 100%;
            padding: 16px 20px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
        }

        .button-primary {
            background: linear-gradient(45deg, var(--success-color), #45a049);
            color: white;
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
        }

        .button-secondary {
            background: linear-gradient(45deg, var(--info-color), #1976D2);
            color: white;
            box-shadow: 0 4px 20px rgba(33, 150, 243, 0.3);
        }

        .button-warning {
            background: linear-gradient(45deg, var(--warning-color), #f57c00);
            color: white;
            box-shadow: 0 4px 20px rgba(255, 152, 0, 0.3);
        }

        .button-error {
            background: linear-gradient(45deg, var(--error-color), #d32f2f);
            color: white;
            box-shadow: 0 4px 20px rgba(244, 67, 54, 0.3);
        }

        .button:active {
            transform: translateY(2px);
        }

        .button:disabled {
            background: #bdc3c7;
            color: #7f8c8d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .debug-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.85rem;
            margin-bottom: 16px;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 4px 8px;
            border-radius: 4px;
            border-left: 3px solid;
        }

        .log-success {
            background: rgba(76, 175, 80, 0.1);
            border-left-color: var(--success-color);
            color: #2e7d32;
        }

        .log-error {
            background: rgba(244, 67, 54, 0.1);
            border-left-color: var(--error-color);
            color: #c62828;
        }

        .log-warning {
            background: rgba(255, 152, 0, 0.1);
            border-left-color: var(--warning-color);
            color: #ef6c00;
        }

        .log-info {
            background: rgba(33, 150, 243, 0.1);
            border-left-color: var(--info-color);
            color: #1565c0;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success { background: var(--success-color); }
        .status-error { background: var(--error-color); }
        .status-warning { background: var(--warning-color); }
        .status-info { background: var(--info-color); }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .test-results {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
        }

        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .test-item:last-child {
            border-bottom: none;
        }

        .test-name {
            font-weight: 500;
        }

        .test-status {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .clear-button {
            background: none;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-left: 8px;
        }

        .url-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            font-family: monospace;
            font-size: 0.9rem;
            word-break: break-all;
            margin: 8px 0;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, var(--success-color), #45a049);
            width: 0%;
            transition: width 0.3s ease;
        }

        .error-details {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid var(--error-color);
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            font-size: 0.9rem;
            color: #c62828;
        }

        .success-details {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--success-color);
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            font-size: 0.9rem;
            color: #2e7d32;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¨™é¡Œ -->
        <div class="card header">
            <h1>ğŸ”§ Mphasis æ‰“å¡ç³»çµ±èª¿è©¦</h1>
            <div style="color: var(--text-light); font-size: 1rem;">å•é¡Œè¨ºæ–·èˆ‡ä¿®å¾©å·¥å…·</div>
            <div class="debug-badge">èª¿è©¦æ¨¡å¼</div>
        </div>

        <!-- æ™‚é–“é¡¯ç¤º -->
        <div class="card time-card">
            <div class="current-time" id="currentTime">--:--</div>
            <div class="current-date" id="currentDate">è¼‰å…¥ä¸­...</div>
        </div>

        <!-- ç³»çµ±æª¢æ¸¬ -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: var(--text-dark);">ğŸ” ç³»çµ±ç›¸å®¹æ€§æª¢æ¸¬</h3>
            
            <button class="button button-secondary" onclick="runSystemTests()">
                ğŸ§ª åŸ·è¡Œå®Œæ•´æª¢æ¸¬
            </button>

            <div class="test-results" id="testResults">
                <div class="test-item">
                    <span class="test-name">ç€è¦½å™¨æª¢æ¸¬</span>
                    <span class="test-status" id="browserTest">
                        <span class="status-indicator status-warning"></span>
                        ç­‰å¾…æª¢æ¸¬
                    </span>
                </div>
                <div class="test-item">
                    <span class="test-name">JavaScript æ”¯æ´</span>
                    <span class="test-status" id="jsTest">
                        <span class="status-indicator status-warning"></span>
                        ç­‰å¾…æª¢æ¸¬
                    </span>
                </div>
                <div class="test-item">
                    <span class="test-name">å½ˆçª—æ¬Šé™</span>
                    <span class="test-status" id="popupTest">
                        <span class="status-indicator status-warning"></span>
                        ç­‰å¾…æª¢æ¸¬
                    </span>
                </div>
                <div class="test-item">
                    <span class="test-name">ç¶²è·¯é€£ç·š</span>
                    <span class="test-status" id="networkTest">
                        <span class="status-indicator status-warning"></span>
                        ç­‰å¾…æª¢æ¸¬
                    </span>
                </div>
                <div class="test-item">
                    <span class="test-name">æœ¬åœ°å„²å­˜</span>
                    <span class="test-status" id="storageTest">
                        <span class="status-indicator status-warning"></span>
                        ç­‰å¾…æª¢æ¸¬
                    </span>
                </div>
            </div>
        </div>

        <!-- æ‰“å¡æ¸¬è©¦ -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: var(--text-dark);">ğŸ¯ æ‰“å¡åŠŸèƒ½æ¸¬è©¦</h3>
            
            <div class="form-group">
                <label for="testUrl">æ¸¬è©¦ç¶²å€ï¼š</label>
                <input type="url" id="testUrl" value="https://mphasisone.mphasis.com/" placeholder="è«‹è¼¸å…¥æ‰“å¡ç¶²å€">
            </div>

            <button class="button button-primary" onclick="testBasicOpen()">
                ğŸŒ æ¸¬è©¦åŸºæœ¬é–‹å•ŸåŠŸèƒ½
            </button>

            <button class="button button-secondary" onclick="testWithDelay()">
                â±ï¸ æ¸¬è©¦å»¶é²é–‹å•Ÿ
            </button>

            <button class="button button-warning" onclick="testPopupSettings()">
                ğŸ”§ æ¸¬è©¦å½ˆçª—è¨­å®š
            </button>

            <button class="button button-error" onclick="testFallbackMethod()">
                ğŸ›¡ï¸ æ¸¬è©¦å‚™ç”¨æ–¹æ¡ˆ
            </button>

            <div id="testProgressBar" class="progress-bar hidden">
                <div class="progress-fill" id="testProgress"></div>
            </div>

            <div id="testResult"></div>
        </div>

        <!-- èª¿è©¦æ—¥èªŒ -->
        <div class="card">
            <h3 style="margin-bottom: 8px; color: var(--text-dark);">ğŸ“‹ èª¿è©¦æ—¥èªŒ</h3>
            <button class="clear-button" onclick="clearDebugLog()">æ¸…é™¤æ—¥èªŒ</button>
            
            <div class="debug-log" id="debugLog">
                <div class="log-entry log-info">
                    <strong>[INFO]</strong> èª¿è©¦ç³»çµ±å·²å•Ÿå‹•
                </div>
            </div>
        </div>

        <!-- ä¿®å¾©å»ºè­° -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: var(--text-dark);">ğŸ› ï¸ å¸¸è¦‹å•é¡Œä¿®å¾©</h3>
            
            <button class="button button-secondary" onclick="showPopupHelp()">
                ğŸš« å½ˆçª—è¢«é˜»æ“‹çš„è§£æ±ºæ–¹æ¡ˆ
            </button>

            <button class="button button-secondary" onclick="showSafariHelp()">
                ğŸ Safari ç‰¹æ®Šè¨­å®šèªªæ˜
            </button>

            <button class="button button-secondary" onclick="showAlternativeMethod()">
                ğŸ”„ æ›¿ä»£æ‰“å¡æ–¹æ³•
            </button>

            <div id="helpContent"></div>
        </div>

        <!-- å¼·åˆ¶æ‰“å¡å·¥å…· -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: var(--text-dark);">ğŸ’ª å¼·åˆ¶æ‰“å¡å·¥å…·</h3>
            <p style="margin-bottom: 16px; color: var(--text-light); font-size: 0.9rem;">
                å¦‚æœæ¨™æº–æ–¹æ³•ç„¡æ•ˆï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å¼·åˆ¶é–‹å•Ÿæ‰“å¡ç¶²ç«™
            </p>

            <button class="button button-primary" onclick="forceOpenSite()">
                ğŸš€ å¼·åˆ¶é–‹å•Ÿæ‰“å¡ç¶²ç«™
            </button>

            <button class="button button-secondary" onclick="copyUrlToClipboard()">
                ğŸ“‹ è¤‡è£½ç¶²å€åˆ°å‰ªè²¼ç°¿
            </button>

            <button class="button button-warning" onclick="createBookmark()">
                ğŸ”– å»ºç«‹æ‰“å¡æ›¸ç±¤
            </button>

            <div class="url-display" id="currentUrl">
                ç•¶å‰æ‰“å¡ç¶²å€ï¼šloading...
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let debugLog = [];
        let testResults = {};

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            updateCurrentUrl();
            addDebugLog('ç³»çµ±åˆå§‹åŒ–å®Œæˆ', 'info');
        });

        // æ›´æ–°æ™‚é–“
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-TW', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            const dateStr = now.toLocaleDateString('zh-TW', { 
                year: 'numeric',
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            });
            
            document.getElementById('currentTime').textContent = timeStr;
            document.getElementById('currentDate').textContent = dateStr;
        }

        // æ›´æ–°ç•¶å‰ç¶²å€é¡¯ç¤º
        function updateCurrentUrl() {
            const url = document.getElementById('testUrl').value;
            document.getElementById('currentUrl').textContent = `ç•¶å‰æ‰“å¡ç¶²å€ï¼š${url}`;
        }

        // æ·»åŠ èª¿è©¦æ—¥èªŒ
        function addDebugLog(message, level = 'info') {
            const timestamp = new Date().toLocaleTimeString('zh-TW');
            const entry = { timestamp, message, level };
            debugLog.push(entry);
            
            const logContainer = document.getElementById('debugLog');
            const logElement = document.createElement('div');
            logElement.className = `log-entry log-${level}`;
            logElement.innerHTML = `<strong>[${level.toUpperCase()}]</strong> ${timestamp} - ${message}`;
            
            logContainer.appendChild(logElement);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            console.log(`[${level.toUpperCase()}] ${message}`);
        }

        // æ¸…é™¤èª¿è©¦æ—¥èªŒ
        function clearDebugLog() {
            debugLog = [];
            document.getElementById('debugLog').innerHTML = `
                <div class="log-entry log-info">
                    <strong>[INFO]</strong> æ—¥èªŒå·²æ¸…é™¤
                </div>
            `;
            addDebugLog('èª¿è©¦æ—¥èªŒå·²æ¸…é™¤', 'info');
        }

        // åŸ·è¡Œç³»çµ±æª¢æ¸¬
        function runSystemTests() {
            addDebugLog('é–‹å§‹åŸ·è¡Œç³»çµ±ç›¸å®¹æ€§æª¢æ¸¬', 'info');
            
            // ç€è¦½å™¨æª¢æ¸¬
            const userAgent = navigator.userAgent;
            const isSafari = /^((?!chrome|android).)*safari/i.test(userAgent);
            const isChrome = /chrome/i.test(userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(userAgent);
            
            let browserResult = 'unknown';
            if (isSafari && isIOS) {
                browserResult = 'iOS Safari';
                updateTestStatus('browserTest', 'success', 'iOS Safari âœ“');
            } else if (isChrome) {
                browserResult = 'Chrome';
                updateTestStatus('browserTest', 'success', 'Chrome âœ“');
            } else {
                browserResult = userAgent.substring(0, 50);
                updateTestStatus('browserTest', 'warning', 'å…¶ä»–ç€è¦½å™¨');
            }
            addDebugLog(`ç€è¦½å™¨æª¢æ¸¬ï¼š${browserResult}`, 'info');

            // JavaScript æª¢æ¸¬
            try {
                const testFunc = () => true;
                const jsWorking = testFunc();
                updateTestStatus('jsTest', 'success', 'JavaScript âœ“');
                addDebugLog('JavaScript åŠŸèƒ½æ­£å¸¸', 'success');
            } catch (e) {
                updateTestStatus('jsTest', 'error', 'JavaScript âœ—');
                addDebugLog('JavaScript åŠŸèƒ½ç•°å¸¸ï¼š' + e.message, 'error');
            }

            // å½ˆçª—æ¬Šé™æª¢æ¸¬
            setTimeout(() => {
                try {
                    const popup = window.open('', '_blank', 'width=1,height=1');
                    if (popup && !popup.closed) {
                        popup.close();
                        updateTestStatus('popupTest', 'success', 'å½ˆçª—å…è¨± âœ“');
                        addDebugLog('å½ˆçª—æ¬Šé™æ­£å¸¸', 'success');
                    } else {
                        updateTestStatus('popupTest', 'error', 'å½ˆçª—è¢«é˜»æ“‹ âœ—');
                        addDebugLog('å½ˆçª—è¢«ç€è¦½å™¨é˜»æ“‹', 'error');
                    }
                } catch (e) {
                    updateTestStatus('popupTest', 'error', 'å½ˆçª—æ¸¬è©¦å¤±æ•— âœ—');
                    addDebugLog('å½ˆçª—æ¸¬è©¦ç•°å¸¸ï¼š' + e.message, 'error');
                }
            }, 1000);

            // ç¶²è·¯é€£ç·šæª¢æ¸¬
            if (navigator.onLine) {
                updateTestStatus('networkTest', 'success', 'ç¶²è·¯é€£ç·š âœ“');
                addDebugLog('ç¶²è·¯é€£ç·šæ­£å¸¸', 'success');
            } else {
                updateTestStatus('networkTest', 'error', 'ç¶²è·¯é›¢ç·š âœ—');
                addDebugLog('ç¶²è·¯é€£ç·šç•°å¸¸', 'error');
            }

            // æœ¬åœ°å„²å­˜æª¢æ¸¬
            try {
                localStorage.setItem('test', 'value');
                const stored = localStorage.getItem('test');
                localStorage.removeItem('test');
                
                if (stored === 'value') {
                    updateTestStatus('storageTest', 'success', 'æœ¬åœ°å„²å­˜ âœ“');
                    addDebugLog('æœ¬åœ°å„²å­˜åŠŸèƒ½æ­£å¸¸', 'success');
                } else {
                    updateTestStatus('storageTest', 'error', 'æœ¬åœ°å„²å­˜ âœ—');
                    addDebugLog('æœ¬åœ°å„²å­˜åŠŸèƒ½ç•°å¸¸', 'error');
                }
            } catch (e) {
                updateTestStatus('storageTest', 'error', 'æœ¬åœ°å„²å­˜ âœ—');
                addDebugLog('æœ¬åœ°å„²å­˜æ¸¬è©¦å¤±æ•—ï¼š' + e.message, 'error');
            }
        }

        // æ›´æ–°æ¸¬è©¦ç‹€æ…‹
        function updateTestStatus(testId, status, text) {
            const element = document.getElementById(testId);
            const indicator = element.querySelector('.status-indicator');
            
            indicator.className = `status-indicator status-${status}`;
            element.innerHTML = `
                <span class="status-indicator status-${status}"></span>
                ${text}
            `;
        }

        // æ¸¬è©¦åŸºæœ¬é–‹å•ŸåŠŸèƒ½
        function testBasicOpen() {
            const url = document.getElementById('testUrl').value;
            addDebugLog(`æ¸¬è©¦åŸºæœ¬é–‹å•ŸåŠŸèƒ½ï¼š${url}`, 'info');
            
            showProgressBar();
            
            try {
                const newWindow = window.open(url, '_blank');
                
                setTimeout(() => {
                    hideProgressBar();
                    
                    if (newWindow && !newWindow.closed) {
                        showTestResult('success', 'âœ… åŸºæœ¬é–‹å•ŸåŠŸèƒ½æ­£å¸¸ï¼æ–°è¦–çª—å·²é–‹å•Ÿã€‚');
                        addDebugLog('åŸºæœ¬é–‹å•ŸåŠŸèƒ½æ¸¬è©¦æˆåŠŸ', 'success');
                        
                        // 5ç§’å¾Œæª¢æŸ¥è¦–çª—ç‹€æ…‹
                        setTimeout(() => {
                            if (!newWindow.closed) {
                                addDebugLog('æ–°è¦–çª—ä»ç„¶é–‹å•Ÿï¼ŒåŠŸèƒ½æ­£å¸¸', 'success');
                            } else {
                                addDebugLog('æ–°è¦–çª—å·²é—œé–‰', 'info');
                            }
                        }, 5000);
                    } else {
                        showTestResult('error', 'âŒ åŸºæœ¬é–‹å•ŸåŠŸèƒ½å¤±æ•—ï¼å¯èƒ½æ˜¯å½ˆçª—è¢«é˜»æ“‹ã€‚');
                        addDebugLog('åŸºæœ¬é–‹å•ŸåŠŸèƒ½æ¸¬è©¦å¤±æ•—ï¼šå½ˆçª—è¢«é˜»æ“‹', 'error');
                    }
                }, 2000);
                
            } catch (error) {
                hideProgressBar();
                showTestResult('error', `âŒ é–‹å•Ÿå¤±æ•—ï¼š${error.message}`);
                addDebugLog(`é–‹å•Ÿå¤±æ•—ï¼š${error.message}`, 'error');
            }
        }

        // æ¸¬è©¦å»¶é²é–‹å•Ÿ
        function testWithDelay() {
            const url = document.getElementById('testUrl').value;
            addDebugLog(`æ¸¬è©¦å»¶é²é–‹å•Ÿï¼š${url}`, 'info');
            
            showProgressBar();
            
            setTimeout(() => {
                try {
                    const newWindow = window.open(url, '_blank');
                    hideProgressBar();
                    
                    if (newWindow && !newWindow.closed) {
                        showTestResult('success', 'âœ… å»¶é²é–‹å•Ÿæ¸¬è©¦æˆåŠŸï¼');
                        addDebugLog('å»¶é²é–‹å•Ÿæ¸¬è©¦æˆåŠŸ', 'success');
                    } else {
                        showTestResult('error', 'âŒ å»¶é²é–‹å•Ÿæ¸¬è©¦å¤±æ•—ï¼');
                        addDebugLog('å»¶é²é–‹å•Ÿæ¸¬è©¦å¤±æ•—', 'error');
                    }
                } catch (error) {
                    hideProgressBar();
                    showTestResult('error', `âŒ å»¶é²é–‹å•Ÿå¤±æ•—ï¼š${error.message}`);
                    addDebugLog(`å»¶é²é–‹å•Ÿå¤±æ•—ï¼š${error.message}`, 'error');
                }
            }, 3000);
        }

        // æ¸¬è©¦å½ˆçª—è¨­å®š
        function testPopupSettings() {
            addDebugLog('æª¢æŸ¥å½ˆçª—è¨­å®š', 'info');
            
            const popup1 = window.open('', '_blank', 'width=100,height=100');
            const popup2 = window.open('', '_blank', 'popup=yes');
            const popup3 = window.open('', '_blank', 'noopener,noreferrer');
            
            setTimeout(() => {
                let workingMethods = [];
                
                if (popup1 && !popup1.closed) {
                    workingMethods.push('æ¨™æº–æ–¹å¼');
                    popup1.close();
                }
                
                if (popup2 && !popup2.closed) {
                    workingMethods.push('popupåƒæ•¸');
                    popup2.close();
                }
                
                if (popup3 && !popup3.closed) {
                    workingMethods.push('å®‰å…¨æ–¹å¼');
                    popup3.close();
                }
                
                if (workingMethods.length > 0) {
                    showTestResult('success', `âœ… å¯ç”¨æ–¹æ³•ï¼š${workingMethods.join(', ')}`);
                    addDebugLog(`å½ˆçª—æ¸¬è©¦æˆåŠŸï¼Œå¯ç”¨æ–¹æ³•ï¼š${workingMethods.join(', ')}`, 'success');
                } else {
                    showTestResult('error', 'âŒ æ‰€æœ‰å½ˆçª—æ–¹æ³•éƒ½è¢«é˜»æ“‹');
                    addDebugLog('æ‰€æœ‰å½ˆçª—æ–¹æ³•éƒ½è¢«é˜»æ“‹', 'error');
                }
            }, 2000);
        }

        // æ¸¬è©¦å‚™ç”¨æ–¹æ¡ˆ
        function testFallbackMethod() {
            const url = document.getElementById('testUrl').value;
            addDebugLog(`æ¸¬è©¦å‚™ç”¨æ–¹æ¡ˆï¼š${url}`, 'info');
            
            try {
                // æ–¹æ³•ä¸€ï¼šlocation.href
                if (confirm('æ¸¬è©¦æ–¹æ³•ä¸€ï¼šç›´æ¥è·³è½‰ï¼ˆæœƒé›¢é–‹ç•¶å‰é é¢ï¼‰\\n\\né»æ“Šç¢ºå®šæ¸¬è©¦ï¼Œå–æ¶ˆå‰‡è·³é')) {
                    window.location.href = url;
                    return;
                }
                
                // æ–¹æ³•äºŒï¼šå‰µå»ºé€£çµä¸¦é»æ“Š
                const link = document.createElement('a');
                link.href = url;
                link.target = '_blank';
                link.rel = 'noopener noreferrer';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showTestResult('info', 'âœ… å‚™ç”¨æ–¹æ¡ˆå·²åŸ·è¡Œï¼ˆå‰µå»ºé€£çµæ–¹å¼ï¼‰');
                addDebugLog('å‚™ç”¨æ–¹æ¡ˆæ¸¬è©¦ï¼šå‰µå»ºé€£çµæ–¹å¼', 'info');
                
            } catch (error) {
                showTestResult('error', `âŒ å‚™ç”¨æ–¹æ¡ˆå¤±æ•—ï¼š${error.message}`);
                addDebugLog(`å‚™ç”¨æ–¹æ¡ˆå¤±æ•—ï¼š${error.message}`, 'error');
            }
        }

        // é¡¯ç¤ºé€²åº¦æ¢
        function showProgressBar() {
            const progressBar = document.getElementById('testProgressBar');
            const progress = document.getElementById('testProgress');
            
            progressBar.classList.remove('hidden');
            progress.style.width = '0%';
            
            let width = 0;
            const interval = setInterval(() => {
                width += 10;
                progress.style.width = width + '%';
                
                if (width >= 100) {
                    clearInterval(interval);
                }
            }, 200);
        }

        // éš±è—é€²åº¦æ¢
        function hideProgressBar() {
            document.getElementById('testProgressBar').classList.add('hidden');
        }

        // é¡¯ç¤ºæ¸¬è©¦çµæœ
        function showTestResult(type, message) {
            const resultContainer = document.getElementById('testResult');
            const className = type === 'success' ? 'success-details' : 'error-details';
            
            resultContainer.innerHTML = `
                <div class="${className}">
                    ${message}
                </div>
            `;
        }

        // å¼·åˆ¶é–‹å•Ÿç¶²ç«™
        function forceOpenSite() {
            const url = document.getElementById('testUrl').value;
            addDebugLog(`å¼·åˆ¶é–‹å•Ÿç¶²ç«™ï¼š${url}`, 'info');
            
            try {
                // å˜—è©¦å¤šç¨®æ–¹æ³•
                const methods = [
                    () => window.open(url, '_blank'),
                    () => window.open(url, '_blank', 'noopener,noreferrer'),
                    () => {
                        const link = document.createElement('a');
                        link.href = url;
                        link.target = '_blank';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                ];
                
                for (let i = 0; i < methods.length; i++) {
                    try {
                        methods[i]();
                        addDebugLog(`å¼·åˆ¶é–‹å•Ÿæ–¹æ³• ${i + 1} å·²åŸ·è¡Œ`, 'info');
                        break;
                    } catch (e) {
                        addDebugLog(`å¼·åˆ¶é–‹å•Ÿæ–¹æ³• ${i + 1} å¤±æ•—ï¼š${e.message}`, 'warning');
                    }
                }
                
                showTestResult('info', 'âœ… å¼·åˆ¶é–‹å•ŸæŒ‡ä»¤å·²åŸ·è¡Œï¼Œè«‹æª¢æŸ¥æ˜¯å¦æœ‰æ–°è¦–çª—é–‹å•Ÿ');
                
            } catch (error) {
                showTestResult('error', `âŒ å¼·åˆ¶é–‹å•Ÿå¤±æ•—ï¼š${error.message}`);
                addDebugLog(`å¼·åˆ¶é–‹å•Ÿå¤±æ•—ï¼š${error.message}`, 'error');
            }
        }

        // è¤‡è£½ç¶²å€åˆ°å‰ªè²¼ç°¿
        async function copyUrlToClipboard() {
            const url = document.getElementById('testUrl').value;
            
            try {
                await navigator.clipboard.writeText(url);
                showTestResult('success', 'âœ… ç¶²å€å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼æ‚¨å¯ä»¥æ‰‹å‹•é–‹å•Ÿç€è¦½å™¨ä¸¦è²¼ä¸Šç¶²å€ã€‚');
                addDebugLog('ç¶²å€å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿', 'success');
            } catch (error) {
                // å‚™ç”¨æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                showTestResult('success', 'âœ… ç¶²å€å·²è¤‡è£½ï¼è«‹æ‰‹å‹•é–‹å•Ÿç€è¦½å™¨ä¸¦è²¼ä¸Šã€‚');
                addDebugLog('ç¶²å€å·²è¤‡è£½ï¼ˆå‚™ç”¨æ–¹æ¡ˆï¼‰', 'success');
            }
        }

        // å»ºç«‹æ‰“å¡æ›¸ç±¤
        function createBookmark() {
            const url = document.getElementById('testUrl').value;
            const bookmarkScript = `javascript:window.open('${url}', '_blank');`;
            
            try {
                navigator.clipboard.writeText(bookmarkScript);
                showTestResult('success', `âœ… æ‰“å¡æ›¸ç±¤å·²è¤‡è£½ï¼\\n\\nä½¿ç”¨æ–¹æ³•ï¼š\\n1. å»ºç«‹æ–°æ›¸ç±¤\\n2. è²¼ä¸Šå‰ªè²¼ç°¿å…§å®¹ä½œç‚ºç¶²å€\\n3. é»æ“Šæ›¸ç±¤å³å¯æ‰“å¡`);
                addDebugLog('æ‰“å¡æ›¸ç±¤å·²ç”Ÿæˆä¸¦è¤‡è£½', 'success');
            } catch (error) {
                showTestResult('info', `ğŸ“‹ è«‹æ‰‹å‹•è¤‡è£½ä»¥ä¸‹æ›¸ç±¤ï¼š\\n\\n${bookmarkScript}`);
                addDebugLog('æ›¸ç±¤ç”Ÿæˆå®Œæˆï¼Œéœ€æ‰‹å‹•è¤‡è£½', 'info');
            }
        }

        // é¡¯ç¤ºå½ˆçª—èªªæ˜
        function showPopupHelp() {
            const helpContent = document.getElementById('helpContent');
            helpContent.innerHTML = `
                <div class="success-details">
                    <strong>ğŸš« å½ˆçª—è¢«é˜»æ“‹çš„è§£æ±ºæ–¹æ¡ˆï¼š</strong><br><br>
                    
                    <strong>Safari (iOS)ï¼š</strong><br>
                    â€¢ è¨­å®š â†’ Safari â†’ ä¸€èˆ¬ â†’ é˜»æ“‹å½ˆå‡ºè¦–çª—ï¼ˆé—œé–‰ï¼‰<br>
                    â€¢ è¨­å®š â†’ Safari â†’ ç¶²ç«™è¨­å®š â†’ å½ˆå‡ºè¦–çª—ï¼ˆå…è¨±ï¼‰<br><br>
                    
                    <strong>Chromeï¼š</strong><br>
                    â€¢ é»æ“Šç¶²å€åˆ—å·¦å´çš„é–é ­åœ–ç¤º<br>
                    â€¢ å½ˆå‡ºè¦–çª— â†’ å…è¨±<br><br>
                    
                    <strong>é€šç”¨æ–¹æ³•ï¼š</strong><br>
                    â€¢ é‡æ–°è¼‰å…¥é é¢å¾Œå†è©¦<br>
                    â€¢ å˜—è©¦ä½¿ç”¨ã€Œè¤‡è£½ç¶²å€ã€åŠŸèƒ½æ‰‹å‹•é–‹å•Ÿ<br>
                    â€¢ ä½¿ç”¨æ›¸ç±¤åŠŸèƒ½
                </div>
            `;
            addDebugLog('é¡¯ç¤ºå½ˆçª—èªªæ˜', 'info');
        }

        // é¡¯ç¤º Safari èªªæ˜
        function showSafariHelp() {
            const helpContent = document.getElementById('helpContent');
            helpContent.innerHTML = `
                <div class="success-details">
                    <strong>ğŸ Safari ç‰¹æ®Šè¨­å®šèªªæ˜ï¼š</strong><br><br>
                    
                    <strong>å¿…è¦è¨­å®šï¼š</strong><br>
                    â€¢ è¨­å®š â†’ Safari â†’ é€²éš â†’ JavaScriptï¼ˆé–‹å•Ÿï¼‰<br>
                    â€¢ è¨­å®š â†’ Safari â†’ éš±ç§æ¬Šèˆ‡å®‰å…¨æ€§ â†’ é˜²æ­¢è·¨ç¶²ç«™è¿½è¹¤ï¼ˆé—œé–‰ï¼‰<br>
                    â€¢ è¨­å®š â†’ Safari â†’ ä¸€èˆ¬ â†’ é˜»æ“‹å½ˆå‡ºè¦–çª—ï¼ˆé—œé–‰ï¼‰<br><br>
                    
                    <strong>å¦‚æœä»ç„¶ç„¡æ•ˆï¼š</strong><br>
                    â€¢ æ¸…é™¤ Safari å¿«å–ï¼šè¨­å®š â†’ Safari â†’ æ¸…é™¤ç€è¦½è¨˜éŒ„èˆ‡ç¶²ç«™è³‡æ–™<br>
                    â€¢ é‡æ–°å•Ÿå‹• Safari<br>
                    â€¢ å˜—è©¦ä½¿ç”¨ç§å¯†ç€è¦½æ¨¡å¼
                </div>
            `;
            addDebugLog('é¡¯ç¤º Safari èªªæ˜', 'info');
        }

        // é¡¯ç¤ºæ›¿ä»£æ–¹æ³•
        function showAlternativeMethod() {
            const helpContent = document.getElementById('helpContent');
            helpContent.innerHTML = `
                <div class="success-details">
                    <strong>ğŸ”„ æ›¿ä»£æ‰“å¡æ–¹æ³•ï¼š</strong><br><br>
                    
                    <strong>æ–¹æ³•ä¸€ï¼šæ‰‹å‹•è¤‡è£½ç¶²å€</strong><br>
                    1. é»æ“Šã€Œè¤‡è£½ç¶²å€åˆ°å‰ªè²¼ç°¿ã€<br>
                    2. é–‹å•Ÿ Safari ç€è¦½å™¨<br>
                    3. è²¼ä¸Šç¶²å€ä¸¦å‰å¾€<br><br>
                    
                    <strong>æ–¹æ³•äºŒï¼šä½¿ç”¨æ›¸ç±¤</strong><br>
                    1. é»æ“Šã€Œå»ºç«‹æ‰“å¡æ›¸ç±¤ã€<br>
                    2. å»ºç«‹æ–°æ›¸ç±¤ä¸¦è²¼ä¸Šå…§å®¹<br>
                    3. é»æ“Šæ›¸ç±¤å³å¯æ‰“å¡<br><br>
                    
                    <strong>æ–¹æ³•ä¸‰ï¼šåŠ å…¥ä¸»ç•«é¢æ·å¾‘</strong><br>
                    1. ç”¨ Safari é–‹å•Ÿ Mphasis ç¶²ç«™<br>
                    2. é»æ“Šåˆ†äº« â†’ åŠ å…¥ä¸»ç•«é¢<br>
                    3. ç›´æ¥å¾ä¸»ç•«é¢é–‹å•Ÿ
                </div>
            `;
            addDebugLog('é¡¯ç¤ºæ›¿ä»£æ–¹æ³•èªªæ˜', 'info');
        }

        // ç›£è½ç¶²å€è®Šæ›´
        document.getElementById('testUrl').addEventListener('input', updateCurrentUrl);

        // ç›£è½éŒ¯èª¤
        window.addEventListener('error', function(e) {
            addDebugLog(`JavaScript éŒ¯èª¤ï¼š${e.message}`, 'error');
        });

        // é é¢è¼‰å…¥å®Œæˆ
        addDebugLog('èª¿è©¦å·¥å…·è¼‰å…¥å®Œæˆ', 'success');
    </script>
</body>
</html>

