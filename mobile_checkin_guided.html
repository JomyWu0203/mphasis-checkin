<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mphasis æ™ºèƒ½å¼•å°æ‰“å¡</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Mphasisæ™ºèƒ½æ‰“å¡">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Theme Colors -->
    <meta name="theme-color" content="#667eea">
    
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #4CAF50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --info-color: #2196F3;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: var(--text-dark);
            padding: 20px;
        }

        .container {
            max-width: 414px;
            margin: 0 auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 10px;
        }

        .header h1 {
            color: var(--text-dark);
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .guided-badge {
            background: linear-gradient(45deg, var(--info-color), #1976D2);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 8px;
            display: inline-block;
        }

        .time-card {
            text-align: center;
            margin-bottom: 20px;
        }

        .current-time {
            font-size: 3rem;
            font-weight: 200;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-family: monospace;
        }

        .current-date {
            color: var(--text-light);
            font-size: 1.1rem;
            margin-bottom: 12px;
        }

        .button {
            width: 100%;
            padding: 18px 20px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
        }

        .button-primary {
            background: linear-gradient(45deg, var(--success-color), #45a049);
            color: white;
            box-shadow: 0 6px 25px rgba(76, 175, 80, 0.3);
        }

        .button-secondary {
            background: linear-gradient(45deg, var(--info-color), #1976D2);
            color: white;
            box-shadow: 0 6px 25px rgba(33, 150, 243, 0.3);
        }

        .button:active {
            transform: translateY(2px);
        }

        .guidance-panel {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border: 2px solid var(--info-color);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .guidance-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--info-color);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }

        .guidance-title::before {
            content: "ğŸ¯";
            margin-right: 8px;
            font-size: 1.5rem;
        }

        .guidance-steps {
            list-style: none;
            padding: 0;
        }

        .guidance-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .guidance-step:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateX(5px);
        }

        .step-number {
            background: var(--info-color);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
            font-size: 0.9rem;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .step-description {
            color: var(--text-light);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .automation-status {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            font-weight: 500;
            color: var(--text-dark);
        }

        .status-value {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .status-auto {
            color: var(--success-color);
        }

        .status-manual {
            color: var(--warning-color);
        }

        .status-icon {
            margin-right: 4px;
        }

        .limitation-notice {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid var(--warning-color);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
        }

        .limitation-title {
            font-weight: 600;
            color: #ef6c00;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .limitation-title::before {
            content: "âš ï¸";
            margin-right: 8px;
        }

        .limitation-text {
            color: #f57f17;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .comparison-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            margin: 16px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .table-header {
            background: var(--primary-color);
            color: white;
            padding: 12px;
            font-weight: 600;
            text-align: center;
        }

        .table-row {
            display: flex;
            border-bottom: 1px solid #eee;
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .table-cell {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-size: 0.9rem;
        }

        .table-cell:first-child {
            background: #f8f9fa;
            font-weight: 500;
            text-align: left;
        }

        .feature-available {
            color: var(--success-color);
            font-weight: 600;
        }

        .feature-limited {
            color: var(--warning-color);
            font-weight: 600;
        }

        .feature-unavailable {
            color: var(--error-color);
            font-weight: 600;
        }

        .hidden {
            display: none;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulsing {
            animation: pulse 2s infinite;
        }

        .floating-help {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, var(--info-color), #1976D2);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-help:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¨™é¡Œ -->
        <div class="card header">
            <h1>ğŸ¯ Mphasis æ™ºèƒ½å¼•å°æ‰“å¡</h1>
            <div style="color: var(--text-light); font-size: 1rem;">æœ€å¤§åŒ–è‡ªå‹•åŒ– + æ™ºèƒ½å¼•å°</div>
            <div class="guided-badge">æ™ºèƒ½å¼•å°ç‰ˆ</div>
        </div>

        <!-- æ™‚é–“é¡¯ç¤º -->
        <div class="card time-card">
            <div class="current-time" id="currentTime">--:--</div>
            <div class="current-date" id="currentDate">è¼‰å…¥ä¸­...</div>
        </div>

        <!-- è‡ªå‹•åŒ–ç‹€æ…‹ -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: var(--text-dark);">ğŸ¤– è‡ªå‹•åŒ–ç¨‹åº¦</h3>
            
            <div class="automation-status">
                <div class="status-item">
                    <span class="status-label">æ—¥æœŸæª¢æŸ¥</span>
                    <span class="status-value status-auto">
                        <span class="status-icon">âœ…</span>
                        å®Œå…¨è‡ªå‹•
                    </span>
                </div>
                <div class="status-item">
                    <span class="status-label">ç¶²ç«™é–‹å•Ÿ</span>
                    <span class="status-value status-auto">
                        <span class="status-icon">âœ…</span>
                        å®Œå…¨è‡ªå‹•
                    </span>
                </div>
                <div class="status-item">
                    <span class="status-label">é é¢æª¢æ¸¬</span>
                    <span class="status-value status-auto">
                        <span class="status-icon">âœ…</span>
                        å®Œå…¨è‡ªå‹•
                    </span>
                </div>
                <div class="status-item">
                    <span class="status-label">æŒ‰éˆ•é»é¸</span>
                    <span class="status-value status-manual">
                        <span class="status-icon">ğŸ‘†</span>
                        éœ€è¦æ‰‹å‹•
                    </span>
                </div>
                <div class="status-item">
                    <span class="status-label">çµæœè¨˜éŒ„</span>
                    <span class="status-value status-auto">
                        <span class="status-icon">âœ…</span>
                        å®Œå…¨è‡ªå‹•
                    </span>
                </div>
            </div>
        </div>

        <!-- æŠ€è¡“é™åˆ¶èªªæ˜ -->
        <div class="card">
            <div class="limitation-notice">
                <div class="limitation-title">ç‚ºä»€éº¼ç„¡æ³•è‡ªå‹•é»é¸æŒ‰éˆ•ï¼Ÿ</div>
                <div class="limitation-text">
                    ç”±æ–¼ç€è¦½å™¨çš„è·¨åŸŸå®‰å…¨æ”¿ç­– (CORS)ï¼Œç¶²é æ‡‰ç”¨ç„¡æ³•ç›´æ¥æ“ä½œå…¶ä»–ç¶²ç«™çš„æŒ‰éˆ•ã€‚é€™æ˜¯ç‚ºäº†ä¿è­·ç”¨æˆ¶å®‰å…¨è€Œè¨­è¨ˆçš„é™åˆ¶ã€‚
                    <br><br>
                    <strong>åŸå§‹ Python ç¨‹å¼å¯ä»¥è‡ªå‹•é»é¸</strong>ï¼Œå› ç‚ºå®ƒç›´æ¥æ§åˆ¶ç€è¦½å™¨ç¨‹åºï¼Œä¸å—ç¶²é å®‰å…¨é™åˆ¶ã€‚
                </div>
            </div>
        </div>

        <!-- ç‰ˆæœ¬æ¯”è¼ƒ -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: var(--text-dark);">ğŸ“Š ç‰ˆæœ¬åŠŸèƒ½æ¯”è¼ƒ</h3>
            
            <div class="comparison-table">
                <div class="table-header">åŠŸèƒ½æ¯”è¼ƒï¼šPython ç‰ˆ vs ç¶²é ç‰ˆ</div>
                
                <div class="table-row">
                    <div class="table-cell">åŠŸèƒ½é …ç›®</div>
                    <div class="table-cell">Python ç‰ˆ</div>
                    <div class="table-cell">ç¶²é ç‰ˆ</div>
                </div>
                
                <div class="table-row">
                    <div class="table-cell">è‡ªå‹•é»é¸æŒ‰éˆ•</div>
                    <div class="table-cell feature-available">âœ… å®Œå…¨è‡ªå‹•</div>
                    <div class="table-cell feature-unavailable">âŒ å®‰å…¨é™åˆ¶</div>
                </div>
                
                <div class="table-row">
                    <div class="table-cell">è·¨å¹³å°æ”¯æ´</div>
                    <div class="table-cell feature-limited">âš ï¸ éœ€è¦ Python</div>
                    <div class="table-cell feature-available">âœ… ä»»ä½•è¨­å‚™</div>
                </div>
                
                <div class="table-row">
                    <div class="table-cell">æ‰‹æ©Ÿæ”¯æ´</div>
                    <div class="table-cell feature-unavailable">âŒ ä¸æ”¯æ´</div>
                    <div class="table-cell feature-available">âœ… å®Œç¾æ”¯æ´</div>
                </div>
                
                <div class="table-row">
                    <div class="table-cell">å®‰è£éœ€æ±‚</div>
                    <div class="table-cell feature-limited">âš ï¸ è¤‡é›œå®‰è£</div>
                    <div class="table-cell feature-available">âœ… ç„¡éœ€å®‰è£</div>
                </div>
                
                <div class="table-row">
                    <div class="table-cell">æ—¥æœŸç®¡ç†</div>
                    <div class="table-cell feature-available">âœ… å®Œå…¨è‡ªå‹•</div>
                    <div class="table-cell feature-available">âœ… å®Œå…¨è‡ªå‹•</div>
                </div>
            </div>
        </div>

        <!-- æ™ºèƒ½å¼•å°æ‰“å¡ -->
        <div class="card">
            <button class="button button-primary pulsing" onclick="startGuidedCheckin()">
                ğŸ¯ é–‹å§‹æ™ºèƒ½å¼•å°æ‰“å¡
            </button>

            <button class="button button-secondary" onclick="showTechnicalDetails()">
                ğŸ”¬ æŸ¥çœ‹æŠ€è¡“è©³æƒ…
            </button>
        </div>

        <!-- å¼•å°é¢æ¿ -->
        <div class="guidance-panel hidden" id="guidancePanel">
            <div class="guidance-title">æ™ºèƒ½æ‰“å¡å¼•å°</div>
            
            <ol class="guidance-steps">
                <li class="guidance-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">ç³»çµ±è‡ªå‹•æª¢æŸ¥</div>
                        <div class="step-description">è‡ªå‹•æª¢æŸ¥ä»Šå¤©æ˜¯å¦éœ€è¦æ‰“å¡ã€æ˜¯å¦ç‚ºæ’é™¤æ—¥æœŸ</div>
                    </div>
                </li>
                
                <li class="guidance-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">è‡ªå‹•é–‹å•Ÿç¶²ç«™</div>
                        <div class="step-description">ç³»çµ±æœƒè‡ªå‹•é–‹å•Ÿ Mphasis æ‰“å¡ç¶²ç«™</div>
                    </div>
                </li>
                
                <li class="guidance-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">æ™ºèƒ½é é¢æª¢æ¸¬</div>
                        <div class="step-description">è‡ªå‹•æª¢æ¸¬é é¢è¼‰å…¥ç‹€æ…‹å’Œç™»å…¥ç‹€æ…‹</div>
                    </div>
                </li>
                
                <li class="guidance-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <div class="step-title">æ‰‹å‹•é»é¸æŒ‰éˆ•</div>
                        <div class="step-description">åœ¨é–‹å•Ÿçš„è¦–çª—ä¸­å°‹æ‰¾ä¸¦é»é¸ "CHECK-IN" æŒ‰éˆ•</div>
                    </div>
                </li>
                
                <li class="guidance-step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <div class="step-title">è‡ªå‹•è¨˜éŒ„çµæœ</div>
                        <div class="step-description">ç³»çµ±æœƒè‡ªå‹•è¨˜éŒ„æ‰“å¡æ™‚é–“å’Œçµæœ</div>
                    </div>
                </li>
            </ol>
        </div>

        <!-- æŠ€è¡“è©³æƒ… -->
        <div class="card hidden" id="technicalDetails">
            <h3 style="margin-bottom: 16px; color: var(--text-dark);">ğŸ”¬ æŠ€è¡“é™åˆ¶è©³è§£</h3>
            
            <div class="limitation-notice">
                <div class="limitation-title">è·¨åŸŸå®‰å…¨æ”¿ç­– (CORS)</div>
                <div class="limitation-text">
                    <strong>ä»€éº¼æ˜¯ CORSï¼Ÿ</strong><br>
                    Cross-Origin Resource Sharing æ˜¯ç€è¦½å™¨çš„å®‰å…¨æ©Ÿåˆ¶ï¼Œé˜²æ­¢æƒ¡æ„ç¶²ç«™æ“ä½œå…¶ä»–ç¶²ç«™çš„å…§å®¹ã€‚
                    <br><br>
                    <strong>ç‚ºä»€éº¼å½±éŸ¿è‡ªå‹•é»é¸ï¼Ÿ</strong><br>
                    â€¢ æˆ‘å€‘çš„æ‡‰ç”¨ï¼šhttps://jomywu0203.github.io/<br>
                    â€¢ Mphasis ç¶²ç«™ï¼šhttps://enterprise-apps.mphasis.com/ess/v1/#/home<br>
                    â€¢ ä¸åŒåŸŸå = ç„¡æ³•ç›´æ¥æ“ä½œ
                    <br><br>
                    <strong>Python ç‰ˆæœ¬ç‚ºä»€éº¼å¯ä»¥ï¼Ÿ</strong><br>
                    Python ä½¿ç”¨ Selenium ç›´æ¥æ§åˆ¶ç€è¦½å™¨ç¨‹åºï¼Œä¸å—ç¶²é å®‰å…¨é™åˆ¶ã€‚
                </div>
            </div>
        </div>
    </div>

    <!-- æµ®å‹•å¹«åŠ©æŒ‰éˆ• -->
    <button class="floating-help" onclick="showHelp()" title="å¹«åŠ©">
        â“
    </button>

    <script>
        let checkinWindow = null;
        let guidanceActive = false;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            
            console.log('ğŸ¯ Mphasis æ™ºèƒ½å¼•å°æ‰“å¡ç³»çµ±å·²å•Ÿå‹•');
        });

        // æ›´æ–°æ™‚é–“
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-TW', { 
                hour: '2-digit', 
                minute: '2-digit'
            });
            const dateStr = now.toLocaleDateString('zh-TW', { 
                year: 'numeric',
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            });
            
            document.getElementById('currentTime').textContent = timeStr;
            document.getElementById('currentDate').textContent = dateStr;
        }

        // é–‹å§‹æ™ºèƒ½å¼•å°æ‰“å¡
        async function startGuidedCheckin() {
            if (guidanceActive) {
                alert('å¼•å°æ‰“å¡æ­£åœ¨é€²è¡Œä¸­ï¼Œè«‹ç¨å¾Œå†è©¦');
                return;
            }

            guidanceActive = true;
            
            try {
                // é¡¯ç¤ºå¼•å°é¢æ¿
                const panel = document.getElementById('guidancePanel');
                panel.classList.remove('hidden');
                
                // æ­¥é©Ÿ 1: æª¢æŸ¥æ—¥æœŸ
                await highlightStep(1);
                const shouldCheckin = checkIfShouldCheckin();
                
                if (!shouldCheckin.should) {
                    alert(`â„¹ï¸ ${shouldCheckin.reason}`);
                    return;
                }

                // æ­¥é©Ÿ 2: é–‹å•Ÿç¶²ç«™
                await highlightStep(2);
                checkinWindow = window.open('https://enterprise-apps.mphasis.com/ess/v1/#/home', 'checkinWindow', 'width=800,height=600');
                
                if (!checkinWindow) {
                    throw new Error('ç„¡æ³•é–‹å•Ÿæ‰“å¡ç¶²ç«™ï¼Œè«‹æª¢æŸ¥å½ˆçª—è¨­å®š');
                }

                // æ­¥é©Ÿ 3: æª¢æ¸¬é é¢
                await highlightStep(3);
                await waitForPageLoad();

                // æ­¥é©Ÿ 4: æç¤ºæ‰‹å‹•æ“ä½œ
                await highlightStep(4);
                showManualInstruction();

                // æ­¥é©Ÿ 5: ç›£æ§çµæœ
                await highlightStep(5);
                monitorCheckinResult();

            } catch (error) {
                alert('âŒ å¼•å°æ‰“å¡å¤±æ•—: ' + error.message);
                console.error('å¼•å°æ‰“å¡éŒ¯èª¤:', error);
            } finally {
                guidanceActive = false;
            }
        }

        // é«˜äº®é¡¯ç¤ºæ­¥é©Ÿ
        async function highlightStep(stepNumber) {
            // ç§»é™¤æ‰€æœ‰é«˜äº®
            document.querySelectorAll('.guidance-step').forEach(step => {
                step.style.background = 'rgba(255, 255, 255, 0.7)';
                step.style.transform = 'translateX(0)';
            });

            // é«˜äº®ç•¶å‰æ­¥é©Ÿ
            const currentStep = document.querySelectorAll('.guidance-step')[stepNumber - 1];
            currentStep.style.background = 'rgba(33, 150, 243, 0.2)';
            currentStep.style.transform = 'translateX(10px)';
            currentStep.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // ç­‰å¾…ä¸€æ®µæ™‚é–“
            await sleep(2000);
        }

        // æª¢æŸ¥æ˜¯å¦æ‡‰è©²æ‰“å¡
        function checkIfShouldCheckin() {
            const now = new Date();
            const dayOfWeek = now.getDay(); // 0 = æ˜ŸæœŸæ—¥, 1 = æ˜ŸæœŸä¸€, ...
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºå·¥ä½œæ—¥ (æ˜ŸæœŸä¸€åˆ°æ˜ŸæœŸäº”)
            if (dayOfWeek === 0 || dayOfWeek === 6) {
                return {
                    should: false,
                    reason: 'ä»Šå¤©æ˜¯é€±æœ«ï¼Œä¸éœ€è¦æ‰“å¡'
                };
            }

            // é€™è£¡å¯ä»¥æ·»åŠ æ›´å¤šæª¢æŸ¥é‚è¼¯ï¼Œå¦‚æ’é™¤æ—¥æœŸç­‰
            return {
                should: true,
                reason: 'ä»Šå¤©éœ€è¦æ‰“å¡'
            };
        }

        // ç­‰å¾…é é¢è¼‰å…¥
        async function waitForPageLoad() {
            return new Promise((resolve) => {
                let attempts = 0;
                const maxAttempts = 10;
                
                const checkLoad = () => {
                    attempts++;
                    
                    if (!checkinWindow || checkinWindow.closed) {
                        resolve();
                        return;
                    }

                    if (attempts >= maxAttempts) {
                        resolve();
                        return;
                    }

                    setTimeout(checkLoad, 1000);
                };

                setTimeout(checkLoad, 3000); // åˆå§‹å»¶é²
            });
        }

        // é¡¯ç¤ºæ‰‹å‹•æ“ä½œæŒ‡ç¤º
        function showManualInstruction() {
            // å‰µå»ºä¸€å€‹æµ®å‹•æç¤º
            const instruction = document.createElement('div');
            instruction.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(45deg, #2196F3, #1976D2);
                color: white;
                padding: 20px;
                border-radius: 16px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                z-index: 10000;
                text-align: center;
                max-width: 300px;
                font-weight: 600;
            `;
            
            instruction.innerHTML = `
                <div style="font-size: 2rem; margin-bottom: 12px;">ğŸ‘†</div>
                <div style="margin-bottom: 12px;">è«‹åœ¨æ‰“å¡è¦–çª—ä¸­</div>
                <div style="margin-bottom: 16px; font-size: 1.2rem; color: #ffeb3b;">é»æ“Š "CHECK-IN" æŒ‰éˆ•</div>
                <button onclick="this.parentElement.remove()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer;">æˆ‘çŸ¥é“äº†</button>
            `;
            
            document.body.appendChild(instruction);
            
            // 5ç§’å¾Œè‡ªå‹•ç§»é™¤
            setTimeout(() => {
                if (instruction.parentElement) {
                    instruction.remove();
                }
            }, 5000);
        }

        // ç›£æ§æ‰“å¡çµæœ
        function monitorCheckinResult() {
            let monitorCount = 0;
            const maxMonitor = 60; // ç›£æ§ 60 ç§’
            
            const monitor = () => {
                monitorCount++;
                
                if (!checkinWindow || checkinWindow.closed) {
                    // è¦–çª—é—œé–‰ï¼Œå‡è¨­æ‰“å¡å®Œæˆ
                    recordCheckinResult(true);
                    showCompletionMessage(true);
                    return;
                }

                if (monitorCount >= maxMonitor) {
                    // ç›£æ§è¶…æ™‚
                    showCompletionMessage(false);
                    return;
                }

                setTimeout(monitor, 1000);
            };

            setTimeout(monitor, 1000);
        }

        // è¨˜éŒ„æ‰“å¡çµæœ
        function recordCheckinResult(success) {
            const now = new Date();
            const record = {
                timestamp: now.toISOString(),
                time: now.toLocaleString('zh-TW'),
                success: success,
                type: 'guided_checkin'
            };

            try {
                const history = JSON.parse(localStorage.getItem('mphasis_checkin_history') || '[]');
                history.unshift(record);
                
                if (history.length > 50) {
                    history.splice(50);
                }
                
                localStorage.setItem('mphasis_checkin_history', JSON.stringify(history));
                localStorage.setItem('mphasis_last_checkin', JSON.stringify(record));
                
                console.log('âœ… æ‰“å¡è¨˜éŒ„å·²å„²å­˜:', record);
                
            } catch (error) {
                console.error('âŒ å„²å­˜æ‰“å¡è¨˜éŒ„å¤±æ•—:', error);
            }
        }

        // é¡¯ç¤ºå®Œæˆè¨Šæ¯
        function showCompletionMessage(success) {
            const message = success ? 
                'âœ… æ™ºèƒ½å¼•å°æ‰“å¡å®Œæˆï¼\n\nç³»çµ±å·²è‡ªå‹•è¨˜éŒ„æ‰“å¡æ™‚é–“ã€‚' :
                'â° å¼•å°æ‰“å¡ç›£æ§çµæŸ\n\nè«‹ç¢ºèªæ‰“å¡æ˜¯å¦å®Œæˆã€‚';
            
            alert(message);
            
            // éš±è—å¼•å°é¢æ¿
            document.getElementById('guidancePanel').classList.add('hidden');
        }

        // é¡¯ç¤ºæŠ€è¡“è©³æƒ…
        function showTechnicalDetails() {
            const details = document.getElementById('technicalDetails');
            details.classList.toggle('hidden');
        }

        // é¡¯ç¤ºå¹«åŠ©
        function showHelp() {
            const helpText = `
ğŸ¯ æ™ºèƒ½å¼•å°æ‰“å¡ç³»çµ±èªªæ˜

ğŸ¤– è‡ªå‹•åŒ–åŠŸèƒ½ï¼š
â€¢ âœ… è‡ªå‹•æª¢æŸ¥æ‰“å¡æ—¥æœŸ
â€¢ âœ… è‡ªå‹•é–‹å•Ÿæ‰“å¡ç¶²ç«™
â€¢ âœ… æ™ºèƒ½é é¢æª¢æ¸¬
â€¢ âœ… è‡ªå‹•è¨˜éŒ„çµæœ

ğŸ‘† æ‰‹å‹•æ“ä½œï¼š
â€¢ éœ€è¦æ‰‹å‹•é»é¸ CHECK-IN æŒ‰éˆ•
â€¢ é€™æ˜¯ç€è¦½å™¨å®‰å…¨é™åˆ¶ï¼Œç„¡æ³•é¿å…

ğŸ”¬ æŠ€è¡“åŸç†ï¼š
â€¢ è·¨åŸŸå®‰å…¨æ”¿ç­– (CORS) é™åˆ¶
â€¢ åŸå§‹ Python ç‰ˆæœ¬å¯ä»¥å®Œå…¨è‡ªå‹•åŒ–
â€¢ ç¶²é ç‰ˆæœ¬åœ¨å®‰å…¨é™åˆ¶ä¸‹æœ€å¤§åŒ–è‡ªå‹•åŒ–

ğŸ’¡ ä½¿ç”¨å»ºè­°ï¼š
â€¢ ä½¿ç”¨æ™ºèƒ½å¼•å°åŠŸèƒ½
â€¢ æŒ‰ç…§æ­¥é©Ÿæç¤ºæ“ä½œ
â€¢ ç³»çµ±æœƒè‡ªå‹•è™•ç†å…¶ä»–äº‹é …
            `;
            
            alert(helpText);
        }

        // å·¥å…·å‡½æ•¸
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        console.log('ğŸ¯ æ™ºèƒ½å¼•å°æ‰“å¡ç³»çµ±åˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html>
