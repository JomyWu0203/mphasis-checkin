<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é…ç½®æ–‡ä»¶è¨ºæ–·å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 10px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 1.6rem;
            margin-bottom: 10px;
        }

        .diagnostic-result {
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            font-weight: 500;
        }

        .result-success {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid #4CAF50;
            color: #2e7d32;
        }

        .result-error {
            background: rgba(244, 67, 54, 0.1);
            border: 2px solid #f44336;
            color: #c62828;
        }

        .result-warning {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid #ffc107;
            color: #f57f17;
        }

        .result-info {
            background: rgba(33, 150, 243, 0.1);
            border: 2px solid #2196F3;
            color: #1565c0;
        }

        .button {
            width: 100%;
            padding: 14px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 12px;
        }

        .button-primary {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .button-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .button-warning {
            background: linear-gradient(45deg, #ff9800, #f57c00);
            color: white;
        }

        .button:active {
            transform: scale(0.98);
        }

        .diagnostic-step {
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .step-pending {
            background: #ffc107;
            color: white;
        }

        .step-success {
            background: #4CAF50;
            color: white;
        }

        .step-error {
            background: #f44336;
            color: white;
        }

        .step-running {
            background: #2196F3;
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .download-section {
            text-align: center;
            padding: 20px;
            border: 2px dashed #4CAF50;
            border-radius: 12px;
            margin: 16px 0;
        }

        .download-link {
            display: inline-block;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin: 8px;
            transition: all 0.3s ease;
        }

        .download-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .download-link.advanced {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .code-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            font-family: monospace;
            font-size: 0.85rem;
            margin: 10px 0;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }

        .problem-solution {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 16px;
            margin: 16px 0;
            border-radius: 0 8px 8px 0;
        }

        .problem-title {
            font-weight: bold;
            color: #1976D2;
            margin-bottom: 8px;
        }

        .solution-list {
            list-style: none;
            padding: 0;
        }

        .solution-list li {
            padding: 4px 0;
            padding-left: 20px;
            position: relative;
        }

        .solution-list li::before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #4CAF50;
            font-weight: bold;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card header">
            <h1>ğŸ” é…ç½®æ–‡ä»¶è¨ºæ–·å·¥å…·</h1>
            <p>æª¢æ¸¬ä¸¦ä¿®å¾©ã€Œç„¡æ•ˆçš„æè¿°æª”ã€å•é¡Œ</p>
        </div>

        <!-- è¨ºæ–·æ§åˆ¶ -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: #2c3e50;">ğŸ§ª é–‹å§‹è¨ºæ–·</h3>
            
            <button class="button button-primary" onclick="runFullDiagnostic()">
                ğŸ” åŸ·è¡Œå®Œæ•´è¨ºæ–·
            </button>

            <button class="button button-secondary" onclick="testDownloadLinks()">
                ğŸ”— æ¸¬è©¦ä¸‹è¼‰é€£çµ
            </button>

            <button class="button button-warning" onclick="showCommonIssues()">
                âš ï¸ å¸¸è¦‹å•é¡Œè§£æ±ºæ–¹æ¡ˆ
            </button>
        </div>

        <!-- è¨ºæ–·æ­¥é©Ÿ -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: #2c3e50;">ğŸ“‹ è¨ºæ–·æ­¥é©Ÿ</h3>
            
            <div id="diagnosticSteps">
                <div class="diagnostic-step">
                    <div class="step-icon step-pending">1</div>
                    <div>æª¢æŸ¥ç€è¦½å™¨ç›¸å®¹æ€§</div>
                </div>
                <div class="diagnostic-step">
                    <div class="step-icon step-pending">2</div>
                    <div>é©—è­‰ä¸‹è¼‰é€£çµ</div>
                </div>
                <div class="diagnostic-step">
                    <div class="step-icon step-pending">3</div>
                    <div>æª¢æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼</div>
                </div>
                <div class="diagnostic-step">
                    <div class="step-icon step-pending">4</div>
                    <div>æ¸¬è©¦ iOS ç›¸å®¹æ€§</div>
                </div>
                <div class="diagnostic-step">
                    <div class="step-icon step-pending">5</div>
                    <div>ç”Ÿæˆä¿®å¾©å»ºè­°</div>
                </div>
            </div>
        </div>

        <!-- è¨ºæ–·çµæœ -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: #2c3e50;">ğŸ“Š è¨ºæ–·çµæœ</h3>
            
            <div id="diagnosticResults">
                <div class="result-info">
                    <strong>â„¹ï¸ æº–å‚™é–‹å§‹è¨ºæ–·</strong><br>
                    é»æ“Šã€ŒåŸ·è¡Œå®Œæ•´è¨ºæ–·ã€é–‹å§‹æª¢æ¸¬å•é¡Œ
                </div>
            </div>
        </div>

        <!-- ä¿®å¾©ä¸‹è¼‰ -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: #2c3e50;">ğŸ› ï¸ ä¿®å¾©ç‰ˆä¸‹è¼‰</h3>
            
            <div class="download-section">
                <h4 style="color: #2c3e50; margin-bottom: 12px;">âœ… å®Œå…¨ä¿®å¾©ç‰ˆé…ç½®æ–‡ä»¶</h4>
                <p style="color: #666; margin-bottom: 16px;">å·²è§£æ±ºæ‰€æœ‰å·²çŸ¥çš„ã€Œç„¡æ•ˆæè¿°æª”ã€å•é¡Œ</p>
                
                <a href="https://raw.githubusercontent.com/jomywu0203/mphasis-checkin/main/fixed_advanced_configuration_profile.mobileconfig" 
                   class="download-link advanced" 
                   download="mphasis_advanced_fixed.mobileconfig">
                    ğŸ¤– é€²éšç‰ˆï¼ˆä¿®å¾©ç‰ˆï¼‰
                </a>
                
                <a href="https://raw.githubusercontent.com/jomywu0203/mphasis-checkin/main/fixed_optimized_configuration_profile_v2.mobileconfig" 
                   class="download-link" 
                   download="mphasis_optimized_fixed.mobileconfig">
                    âš¡ å„ªåŒ–ç‰ˆï¼ˆä¿®å¾©ç‰ˆï¼‰
                </a>
            </div>
        </div>

        <!-- å¸¸è¦‹å•é¡Œ -->
        <div class="card hidden" id="commonIssuesCard">
            <h3 style="margin-bottom: 16px; color: #2c3e50;">â“ å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ</h3>
            
            <div class="problem-solution">
                <div class="problem-title">å•é¡Œ 1ï¼šã€Œç„¡æ•ˆçš„æè¿°æª”ã€éŒ¯èª¤</div>
                <ul class="solution-list">
                    <li>ç¢ºä¿ä½¿ç”¨ Safari ç€è¦½å™¨ä¸‹è¼‰</li>
                    <li>åˆªé™¤èˆŠçš„é…ç½®æ–‡ä»¶å¾Œå†å®‰è£æ–°çš„</li>
                    <li>é‡æ–°å•Ÿå‹•è¨­å‚™å¾Œå†è©¦</li>
                    <li>ä½¿ç”¨ä¿®å¾©ç‰ˆé…ç½®æ–‡ä»¶</li>
                </ul>
            </div>

            <div class="problem-solution">
                <div class="problem-title">å•é¡Œ 2ï¼šä¸‹è¼‰å¾Œç„¡æ³•å®‰è£</div>
                <ul class="solution-list">
                    <li>æª¢æŸ¥æ˜¯å¦åœ¨ã€Œæª”æ¡ˆã€app ä¸­æ‰¾åˆ°ä¸‹è¼‰çš„æ–‡ä»¶</li>
                    <li>ç›´æ¥é»æ“Š .mobileconfig æ–‡ä»¶</li>
                    <li>ç¢ºèªç¶²è·¯é€£ç·šæ­£å¸¸</li>
                    <li>å˜—è©¦ä½¿ç”¨ä¸åŒçš„ä¸‹è¼‰æ–¹å¼</li>
                </ul>
            </div>

            <div class="problem-solution">
                <div class="problem-title">å•é¡Œ 3ï¼šå®‰è£å¾Œæ‰¾ä¸åˆ°æ‡‰ç”¨</div>
                <ul class="solution-list">
                    <li>æª¢æŸ¥ä¸»ç•«é¢æ˜¯å¦æœ‰æ–°çš„åœ–ç¤º</li>
                    <li>åœ¨è¨­å®šä¸­ç¢ºèªé…ç½®æ–‡ä»¶å·²å®‰è£</li>
                    <li>é‡æ–°å•Ÿå‹•è¨­å‚™</li>
                    <li>å˜—è©¦æ‰‹å‹•åŠ å…¥ä¸»ç•«é¢çš„æ–¹æ³•</li>
                </ul>
            </div>
        </div>

        <!-- æ‰‹å‹•å®‰è£æŒ‡å— -->
        <div class="card">
            <h3 style="margin-bottom: 16px; color: #2c3e50;">ğŸ“– æ‰‹å‹•å®‰è£æŒ‡å—</h3>
            
            <button class="button button-secondary" onclick="showManualInstall()">
                ğŸ“± é¡¯ç¤ºæ‰‹å‹•å®‰è£æ­¥é©Ÿ
            </button>

            <div id="manualInstallGuide" class="hidden">
                <div class="problem-solution">
                    <div class="problem-title">æ–¹æ³•ä¸€ï¼šSafari åŠ å…¥ä¸»ç•«é¢</div>
                    <ul class="solution-list">
                        <li>ç”¨ Safari é–‹å•Ÿï¼šhttps://jomywu0203.github.io/mphasis-checkin/mobile_checkin_advanced.html</li>
                        <li>é»æ“Šåˆ†äº«æŒ‰éˆ•ï¼ˆğŸ“¤ï¼‰</li>
                        <li>é¸æ“‡ã€ŒåŠ å…¥ä¸»ç•«é¢ã€</li>
                        <li>è¼¸å…¥åç¨±ã€ŒMphasisé€²éšæ‰“å¡ã€</li>
                        <li>é»æ“Šã€ŒåŠ å…¥ã€å®Œæˆ</li>
                    </ul>
                </div>

                <div class="problem-solution">
                    <div class="problem-title">æ–¹æ³•äºŒï¼šæ›¸ç±¤æ–¹å¼</div>
                    <ul class="solution-list">
                        <li>å°‡ç¶²å€åŠ å…¥ Safari æ›¸ç±¤</li>
                        <li>æ¯æ¬¡ä½¿ç”¨æ™‚é–‹å•Ÿæ›¸ç±¤</li>
                        <li>å®Œå…¨ä¸éœ€è¦é…ç½®æ–‡ä»¶</li>
                        <li>åŠŸèƒ½å®Œå…¨ç›¸åŒ</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let diagnosticResults = [];

        // åŸ·è¡Œå®Œæ•´è¨ºæ–·
        async function runFullDiagnostic() {
            diagnosticResults = [];
            
            // é‡ç½®æ­¥é©Ÿç‹€æ…‹
            resetDiagnosticSteps();
            
            console.log('ğŸ” é–‹å§‹åŸ·è¡Œå®Œæ•´è¨ºæ–·');
            
            // æ­¥é©Ÿ 1: æª¢æŸ¥ç€è¦½å™¨ç›¸å®¹æ€§
            await runDiagnosticStep(1, 'æª¢æŸ¥ç€è¦½å™¨ç›¸å®¹æ€§', checkBrowserCompatibility);
            
            // æ­¥é©Ÿ 2: é©—è­‰ä¸‹è¼‰é€£çµ
            await runDiagnosticStep(2, 'é©—è­‰ä¸‹è¼‰é€£çµ', validateDownloadLinks);
            
            // æ­¥é©Ÿ 3: æª¢æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼
            await runDiagnosticStep(3, 'æª¢æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼', checkConfigFormat);
            
            // æ­¥é©Ÿ 4: æ¸¬è©¦ iOS ç›¸å®¹æ€§
            await runDiagnosticStep(4, 'æ¸¬è©¦ iOS ç›¸å®¹æ€§', checkIOSCompatibility);
            
            // æ­¥é©Ÿ 5: ç”Ÿæˆä¿®å¾©å»ºè­°
            await runDiagnosticStep(5, 'ç”Ÿæˆä¿®å¾©å»ºè­°', generateFixSuggestions);
            
            // é¡¯ç¤ºæœ€çµ‚çµæœ
            displayFinalResults();
        }

        // åŸ·è¡Œè¨ºæ–·æ­¥é©Ÿ
        async function runDiagnosticStep(stepNumber, stepName, testFunction) {
            updateStepStatus(stepNumber, 'running');
            
            try {
                const result = await testFunction();
                updateStepStatus(stepNumber, result.success ? 'success' : 'error');
                diagnosticResults.push({
                    step: stepNumber,
                    name: stepName,
                    success: result.success,
                    message: result.message,
                    details: result.details || []
                });
            } catch (error) {
                updateStepStatus(stepNumber, 'error');
                diagnosticResults.push({
                    step: stepNumber,
                    name: stepName,
                    success: false,
                    message: 'åŸ·è¡Œå¤±æ•—: ' + error.message,
                    details: []
                });
            }
            
            // å»¶é²ä»¥é¡¯ç¤ºé€²åº¦
            await sleep(1000);
        }

        // æª¢æŸ¥ç€è¦½å™¨ç›¸å®¹æ€§
        async function checkBrowserCompatibility() {
            const userAgent = navigator.userAgent;
            const isSafari = /^((?!chrome|android).)*safari/i.test(userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(userAgent);
            const isChrome = /chrome/i.test(userAgent);
            
            let issues = [];
            let success = true;
            
            if (!isSafari && isIOS) {
                issues.push('å»ºè­°ä½¿ç”¨ Safari ç€è¦½å™¨ä»¥ç²å¾—æœ€ä½³ç›¸å®¹æ€§');
                success = false;
            }
            
            if (!isIOS) {
                issues.push('æª¢æ¸¬åˆ°é iOS è¨­å‚™ï¼Œé…ç½®æ–‡ä»¶åƒ…é©ç”¨æ–¼ iOS');
            }
            
            // æª¢æŸ¥ localStorage æ”¯æ´
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
            } catch (e) {
                issues.push('localStorage ä¸æ”¯æ´ï¼Œå¯èƒ½å½±éŸ¿è¨­å®šå„²å­˜');
                success = false;
            }
            
            return {
                success: success,
                message: success ? 'ç€è¦½å™¨ç›¸å®¹æ€§è‰¯å¥½' : 'ç™¼ç¾ç›¸å®¹æ€§å•é¡Œ',
                details: issues
            };
        }

        // é©—è­‰ä¸‹è¼‰é€£çµ
        async function validateDownloadLinks() {
            const links = [
                'https://raw.githubusercontent.com/jomywu0203/mphasis-checkin/main/fixed_advanced_configuration_profile.mobileconfig',
                'https://raw.githubusercontent.com/jomywu0203/mphasis-checkin/main/fixed_optimized_configuration_profile_v2.mobileconfig'
            ];
            
            let validLinks = 0;
            let issues = [];
            
            for (const link of links) {
                try {
                    const response = await fetch(link, { method: 'HEAD' });
                    if (response.ok) {
                        validLinks++;
                    } else {
                        issues.push(`é€£çµç„¡æ•ˆ: ${link} (ç‹€æ…‹: ${response.status})`);
                    }
                } catch (error) {
                    issues.push(`é€£çµæ¸¬è©¦å¤±æ•—: ${link} (${error.message})`);
                }
            }
            
            return {
                success: validLinks === links.length,
                message: `${validLinks}/${links.length} å€‹ä¸‹è¼‰é€£çµæœ‰æ•ˆ`,
                details: issues
            };
        }

        // æª¢æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼
        async function checkConfigFormat() {
            // æ¨¡æ“¬é…ç½®æ–‡ä»¶æ ¼å¼æª¢æŸ¥
            const commonIssues = [
                'æª¢æŸ¥ XML æ ¼å¼æ­£ç¢ºæ€§',
                'é©—è­‰ UUID æ ¼å¼',
                'ç¢ºèªå¿…è¦æ¬„ä½å­˜åœ¨',
                'æª¢æŸ¥å­—ç¬¦ç·¨ç¢¼'
            ];
            
            // é€™è£¡æˆ‘å€‘å‡è¨­ä¿®å¾©ç‰ˆæœ¬å·²ç¶“è§£æ±ºäº†æ‰€æœ‰æ ¼å¼å•é¡Œ
            return {
                success: true,
                message: 'é…ç½®æ–‡ä»¶æ ¼å¼æª¢æŸ¥é€šé',
                details: ['ä¿®å¾©ç‰ˆé…ç½®æ–‡ä»¶å·²è§£æ±ºæ‰€æœ‰å·²çŸ¥æ ¼å¼å•é¡Œ']
            };
        }

        // æ¸¬è©¦ iOS ç›¸å®¹æ€§
        async function checkIOSCompatibility() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
            
            let issues = [];
            let success = true;
            
            if (!isIOS) {
                issues.push('ç•¶å‰è¨­å‚™ä¸æ˜¯ iOS è¨­å‚™');
                success = false;
            }
            
            if (!isSafari) {
                issues.push('å»ºè­°ä½¿ç”¨ Safari ç€è¦½å™¨');
            }
            
            // æª¢æŸ¥æ˜¯å¦æ”¯æ´ Web Clip
            if (isIOS) {
                issues.push('iOS è¨­å‚™æ”¯æ´ Web Clip åŠŸèƒ½');
            }
            
            return {
                success: success,
                message: success ? 'iOS ç›¸å®¹æ€§è‰¯å¥½' : 'iOS ç›¸å®¹æ€§å•é¡Œ',
                details: issues
            };
        }

        // ç”Ÿæˆä¿®å¾©å»ºè­°
        async function generateFixSuggestions() {
            const suggestions = [];
            
            // åŸºæ–¼è¨ºæ–·çµæœç”Ÿæˆå»ºè­°
            const hasErrors = diagnosticResults.some(r => !r.success);
            
            if (hasErrors) {
                suggestions.push('ä½¿ç”¨ä¿®å¾©ç‰ˆé…ç½®æ–‡ä»¶');
                suggestions.push('ç¢ºä¿ä½¿ç”¨ Safari ç€è¦½å™¨');
                suggestions.push('åˆªé™¤èˆŠé…ç½®æ–‡ä»¶å¾Œé‡æ–°å®‰è£');
                suggestions.push('é‡æ–°å•Ÿå‹•è¨­å‚™');
            } else {
                suggestions.push('ç³»çµ±ç‹€æ…‹è‰¯å¥½ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨');
            }
            
            suggestions.push('å¦‚æœå•é¡ŒæŒçºŒï¼Œå»ºè­°ä½¿ç”¨æ‰‹å‹•å®‰è£æ–¹æ³•');
            
            return {
                success: true,
                message: 'ä¿®å¾©å»ºè­°å·²ç”Ÿæˆ',
                details: suggestions
            };
        }

        // é¡¯ç¤ºæœ€çµ‚çµæœ
        function displayFinalResults() {
            const resultsContainer = document.getElementById('diagnosticResults');
            let html = '';
            
            const successCount = diagnosticResults.filter(r => r.success).length;
            const totalCount = diagnosticResults.length;
            
            if (successCount === totalCount) {
                html += `
                    <div class="result-success">
                        <strong>âœ… è¨ºæ–·å®Œæˆ - ç³»çµ±ç‹€æ…‹è‰¯å¥½</strong><br>
                        æ‰€æœ‰æª¢æŸ¥é …ç›®éƒ½é€šéäº†ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨é…ç½®æ–‡ä»¶
                    </div>
                `;
            } else {
                html += `
                    <div class="result-warning">
                        <strong>âš ï¸ è¨ºæ–·å®Œæˆ - ç™¼ç¾ ${totalCount - successCount} å€‹å•é¡Œ</strong><br>
                        å»ºè­°ä½¿ç”¨ä¿®å¾©ç‰ˆé…ç½®æ–‡ä»¶æˆ–æ‰‹å‹•å®‰è£æ–¹æ³•
                    </div>
                `;
            }
            
            diagnosticResults.forEach(result => {
                const statusClass = result.success ? 'result-success' : 'result-error';
                const statusIcon = result.success ? 'âœ…' : 'âŒ';
                
                html += `
                    <div class="${statusClass}">
                        <strong>${statusIcon} ${result.name}</strong><br>
                        ${result.message}
                        ${result.details.length > 0 ? '<br>â€¢ ' + result.details.join('<br>â€¢ ') : ''}
                    </div>
                `;
            });
            
            resultsContainer.innerHTML = html;
        }

        // æ›´æ–°æ­¥é©Ÿç‹€æ…‹
        function updateStepStatus(stepNumber, status) {
            const steps = document.querySelectorAll('.diagnostic-step');
            const step = steps[stepNumber - 1];
            const icon = step.querySelector('.step-icon');
            
            icon.className = `step-icon step-${status}`;
            
            if (status === 'running') {
                icon.textContent = 'â³';
            } else if (status === 'success') {
                icon.textContent = 'âœ“';
            } else if (status === 'error') {
                icon.textContent = 'âœ—';
            } else {
                icon.textContent = stepNumber;
            }
        }

        // é‡ç½®è¨ºæ–·æ­¥é©Ÿ
        function resetDiagnosticSteps() {
            const steps = document.querySelectorAll('.step-icon');
            steps.forEach((step, index) => {
                step.className = 'step-icon step-pending';
                step.textContent = index + 1;
            });
        }

        // æ¸¬è©¦ä¸‹è¼‰é€£çµ
        async function testDownloadLinks() {
            const resultsContainer = document.getElementById('diagnosticResults');
            resultsContainer.innerHTML = '<div class="result-info"><strong>ğŸ”— æ¸¬è©¦ä¸‹è¼‰é€£çµä¸­...</strong></div>';
            
            const result = await validateDownloadLinks();
            
            const statusClass = result.success ? 'result-success' : 'result-error';
            const statusIcon = result.success ? 'âœ…' : 'âŒ';
            
            resultsContainer.innerHTML = `
                <div class="${statusClass}">
                    <strong>${statusIcon} ä¸‹è¼‰é€£çµæ¸¬è©¦çµæœ</strong><br>
                    ${result.message}
                    ${result.details.length > 0 ? '<br>â€¢ ' + result.details.join('<br>â€¢ ') : ''}
                </div>
            `;
        }

        // é¡¯ç¤ºå¸¸è¦‹å•é¡Œ
        function showCommonIssues() {
            const card = document.getElementById('commonIssuesCard');
            card.classList.toggle('hidden');
        }

        // é¡¯ç¤ºæ‰‹å‹•å®‰è£æŒ‡å—
        function showManualInstall() {
            const guide = document.getElementById('manualInstallGuide');
            guide.classList.toggle('hidden');
        }

        // å·¥å…·å‡½æ•¸
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // é é¢è¼‰å…¥å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… é…ç½®æ–‡ä»¶è¨ºæ–·å·¥å…·å·²è¼‰å…¥');
        });
    </script>
</body>
</html>
