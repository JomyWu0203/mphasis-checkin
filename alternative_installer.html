<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mphasis 配置文件安裝</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            padding: 20px;
        }
        
        .installer {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .subtitle {
            color: #7f8c8d;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .description {
            color: #555;
            margin-bottom: 30px;
            line-height: 1.5;
            font-size: 0.95rem;
        }
        
        .install-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 18px 32px;
            font-size: 1.2rem;
            font-weight: 600;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 16px;
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
        }
        
        .install-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 10px rgba(76, 175, 80, 0.3);
        }
        
        .manual-btn {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 16px;
            text-decoration: none;
            display: inline-block;
        }
        
        .manual-btn:active {
            transform: translateY(2px);
        }
        
        .download-link {
            color: #2196F3;
            text-decoration: none;
            font-size: 0.9rem;
            margin: 10px 0;
            display: block;
        }
        
        .warning {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #856404;
            line-height: 1.4;
        }
        
        .success {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid #4CAF50;
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #2e7d32;
            line-height: 1.4;
            display: none;
        }
        
        .step {
            text-align: left;
            margin: 12px 0;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .step:last-child {
            border-bottom: none;
        }
        
        .step-number {
            background: #4CAF50;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 8px;
        }
        
        .instructions {
            display: none;
            text-align: left;
            margin-top: 20px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 12px;
        }
        
        .device-info {
            font-size: 0.8rem;
            color: #999;
            margin-top: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="installer">
        <div class="icon">🏢</div>
        <h1>Mphasis 打卡系統</h1>
        <div class="subtitle">企業配置文件安裝</div>
        <div class="description">
            點擊下方按鈕安裝企業級打卡系統配置文件
        </div>
        
        <!-- 主要安裝按鈕 -->
        <button class="install-btn" onclick="attemptInstall()" id="installButton">
            📲 安裝配置文件
        </button>
        
        <!-- 替代方案按鈕 -->
        <button class="manual-btn" onclick="showInstructions()" id="manualButton">
            📖 手動安裝說明
        </button>
        
        <!-- 直接下載連結 -->
          <a href="https://raw.githubusercontent.com/jomywu0203/mphasis-checkin/main/optimized_configuration_profile.mobileconfig" class="download-link" download="mphasis_optimized_config.mobileconfig" id="downloadLink">
              📥 下載優化版配置文件
          </a>
        
        <!-- 成功訊息 -->
        <div class="success" id="successMessage">
            <strong>✅ 下載開始！</strong><br>
            請檢查下載資料夾，找到配置文件後：<br>
            1. 點擊檔案開啟<br>
            2. 選擇「設定」<br>
            3. 前往：設定 → 一般 → VPN 与设备管理<br>
            4. 安裝配置文件
        </div>
        
        <!-- 警告訊息 -->
        <div class="warning">
            <strong>⚠️ 重要提醒：</strong><br>
            • 此配置文件僅適用於 iOS 設備<br>
            • 安裝後請允許相關權限<br>
            • 如遇問題請聯絡 IT 支援部門
        </div>
        
        <!-- 詳細安裝說明 -->
        <div class="instructions" id="instructions">
            <h3>📋 詳細安裝步驟</h3>
            
            <div class="step">
                <span class="step-number">1</span>
                <strong>下載配置文件</strong><br>
                點擊上方「直接下載配置文件」連結
            </div>
            
            <div class="step">
                <span class="step-number">2</span>
                <strong>開啟檔案</strong><br>
                在「檔案」App 或下載資料夾中找到並點擊檔案
            </div>
            
            <div class="step">
                <span class="step-number">3</span>
                <strong>選擇設定</strong><br>
                出現選項時選擇「設定」應用程式
            </div>
            
            <div class="step">
                <span class="step-number">4</span>
                <strong>前往管理頁面</strong><br>
                設定 → 一般 → VPN 与设备管理
            </div>
            
            <div class="step">
                <span class="step-number">5</span>
                <strong>安裝配置文件</strong><br>
                找到「Mphasis CheckIN 企業配置」並點擊安裝
            </div>
            
            <div class="step">
                <span class="step-number">6</span>
                <strong>確認安裝</strong><br>
                輸入設備密碼，確認安裝配置文件
            </div>
            
            <div class="step">
                <span class="step-number">7</span>
                <strong>完成</strong><br>
                主畫面會出現「Mphasis打卡」應用圖示
            </div>
        </div>
        
        <!-- 設備資訊 -->
        <div class="device-info" id="deviceInfo">
            正在檢測設備...
        </div>
    </div>

    <script>
        // 設備檢測
        function detectDevice() {
            const userAgent = navigator.userAgent;
            const isIOS = /iPad|iPhone|iPod/.test(userAgent);
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            const deviceInfo = document.getElementById('deviceInfo');
            
            if (isIOS) {
                deviceInfo.innerHTML = `
                    ✅ iOS 設備已檢測<br>
                    設備: ${getIOSDevice()}<br>
                    版本: ${getIOSVersion()}
                `;
                deviceInfo.style.color = '#2e7d32';
            } else if (isMobile) {
                deviceInfo.innerHTML = `
                    ⚠️ 非 iOS 設備<br>
                    此配置文件僅適用於 iPhone/iPad
                `;
                deviceInfo.style.color = '#f57c00';
                
                // 隱藏安裝按鈕
                document.getElementById('installButton').style.display = 'none';
            } else {
                deviceInfo.innerHTML = `
                    💻 桌面設備<br>
                    請在 iPhone/iPad 上開啟此頁面
                `;
                deviceInfo.style.color = '#666';
                
                // 隱藏安裝按鈕
                document.getElementById('installButton').style.display = 'none';
            }
        }
        
        function getIOSDevice() {
            const userAgent = navigator.userAgent;
            if (/iPad/.test(userAgent)) return 'iPad';
            if (/iPhone/.test(userAgent)) return 'iPhone';
            if (/iPod/.test(userAgent)) return 'iPod';
            return 'iOS Device';
        }
        
        function getIOSVersion() {
            const userAgent = navigator.userAgent;
            const match = userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/);
            if (match) {
                return \`\${match[1]}.\${match[2]}\${match[3] ? '.' + match[3] : ''}\`;
            }
            return 'Unknown';
        }
        
        // 嘗試安裝
        function attemptInstall() {
            const downloadLink = document.getElementById('downloadLink');
            const successMessage = document.getElementById('successMessage');
            
            // 觸發下載
            downloadLink.click();
            
            // 顯示成功訊息
            successMessage.style.display = 'block';
            
            // 記錄安裝嘗試
            console.log('配置文件下載已觸發:', new Date().toISOString());
            
            // 3秒後提供進一步指導
            setTimeout(() => {
                if (confirm('檔案已下載！\\n\\n是否需要查看詳細安裝說明？')) {
                    showInstructions();
                }
            }, 3000);
        }
        
        // 顯示安裝說明
        function showInstructions() {
            const instructions = document.getElementById('instructions');
            const button = document.getElementById('manualButton');
            
            if (instructions.style.display === 'none' || !instructions.style.display) {
                instructions.style.display = 'block';
                button.textContent = '📖 隱藏說明';
            } else {
                instructions.style.display = 'none';
                button.textContent = '📖 手動安裝說明';
            }
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            detectDevice();
            
            // 替換下載連結（如果有提供 GitHub URL）
            const urlParams = new URLSearchParams(window.location.search);
            const githubUrl = urlParams.get('url');
            
            if (githubUrl) {
                document.getElementById('downloadLink').href = githubUrl;
                console.log('使用提供的 GitHub URL:', githubUrl);
            }
        });
        
        // 頁面可見性監聽
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible') {
                console.log('頁面重新激活');
            }
        });
        
        // 錯誤處理
        window.addEventListener('error', function(e) {
            console.error('頁面錯誤:', e.error);
        });
        
        // 阻止選取文字（移動端體驗）
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
        });
        
        // 阻止右鍵選單
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
