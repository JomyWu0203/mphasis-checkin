<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mphasis 配置文件安裝</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            padding: 20px;
        }
        
        .installer {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .subtitle {
            color: #7f8c8d;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .description {
            color: #555;
            margin-bottom: 30px;
            line-height: 1.5;
            font-size: 0.95rem;
        }
        
        .install-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 18px 32px;
            font-size: 1.2rem;
            font-weight: 600;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 16px;
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
        }
        
        .install-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 10px rgba(76, 175, 80, 0.3);
        }
        
        .manual-btn {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 16px;
            text-decoration: none;
            display: inline-block;
        }
        
        .manual-btn:active {
            transform: translateY(2px);
        }
        
        .download-link {
            color: #2196F3;
            text-decoration: none;
            font-size: 0.9rem;
            margin: 10px 0;
            display: block;
        }
        
        .warning {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #856404;
            line-height: 1.4;
        }
        
        .success {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid #4CAF50;
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #2e7d32;
            line-height: 1.4;
            display: none;
        }
        
        .step {
            text-align: left;
            margin: 12px 0;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .step:last-child {
            border-bottom: none;
        }
        
        .step-number {
            background: #4CAF50;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 8px;
        }
        
        .instructions {
            display: none;
            text-align: left;
            margin-top: 20px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 12px;
        }
        
        .device-info {
            font-size: 0.8rem;
            color: #999;
            margin-top: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="installer">
        <div class="icon">🏢</div>
        <h1>Mphasis 打卡系統</h1>
        <div class="subtitle">企業配置文件安裝</div>
        <div class="description">
            點擊下方按鈕安裝企業級打卡系統配置文件
        </div>
        
        <!-- 主要安裝按鈕 -->
        <button class="install-btn" onclick="attemptInstall()" id="installButton">
            📲 安裝配置文件
        </button>
        
        <!-- 替代方案按鈕 -->
        <button class="manual-btn" onclick="showInstructions()" id="manualButton">
            📖 手動安裝說明
        </button>
        
        <!-- iOS 專用說明 -->
        <div style="background: linear-gradient(45deg, #E3F2FD, #BBDEFB); border: 2px solid #2196F3; border-radius: 12px; padding: 20px; margin: 20px 0;">
            <h3 style="color: #0D47A1; margin-bottom: 12px;">🍎 為什麼需要 iOS 原生版？</h3>
            <div style="color: #1565C0; font-size: 0.95rem; line-height: 1.6;">
                <strong>🔒 iOS Safari 安全限制：</strong><br>
                • 禁止網頁自動點選其他網站按鈕<br>
                • 禁止跨域自動填入表單<br>
                • 禁止後台自動執行腳本<br>
                • 嚴格的彈窗和權限控制<br><br>
                
                <strong>✅ iOS 原生版解決方案：</strong><br>
                • 🎯 智慧引導：逐步教您完成打卡<br>
                • 🔗 快捷方式：一鍵跳轉到正確頁面<br>
                • ⏰ 提醒功能：設定日曆或鬧鐘提醒<br>
                • 📋 資訊複製：快速填入登入資料<br>
                • 📱 原生體驗：完全符合 iOS 使用習慣<br><br>
                
                <strong>💡 真正實用，不做無意義的「自動化」！</strong>
            </div>
        </div>

        <!-- 自動點選技術限制說明 -->
        <div style="background: linear-gradient(45deg, #FFF3E0, #FFE0B2); border: 2px solid #FF9800; border-radius: 12px; padding: 20px; margin: 20px 0;">
            <h3 style="color: #E65100; margin-bottom: 12px;">🔒 為什麼無法自動點選其他網站按鈕？</h3>
            <div style="color: #BF360C; font-size: 0.95rem; line-height: 1.6;">
                <strong>🛡️ iOS Safari 同源政策 (Same-Origin Policy)：</strong><br><br>
                
                <strong>❌ 完全禁止的操作：</strong><br>
                • 從網站 A 控制網站 B 的按鈕<br>
                • 跨域讀取或修改其他網站內容<br>
                • 在 iframe 中操作外部網站<br>
                • 注入代碼到其他域名<br><br>
                
                <strong>🔐 這是瀏覽器安全的基石：</strong><br>
                • 防止惡意網站竊取資料<br>
                • 保護用戶隱私和安全<br>
                • 任何方法都無法繞過<br><br>
                
                <strong>✅ 解決方案：智慧引導 + 定時提醒！</strong><br>
                既然無法自動點選，我們提供<strong>比自動化更好的方案</strong>：
                分步驟視覺引導，確保您找到正確按鈕並成功打卡！
            </div>
        </div>

        <!-- 定時排程功能說明 -->
        <div style="background: linear-gradient(45deg, #F3E5F5, #E1BEE7); border: 2px solid #8A2BE2; border-radius: 12px; padding: 20px; margin: 20px 0;">
            <h3 style="color: #4A148C; margin-bottom: 12px;">⏰ 全新功能：iOS 定時排程打卡系統</h3>
            <div style="color: #6A1B9A; font-size: 0.95rem; line-height: 1.6;">
                <strong>🎯 核心功能：</strong><br>
                • ⏰ <strong>定時提醒</strong>：設定打卡時間，自動發送通知<br>
                • 📅 <strong>週間排程</strong>：選擇週一到週日哪幾天需要打卡<br>
                • 🚫 <strong>排除日期</strong>：設定假日、請假、出差等排除時間<br>
                • 🔔 <strong>iOS 通知</strong>：整合系統通知，即使應用關閉也能提醒<br>
                • 📱 <strong>日曆同步</strong>：自動產生 .ics 檔案，同步到 iOS 日曆<br>
                • ⏰ <strong>鬧鐘整合</strong>：一鍵設定 iOS 系統鬧鐘<br><br>
                
                <strong>🚀 使用場景：</strong><br>
                • 📅 <strong>規律打卡</strong>：週一到週五固定時間提醒<br>
                • 🏖️ <strong>假日管理</strong>：自動排除週末和國定假日<br>
                • ✈️ <strong>出差請假</strong>：臨時排除特定日期<br>
                • 🔄 <strong>彈性排程</strong>：隨時調整打卡時間和頻率<br><br>
                
                <strong>💡 完美解決「記不住打卡」問題！</strong>
            </div>
        </div>

        <!-- 通知問題修復說明 -->
        <div style="background: linear-gradient(45deg, #FFEBEE, #FFCDD2); border: 2px solid #DC143C; border-radius: 12px; padding: 20px; margin: 20px 0;">
            <h3 style="color: #B71C1C; margin-bottom: 12px;">🔧 修復：iOS Safari 通知權限問題</h3>
            <div style="color: #C62828; font-size: 0.95rem; line-height: 1.6;">
                <strong>❌ 常見問題：</strong><br>
                • 顯示「此瀏覽器不支援通知功能」<br>
                • 排程控制無法啟用<br>
                • iOS Safari 嚴格的通知限制<br>
                • PWA 通知權限不穩定<br><br>
                
                <strong>✅ 修復方案：</strong><br>
                • 🎯 <strong>智慧檢測</strong>：自動檢測瀏覽器支援功能<br>
                • 👁️ <strong>視覺提醒</strong>：全屏閃爍提醒（推薦）<br>
                • 🔊 <strong>聲音提醒</strong>：語音播報 + 嗶聲<br>
                • 📳 <strong>振動提醒</strong>：設備振動提醒<br>
                • 📅 <strong>日曆整合</strong>：系統級提醒方案<br><br>
                
                <strong>🎉 多重保險，絕不遺漏打卡！</strong>
            </div>
        </div>

        <!-- 按鈕問題修復說明 -->
        <div style="background: linear-gradient(45deg, #E8F5E8, #C8E6C9); border: 2px solid #4CAF50; border-radius: 12px; padding: 20px; margin: 20px 0;">
            <h3 style="color: #1B5E20; margin-bottom: 12px;">🔧 已修復：iOS Safari 按鈕無法點擊問題</h3>
            <div style="color: #2E7D32; font-size: 0.95rem; line-height: 1.6;">
                <strong>❌ 常見問題：</strong><br>
                • 按鈕點擊沒有反應<br>
                • JavaScript 事件無效<br>
                • 觸控反饋異常<br>
                • 複雜功能無法執行<br><br>
                
                <strong>✅ 修復措施：</strong><br>
                • 🎯 使用 onclick 而不是 addEventListener<br>
                • 📱 添加 iOS 專用觸控優化<br>
                • 🔧 簡化 JavaScript 代碼結構<br>
                • ⚡ 移除複雜的異步操作<br>
                • 🍎 完全符合 Safari 安全政策<br><br>
                
                <strong>🎉 現在按鈕 100% 可用！</strong>
            </div>
        </div>

        <!-- 版本選擇 -->
        <div style="margin: 20px 0;">
            <h3 style="color: #2c3e50; margin-bottom: 12px;">選擇版本：</h3>
            
            <div style="display: grid; gap: 12px;">
                <!-- iOS 排程修復版 (解決通知問題) -->
                <a href="https://raw.githubusercontent.com/jomywu0203/mphasis-checkin/main/ios_scheduler_fixed_configuration_profile.mobileconfig" 
                   class="download-link" 
                   download="mphasis_ios_scheduler_fixed.mobileconfig" 
                   style="background: linear-gradient(45deg, #DC143C, #B22222); animation: pulse 2s infinite; border: 4px solid #FFD700; box-shadow: 0 0 35px rgba(220, 20, 60, 0.8); transform: scale(1.05);">
                    🔧 下載 iOS 排程打卡修復版 (推薦!)
                    <div style="font-size: 0.8rem; margin-top: 4px; opacity: 0.9;">
                        ⭐ 已修復通知問題、多重提醒方式、視覺+聲音+振動
                    </div>
                </a>
                
                <!-- iOS 定時排程版 -->
                <a href="https://raw.githubusercontent.com/jomywu0203/mphasis-checkin/main/ios_scheduler_configuration_profile.mobileconfig" 
                   class="download-link" 
                   download="mphasis_ios_scheduler.mobileconfig" 
                   style="background: linear-gradient(45deg, #8A2BE2, #9932CC); border: 2px solid #8A2BE2; opacity: 0.8;">
                    ⏰ 下載 iOS 定時排程打卡 (原版)
                    <div style="font-size: 0.8rem; margin-top: 4px; opacity: 0.9;">
                        可能有通知問題，建議使用修復版
                    </div>
                </a>
                
                <!-- iOS 智慧引導版 -->
                <a href="https://raw.githubusercontent.com/jomywu0203/mphasis-checkin/main/ios_guided_configuration_profile.mobileconfig" 
                   class="download-link" 
                   download="mphasis_ios_guided.mobileconfig" 
                   style="background: linear-gradient(45deg, #FF6B35, #F7931E); border: 2px solid #FF6B35;">
                    🎯 下載 iOS 智慧引導打卡 (引導版)
                    <div style="font-size: 0.8rem; margin-top: 4px; opacity: 0.9;">
                        ⭐ 分步驟視覺引導、適合偶爾打卡
                    </div>
                </a>
                
                <!-- iOS 簡易版 (修復按鈕問題) -->
                <a href="https://raw.githubusercontent.com/jomywu0203/mphasis-checkin/main/ios_simple_configuration_profile.mobileconfig" 
                   class="download-link" 
                   download="mphasis_ios_simple.mobileconfig" 
                   style="background: linear-gradient(45deg, #34C759, #28A745); border: 2px solid #28A745;">
                    ✅ 下載 iOS 簡易打卡 (基礎版)
                    <div style="font-size: 0.8rem; margin-top: 4px; opacity: 0.9;">
                        🔧 已修復按鈕問題、功能簡單、適合熟手
                    </div>
                </a>
                
                <!-- iOS 原生版 -->
                <a href="https://raw.githubusercontent.com/jomywu0203/mphasis-checkin/main/ios_native_configuration_profile.mobileconfig" 
                   class="download-link" 
                   download="mphasis_ios_native.mobileconfig" 
                   style="background: linear-gradient(45deg, #007AFF, #0051D5); opacity: 0.7;">
                    📱 下載 iOS 原生打卡助手 (功能豐富)
                    <div style="font-size: 0.8rem; margin-top: 4px; opacity: 0.9;">
                        功能較多但可能有按鈕問題，建議使用簡易版
                    </div>
                </a>
                
                <!-- 自動點選修復版 -->
                <a href="https://raw.githubusercontent.com/jomywu0203/mphasis-checkin/main/autoclick_fixed_configuration_profile.mobileconfig" 
                   class="download-link" 
                   download="mphasis_autoclick_fixed.mobileconfig" 
                   style="background: linear-gradient(45deg, #4CAF50, #45a049); opacity: 0.6;">
                    ✅ 下載自動點選修復版配置文件 (電腦邏輯)
                    <div style="font-size: 0.8rem; margin-top: 4px; opacity: 0.9;">
                        已修復錯誤，但仍是電腦思維，iOS 限制多
                    </div>
                </a>
                
                <!-- 自動點選版 -->
                <a href="https://raw.githubusercontent.com/jomywu0203/mphasis-checkin/main/autoclick_configuration_profile.mobileconfig" 
                   class="download-link" 
                   download="mphasis_autoclick.mobileconfig" 
                   style="background: linear-gradient(45deg, #e91e63, #ad1457); opacity: 0.7;">
                    🎯 下載自動點選版配置文件 (原版)
                    <div style="font-size: 0.8rem; margin-top: 4px; opacity: 0.9;">
                        可能有 JavaScript 錯誤，建議使用修復版
                    </div>
                </a>
                
                <!-- 進階版 -->
                <a href="https://raw.githubusercontent.com/jomywu0203/mphasis-checkin/main/fixed_advanced_configuration_profile.mobileconfig" 
                   class="download-link" 
                   download="mphasis_advanced_fixed.mobileconfig" 
                   style="background: linear-gradient(45deg, #667eea, #764ba2);">
                    🤖 下載進階版配置文件
                    <div style="font-size: 0.8rem; margin-top: 4px; opacity: 0.9;">
                        具備完整自動化功能、打卡日期設定、狀態檢測
                    </div>
                </a>
                
                <!-- 優化版 -->
                <a href="https://raw.githubusercontent.com/jomywu0203/mphasis-checkin/main/fixed_optimized_configuration_profile_v2.mobileconfig" 
                   class="download-link" 
                   download="mphasis_optimized_fixed.mobileconfig">
                    ⚡ 下載優化版配置文件
                    <div style="font-size: 0.8rem; margin-top: 4px; opacity: 0.9;">
                        穩定可靠、多種打卡方式、設定儲存功能
                    </div>
                </a>
            </div>
        </div>
        
        <!-- 成功訊息 -->
        <div class="success" id="successMessage">
            <strong>✅ 下載開始！</strong><br>
            請檢查下載資料夾，找到配置文件後：<br>
            1. 點擊檔案開啟<br>
            2. 選擇「設定」<br>
            3. 前往：設定 → 一般 → VPN 与设备管理<br>
            4. 安裝配置文件
        </div>
        
        <!-- 警告訊息 -->
        <div class="warning">
            <strong>⚠️ 重要提醒：</strong><br>
            • 此配置文件僅適用於 iOS 設備<br>
            • 安裝後請允許相關權限<br>
            • 如遇問題請聯絡 IT 支援部門
        </div>
        
        <!-- 詳細安裝說明 -->
        <div class="instructions" id="instructions">
            <h3>📋 詳細安裝步驟</h3>
            
            <div class="step">
                <span class="step-number">1</span>
                <strong>下載配置文件</strong><br>
                點擊上方「直接下載配置文件」連結
            </div>
            
            <div class="step">
                <span class="step-number">2</span>
                <strong>開啟檔案</strong><br>
                在「檔案」App 或下載資料夾中找到並點擊檔案
            </div>
            
            <div class="step">
                <span class="step-number">3</span>
                <strong>選擇設定</strong><br>
                出現選項時選擇「設定」應用程式
            </div>
            
            <div class="step">
                <span class="step-number">4</span>
                <strong>前往管理頁面</strong><br>
                設定 → 一般 → VPN 与设备管理
            </div>
            
            <div class="step">
                <span class="step-number">5</span>
                <strong>安裝配置文件</strong><br>
                找到「Mphasis CheckIN 企業配置」並點擊安裝
            </div>
            
            <div class="step">
                <span class="step-number">6</span>
                <strong>確認安裝</strong><br>
                輸入設備密碼，確認安裝配置文件
            </div>
            
            <div class="step">
                <span class="step-number">7</span>
                <strong>完成</strong><br>
                主畫面會出現「Mphasis打卡」應用圖示
            </div>
        </div>
        
        <!-- 設備資訊 -->
        <div class="device-info" id="deviceInfo">
            正在檢測設備...
        </div>
    </div>

    <script>
        // 設備檢測
        function detectDevice() {
            const userAgent = navigator.userAgent;
            const isIOS = /iPad|iPhone|iPod/.test(userAgent);
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            const deviceInfo = document.getElementById('deviceInfo');
            
            if (isIOS) {
                deviceInfo.innerHTML = `
                    ✅ iOS 設備已檢測<br>
                    設備: ${getIOSDevice()}<br>
                    版本: ${getIOSVersion()}
                `;
                deviceInfo.style.color = '#2e7d32';
            } else if (isMobile) {
                deviceInfo.innerHTML = `
                    ⚠️ 非 iOS 設備<br>
                    此配置文件僅適用於 iPhone/iPad
                `;
                deviceInfo.style.color = '#f57c00';
                
                // 隱藏安裝按鈕
                document.getElementById('installButton').style.display = 'none';
            } else {
                deviceInfo.innerHTML = `
                    💻 桌面設備<br>
                    請在 iPhone/iPad 上開啟此頁面
                `;
                deviceInfo.style.color = '#666';
                
                // 隱藏安裝按鈕
                document.getElementById('installButton').style.display = 'none';
            }
        }
        
        function getIOSDevice() {
            const userAgent = navigator.userAgent;
            if (/iPad/.test(userAgent)) return 'iPad';
            if (/iPhone/.test(userAgent)) return 'iPhone';
            if (/iPod/.test(userAgent)) return 'iPod';
            return 'iOS Device';
        }
        
        function getIOSVersion() {
            const userAgent = navigator.userAgent;
            const match = userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/);
            if (match) {
                return \`\${match[1]}.\${match[2]}\${match[3] ? '.' + match[3] : ''}\`;
            }
            return 'Unknown';
        }
        
        // 嘗試安裝
        function attemptInstall() {
            const downloadLink = document.getElementById('downloadLink');
            const successMessage = document.getElementById('successMessage');
            
            // 觸發下載
            downloadLink.click();
            
            // 顯示成功訊息
            successMessage.style.display = 'block';
            
            // 記錄安裝嘗試
            console.log('配置文件下載已觸發:', new Date().toISOString());
            
            // 3秒後提供進一步指導
            setTimeout(() => {
                if (confirm('檔案已下載！\\n\\n是否需要查看詳細安裝說明？')) {
                    showInstructions();
                }
            }, 3000);
        }
        
        // 顯示安裝說明
        function showInstructions() {
            const instructions = document.getElementById('instructions');
            const button = document.getElementById('manualButton');
            
            if (instructions.style.display === 'none' || !instructions.style.display) {
                instructions.style.display = 'block';
                button.textContent = '📖 隱藏說明';
            } else {
                instructions.style.display = 'none';
                button.textContent = '📖 手動安裝說明';
            }
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            detectDevice();
            
            // 替換下載連結（如果有提供 GitHub URL）
            const urlParams = new URLSearchParams(window.location.search);
            const githubUrl = urlParams.get('url');
            
            if (githubUrl) {
                document.getElementById('downloadLink').href = githubUrl;
                console.log('使用提供的 GitHub URL:', githubUrl);
            }
        });
        
        // 頁面可見性監聽
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible') {
                console.log('頁面重新激活');
            }
        });
        
        // 錯誤處理
        window.addEventListener('error', function(e) {
            console.error('頁面錯誤:', e.error);
        });
        
        // 阻止選取文字（移動端體驗）
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
        });
        
        // 阻止右鍵選單
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
